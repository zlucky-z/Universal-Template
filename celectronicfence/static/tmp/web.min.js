var LeaferUI=function(t){"use strict";const e={toURL(t,e){let i=encodeURIComponent(t);return"text"===e?i="data:text/plain;charset=utf-8,"+i:"svg"===e&&(i="data:image/svg+xml,"+i),i},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",getRealURL(t){const{prefix:i,suffix:s}=e.image;return!s||t.startsWith("data:")||t.startsWith("blob:")||(t+=(t.includes("?")?"&":"?")+s),i&&"/"===t[0]&&(t=i+t),t}}},i={},s={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(t){const{types:e}=o;return e[t]?e[t]++:(e[t]=1,0)}},o=s,{round:n,pow:r,PI:a}=Math,h={within:(t,e,i)=>("object"==typeof e&&(i=e.max,e=e.min),void 0!==e&&t<e&&(t=e),void 0!==i&&t>i&&(t=i),t),fourNumber(t,e){let i;if(t instanceof Array)switch(t.length){case 4:i=void 0===e?t:[...t];break;case 2:i=[t[0],t[1],t[0],t[1]];break;case 3:i=[t[0],t[1],t[2],t[1]];break;case 1:t=t[0];break;default:t=0}if(i||(i=[t,t,t,t]),e)for(let t=0;t<4;t++)i[t]>e&&(i[t]=e);return i},formatRotation:(t,e)=>(t%=360,e?t<0&&(t+=360):(t>180&&(t-=360),t<-180&&(t+=360)),h.float(t)),getGapRotation(t,e,i=0){let s=t+i;if(e>1){const t=Math.abs(s%e);(t<1||t>e-1)&&(s=Math.round(s/e)*e)}return s-i},float(t,e){const i=e?r(10,e):1e12;return-0===(t=n(t*i)/i)?0:t},getScaleData:(t,e,i,s)=>(s||(s={}),e?(s.scaleX=("number"==typeof e?e:e.width)/i.width,s.scaleY=("number"==typeof e?e:e.height)/i.height):t&&(s.scaleX="number"==typeof t?t:t.x,s.scaleY="number"==typeof t?t:t.y),s)},l=a/180,d=2*a,c=a/2;function u(){return{x:0,y:0}}function p(){return{x:0,y:0,width:0,height:0}}function _(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:g,cos:f,acos:y,sqrt:v}=Math,{float:m}=h,w={};function x(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const b={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:x(),tempMatrix:{},set(t,e=1,i=0,s=0,o=1,n=0,r=0){t.a=e,t.b=i,t.c=s,t.d=o,t.e=n,t.f=r},get:_,getWorld:x,copy(t,e){t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f},translate(t,e,i){t.e+=e,t.f+=i},translateInner(t,e,i,s){t.e+=t.a*e+t.c*i,t.f+=t.b*e+t.d*i,s&&(t.e-=e,t.f-=i)},scale(t,e,i=e){t.a*=e,t.b*=e,t.c*=i,t.d*=i},scaleOfOuter(t,e,i,s){E.toInnerPoint(t,e,w),E.scaleOfInner(t,w,i,s)},scaleOfInner(t,e,i,s=i){E.translateInner(t,e.x,e.y),E.scale(t,i,s),E.translateInner(t,-e.x,-e.y)},rotate(t,e){const{a:i,b:s,c:o,d:n}=t,r=f(e*=l),a=g(e);t.a=i*r-s*a,t.b=i*a+s*r,t.c=o*r-n*a,t.d=o*a+n*r},rotateOfOuter(t,e,i){E.toInnerPoint(t,e,w),E.rotateOfInner(t,w,i)},rotateOfInner(t,e,i){E.translateInner(t,e.x,e.y),E.rotate(t,i),E.translateInner(t,-e.x,-e.y)},skew(t,e,i){const{a:s,b:o,c:n,d:r}=t;i&&(i*=l,t.a=s+n*i,t.b=o+r*i),e&&(e*=l,t.c=n+s*e,t.d=r+o*e)},skewOfOuter(t,e,i,s){E.toInnerPoint(t,e,w),E.skewOfInner(t,w,i,s)},skewOfInner(t,e,i,s=0){E.translateInner(t,e.x,e.y),E.skew(t,i,s),E.translateInner(t,-e.x,-e.y)},multiply(t,e){const{a:i,b:s,c:o,d:n,e:r,f:a}=t;t.a=e.a*i+e.b*o,t.b=e.a*s+e.b*n,t.c=e.c*i+e.d*o,t.d=e.c*s+e.d*n,t.e=e.e*i+e.f*o+r,t.f=e.e*s+e.f*n+a},multiplyParent(t,e,i,s,o,n){let{e:r,f:a}=t;if(n&&(r+=n.scrollX,a+=n.scrollY),i||(i=t),void 0===s&&(s=1!==t.a||t.b||t.c||1!==t.d),s){const{a:s,b:n,c:r,d:a}=t;i.a=s*e.a+n*e.c,i.b=s*e.b+n*e.d,i.c=r*e.a+a*e.c,i.d=r*e.b+a*e.d,o&&(i.scaleX=e.scaleX*o.scaleX,i.scaleY=e.scaleY*o.scaleY)}else i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,o&&(i.scaleX=e.scaleX,i.scaleY=e.scaleY);i.e=r*e.a+a*e.c+e.e,i.f=r*e.b+a*e.d+e.f},divide(t,e){E.multiply(t,E.tempInvert(e))},divideParent(t,e){E.multiplyParent(t,E.tempInvert(e))},tempInvert(t){const{tempMatrix:e}=E;return E.copy(e,t),E.invert(e),e},invert(t){const{a:e,b:i,c:s,d:o,e:n,f:r}=t;if(i||s){const a=1/(e*o-i*s);t.a=o*a,t.b=-i*a,t.c=-s*a,t.d=e*a,t.e=-(n*o-r*s)*a,t.f=-(r*e-n*i)*a}else if(1===e&&1===o)t.e=-n,t.f=-r;else{const i=1/(e*o);t.a=o*i,t.d=e*i,t.e=-n*o*i,t.f=-r*e*i}},toOuterPoint(t,e,i,s){const{x:o,y:n}=e;i||(i=e),i.x=o*t.a+n*t.c,i.y=o*t.b+n*t.d,s||(i.x+=t.e,i.y+=t.f)},toInnerPoint(t,e,i,s){const{a:o,b:n,c:r,d:a}=t,h=1/(o*a-n*r),{x:l,y:d}=e;if(i||(i=e),i.x=(l*a-d*r)*h,i.y=(d*o-l*n)*h,!s){const{e:e,f:s}=t;i.x-=(e*a-s*r)*h,i.y-=(s*o-e*n)*h}},setLayout(t,e,i,s,o){const{x:n,y:r,scaleX:a,scaleY:h}=e;if(void 0===o&&(o=e.rotation||e.skewX||e.skewY),o){const{rotation:i,skewX:s,skewY:o}=e,n=i*l,r=f(n),d=g(n);if(s||o){const e=s*l,i=o*l;t.a=(r+i*-d)*a,t.b=(d+i*r)*a,t.c=(e*r-d)*h,t.d=(r+e*d)*h}else t.a=r*a,t.b=d*a,t.c=-d*h,t.d=r*h}else t.a=a,t.b=0,t.c=0,t.d=h;t.e=n,t.f=r,(i=i||s)&&E.translateInner(t,-i.x,-i.y,!s)},getLayout(t,e,i,s){const{a:o,b:n,c:r,d:a,e:h,f:d}=t;let u,p,_,w,x,b=h,E=d;if(n||r){const t=o*a-n*r;if(r&&!s){u=v(o*o+n*n),p=t/u;const e=o/u;_=n>0?y(e):-y(e)}else{p=v(r*r+a*a),u=t/p;const e=r/p;_=c-(a>0?y(-e):-y(e))}const e=m(f(_)),i=g(_);u=m(u),p=m(p),w=e?m((r/p+i)/e/l,9):0,x=e?m((n/u-i)/e/l,9):0,_=m(_/l)}else u=o,p=a,_=w=x=0;return(e=i||e)&&(b+=e.x*o+e.y*r,E+=e.x*n+e.y*a,i||(b-=e.x,E-=e.y)),{x:b,y:E,scaleX:u,scaleY:p,rotation:_,skewX:w,skewY:x}},withScale(t,e,i=e){const s=t;if(!e||!i){const{a:s,b:o,c:n,d:r}=t;o||n?i=(s*r-o*n)/(e=v(s*s+o*o)):(e=s,i=r)}return s.scaleX=e,s.scaleY=i,s},reset(t){E.set(t)}},E=b,{toInnerPoint:k,toOuterPoint:B}=b,{sin:T,cos:L,abs:P,sqrt:R,atan2:C,min:S,PI:O}=Math,D={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(t,e=0,i=0){t.x=e,t.y=i},setRadius(t,e,i){t.radiusX=e,t.radiusY=void 0===i?e:i},copy(t,e){t.x=e.x,t.y=e.y},copyFrom(t,e,i){t.x=e,t.y=i},move(t,e,i){t.x+=e,t.y+=i},scale(t,e,i=e){t.x&&(t.x*=e),t.y&&(t.y*=i)},scaleOf(t,e,i,s=i){t.x+=(t.x-e.x)*(i-1),t.y+=(t.y-e.y)*(s-1)},rotate(t,e,i){i||(i=M.defaultPoint);const s=L(e*=l),o=T(e),n=t.x-i.x,r=t.y-i.y;t.x=i.x+n*s-r*o,t.y=i.y+n*o+r*s},tempToInnerOf(t,e){const{tempPoint:i}=M;return A(i,t),k(e,i,i),i},tempToOuterOf(t,e){const{tempPoint:i}=M;return A(i,t),B(e,i,i),i},tempToInnerRadiusPointOf(t,e){const{tempRadiusPoint:i}=M;return A(i,t),M.toInnerRadiusPointOf(t,e,i),i},toInnerRadiusPointOf(t,e,i){i||(i=t),k(e,t,i),i.radiusX=Math.abs(t.radiusX/e.scaleX),i.radiusY=Math.abs(t.radiusY/e.scaleY)},toInnerOf(t,e,i){k(e,t,i)},toOuterOf(t,e,i){B(e,t,i)},getCenter:(t,e)=>({x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}),getCenterX:(t,e)=>t+(e-t)/2,getCenterY:(t,e)=>t+(e-t)/2,getDistance:(t,e)=>I(t.x,t.y,e.x,e.y),getDistanceFrom(t,e,i,s){const o=P(i-t),n=P(s-e);return R(o*o+n*n)},getMinDistanceFrom:(t,e,i,s,o,n)=>S(I(t,e,i,s),I(i,s,o,n)),getAngle:(t,e)=>W(t,e)/l,getRotation:(t,e,i,s)=>(s||(s=e),M.getRadianFrom(t.x,t.y,e.x,e.y,i.x,i.y,s.x,s.y)/l),getRadianFrom(t,e,i,s,o,n,r,a){void 0===r&&(r=i,a=s);let h=C(e-s,t-i);const l=C(n-a,o-r)-h;return l<-O?l+d:l},getAtan2:(t,e)=>C(e.y-t.y,e.x-t.x),getDistancePoint(t,e,i,s){const o=W(t,e);return(e=s?e:{}).x=t.x+L(o)*i,e.y=t.y+T(o)*i,e},reset(t){M.reset(t)}},M=D,{getDistanceFrom:I,copy:A,getAtan2:W}=M;class z{constructor(t,e){this.set(t,e)}set(t,e){return"object"==typeof t?D.copy(this,t):D.set(this,t,e),this}get(){const{x:t,y:e}=this;return{x:t,y:e}}clone(){return new z(this)}move(t,e){return D.move(this,t,e),this}scale(t,e){return D.scale(this,t,e),this}scaleOf(t,e,i){return D.scaleOf(this,t,e,i),this}rotate(t,e){return D.rotate(this,t,e),this}rotateOf(t,e){return D.rotate(this,e,t),this}getRotation(t,e,i){return D.getRotation(this,t,e,i)}toInnerOf(t,e){return D.toInnerOf(this,t,e),this}toOuterOf(t,e){return D.toOuterOf(this,t,e),this}getCenter(t){return new z(D.getCenter(this,t))}getDistance(t){return D.getDistance(this,t)}getDistancePoint(t,e,i){return new z(D.getDistancePoint(this,t,e,i))}getAngle(t){return D.getAngle(this,t)}getAtan2(t){return D.getAtan2(this,t)}reset(){return D.reset(this),this}}const F=new z;class U{constructor(t,e,i,s,o,n){this.set(t,e,i,s,o,n)}set(t,e,i,s,o,n){return"object"==typeof t?b.copy(this,t):b.set(this,t,e,i,s,o,n),this}setWith(t){return b.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:e,c:i,d:s,e:o,f:n}=this;return{a:t,b:e,c:i,d:s,e:o,f:n}}clone(){return new U(this)}translate(t,e){return b.translate(this,t,e),this}translateInner(t,e){return b.translateInner(this,t,e),this}scale(t,e){return b.scale(this,t,e),this}scaleWith(t,e){return b.scale(this,t,e),this.scaleX*=t,this.scaleY*=e||t,this}scaleOfOuter(t,e,i){return b.scaleOfOuter(this,t,e,i),this}scaleOfInner(t,e,i){return b.scaleOfInner(this,t,e,i),this}rotate(t){return b.rotate(this,t),this}rotateOfOuter(t,e){return b.rotateOfOuter(this,t,e),this}rotateOfInner(t,e){return b.rotateOfInner(this,t,e),this}skew(t,e){return b.skew(this,t,e),this}skewOfOuter(t,e,i){return b.skewOfOuter(this,t,e,i),this}skewOfInner(t,e,i){return b.skewOfInner(this,t,e,i),this}multiply(t){return b.multiply(this,t),this}multiplyParent(t){return b.multiplyParent(this,t),this}divide(t){return b.divide(this,t),this}divideParent(t){return b.divideParent(this,t),this}invert(){return b.invert(this),this}invertWith(){return b.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,e,i){b.toOuterPoint(this,t,e,i)}toInnerPoint(t,e,i){b.toInnerPoint(this,t,e,i)}setLayout(t,e,i){return b.setLayout(this,t,e,i),this}getLayout(t,e,i){return b.getLayout(this,t,e,i)}withScale(t,e){return b.withScale(this,t,e)}reset(){b.reset(this)}}const H=new U,N={tempPointBounds:{},setPoint(t,e,i){t.minX=t.maxX=e,t.minY=t.maxY=i},addPoint(t,e,i){t.minX=e<t.minX?e:t.minX,t.minY=i<t.minY?i:t.minY,t.maxX=e>t.maxX?e:t.maxX,t.maxY=i>t.maxY?i:t.maxY},addBounds(t,e,i,s,o){Y(t,e,i),Y(t,e+s,i+o)},copy(t,e){t.minX=e.minX,t.minY=e.minY,t.maxX=e.maxX,t.maxY=e.maxY},addPointBounds(t,e){t.minX=e.minX<t.minX?e.minX:t.minX,t.minY=e.minY<t.minY?e.minY:t.minY,t.maxX=e.maxX>t.maxX?e.maxX:t.maxX,t.maxY=e.maxY>t.maxY?e.maxY:t.maxY},toBounds(t,e){e.x=t.minX,e.y=t.minY,e.width=t.maxX-t.minX,e.height=t.maxY-t.minY}},{addPoint:Y}=N,{tempPointBounds:V,setPoint:X,addPoint:G,toBounds:j}=N,{toOuterPoint:Z}=b,{float:K,fourNumber:q}=h,{floor:J,ceil:$}=Math;let Q,tt,et,it;const st={},ot={},nt={tempBounds:{},set(t,e=0,i=0,s=0,o=0){t.x=e,t.y=i,t.width=s,t.height=o},copy(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},copyAndSpread(t,e,i,s,o){const{x:n,y:r,width:a,height:h}=e;if(i instanceof Array){const e=q(i);s?rt.set(t,n+e[3],r+e[0],a-e[1]-e[3],h-e[2]-e[0]):rt.set(t,n-e[3],r-e[0],a+e[1]+e[3],h+e[2]+e[0])}else s&&(i=-i),rt.set(t,n-i,r-i,a+2*i,h+2*i);o&&("width"===o?(t.y=r,t.height=h):(t.x=n,t.width=a))},minX:t=>t.width>0?t.x:t.x+t.width,minY:t=>t.height>0?t.y:t.y+t.height,maxX:t=>t.width>0?t.x+t.width:t.x,maxY:t=>t.height>0?t.y+t.height:t.y,move(t,e,i){t.x+=e,t.y+=i},getByMove:(t,e,i)=>(t=Object.assign({},t),rt.move(t,e,i),t),toOffsetOutBounds(t,e,i){e?ht(e,t):e=t,i?(e.offsetX=-(rt.maxX(i)-t.x),e.offsetY=-(rt.maxY(i)-t.y)):(e.offsetX=t.x+t.width,e.offsetY=t.y+t.height),rt.move(e,-e.offsetX,-e.offsetY)},scale(t,e,i=e){D.scale(t,e,i),t.width*=e,t.height*=i},scaleOf(t,e,i,s=i){D.scaleOf(t,e,i,s),t.width*=i,t.height*=s},tempToOuterOf:(t,e)=>(rt.copy(rt.tempBounds,t),rt.toOuterOf(rt.tempBounds,e),rt.tempBounds),getOuterOf:(t,e)=>(t=Object.assign({},t),rt.toOuterOf(t,e),t),toOuterOf(t,e,i){if(i||(i=t),0===e.b&&0===e.c){const{a:s,d:o}=e;s>0?(i.width=t.width*s,i.x=e.e+t.x*s):(i.width=t.width*-s,i.x=e.e+t.x*s-i.width),o>0?(i.height=t.height*o,i.y=e.f+t.y*o):(i.height=t.height*-o,i.y=e.f+t.y*o-i.height)}else st.x=t.x,st.y=t.y,Z(e,st,ot),X(V,ot.x,ot.y),st.x=t.x+t.width,Z(e,st,ot),G(V,ot.x,ot.y),st.y=t.y+t.height,Z(e,st,ot),G(V,ot.x,ot.y),st.x=t.x,Z(e,st,ot),G(V,ot.x,ot.y),j(V,i)},toInnerOf(t,e,i){i||(i=t),rt.move(i,-e.e,-e.f),rt.scale(i,1/e.a,1/e.d)},getFitMatrix(t,e,i=1){const s=Math.min(i,Math.min(t.width/e.width,t.height/e.height));return new U(s,0,0,s,-e.x*s,-e.y*s)},getSpread(t,e,i){const s={};return rt.copyAndSpread(s,t,e,!1,i),s},spread(t,e,i){rt.copyAndSpread(t,t,e,!1,i)},shrink(t,e,i){rt.copyAndSpread(t,t,e,!0,i)},ceil(t){const{x:e,y:i}=t;t.x=J(t.x),t.y=J(t.y),t.width=e>t.x?$(t.width+e-t.x):$(t.width),t.height=i>t.y?$(t.height+i-t.y):$(t.height)},unsign(t){t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height)},float(t,e){t.x=K(t.x,e),t.y=K(t.y,e),t.width=K(t.width,e),t.height=K(t.height,e)},add(t,e,i){Q=t.x+t.width,tt=t.y+t.height,et=e.x,it=e.y,i||(et+=e.width,it+=e.height),Q=Q>et?Q:et,tt=tt>it?tt:it,t.x=t.x<e.x?t.x:e.x,t.y=t.y<e.y?t.y:e.y,t.width=Q-t.x,t.height=tt-t.y},addList(t,e){rt.setListWithFn(t,e,void 0,!0)},setList(t,e,i=!1){rt.setListWithFn(t,e,void 0,i)},addListWithFn(t,e,i){rt.setListWithFn(t,e,i,!0)},setListWithFn(t,e,i,s=!1){let o,n=!0;for(let r=0,a=e.length;r<a;r++)o=i?i(e[r]):e[r],o&&(o.width||o.height)&&(n?(n=!1,s||ht(t,o)):at(t,o));n&&rt.reset(t)},setPoints(t,e){e.forEach(((t,e)=>0===e?X(V,t.x,t.y):G(V,t.x,t.y))),j(V,t)},setPoint(t,e){rt.set(t,e.x,e.y)},addPoint(t,e){at(t,e,!0)},getPoints(t){const{x:e,y:i,width:s,height:o}=t;return[{x:e,y:i},{x:e+s,y:i},{x:e+s,y:i+o},{x:e,y:i+o}]},hitRadiusPoint:(t,e,i)=>(i&&(e=D.tempToInnerRadiusPointOf(e,i)),e.x>=t.x-e.radiusX&&e.x<=t.x+t.width+e.radiusX&&e.y>=t.y-e.radiusY&&e.y<=t.y+t.height+e.radiusY),hitPoint:(t,e,i)=>(i&&(e=D.tempToInnerOf(e,i)),e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height),hit:(t,e,i)=>(i&&(e=rt.tempToOuterOf(e,i)),!(t.y+t.height<e.y||e.y+e.height<t.y||t.x+t.width<e.x||e.x+e.width<t.x)),includes:(t,e,i)=>(i&&(e=rt.tempToOuterOf(e,i)),t.x<=e.x&&t.y<=e.y&&t.x+t.width>=e.x+e.width&&t.y+t.height>=e.y+e.height),getIntersectData(t,e,i){if(i&&(e=rt.tempToOuterOf(e,i)),!rt.hit(t,e))return{x:0,y:0,width:0,height:0};let{x:s,y:o,width:n,height:r}=e;return Q=s+n,tt=o+r,et=t.x+t.width,it=t.y+t.height,s=s>t.x?s:t.x,o=o>t.y?o:t.y,Q=Q<et?Q:et,tt=tt<it?tt:it,n=Q-s,r=tt-o,{x:s,y:o,width:n,height:r}},intersect(t,e,i){rt.copy(t,rt.getIntersectData(t,e,i))},isSame:(t,e)=>t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height,isEmpty:t=>0===t.x&&0===t.y&&0===t.width&&0===t.height,reset(t){rt.set(t)}},rt=nt,{add:at,copy:ht}=rt;class lt{get minX(){return nt.minX(this)}get minY(){return nt.minY(this)}get maxX(){return nt.maxX(this)}get maxY(){return nt.maxY(this)}constructor(t,e,i,s){this.set(t,e,i,s)}set(t,e,i,s){return"object"==typeof t?nt.copy(this,t):nt.set(this,t,e,i,s),this}get(){const{x:t,y:e,width:i,height:s}=this;return{x:t,y:e,width:i,height:s}}clone(){return new lt(this)}move(t,e){return nt.move(this,t,e),this}scale(t,e){return nt.scale(this,t,e),this}scaleOf(t,e,i){return nt.scaleOf(this,t,e,i),this}toOuterOf(t,e){return nt.toOuterOf(this,t,e),this}toInnerOf(t,e){return nt.toInnerOf(this,t,e),this}getFitMatrix(t,e){return nt.getFitMatrix(this,t,e)}spread(t,e){return nt.spread(this,t,e),this}shrink(t,e){return nt.shrink(this,t,e),this}ceil(){return nt.ceil(this),this}unsign(){return nt.unsign(this),this}float(t){return nt.float(this,t),this}add(t){return nt.add(this,t),this}addList(t){return nt.setList(this,t,!0),this}setList(t){return nt.setList(this,t),this}addListWithFn(t,e){return nt.setListWithFn(this,t,e,!0),this}setListWithFn(t,e){return nt.setListWithFn(this,t,e),this}setPoint(t){return nt.setPoint(this,t),this}setPoints(t){return nt.setPoints(this,t),this}addPoint(t){return nt.addPoint(this,t),this}getPoints(){return nt.getPoints(this)}hitPoint(t,e){return nt.hitPoint(this,t,e)}hitRadiusPoint(t,e){return nt.hitRadiusPoint(this,t,e)}hit(t,e){return nt.hit(this,t,e)}includes(t,e){return nt.includes(this,t,e)}intersect(t,e){return nt.intersect(this,t,e),this}getIntersect(t,e){return new lt(nt.getIntersectData(this,t,e))}isSame(t){return nt.isSame(this,t)}isEmpty(){return nt.isEmpty(this)}reset(){nt.reset(this)}}const dt=new lt;class ct{constructor(t,e,i,s,o,n){"object"==typeof t?this.copy(t):this.set(t,e,i,s,o,n)}set(t=0,e=0,i=0,s=0,o=0,n=0){this.top=t,this.right=e,this.bottom=i,this.left=s,this.width=o,this.height=n}copy(t){const{top:e,right:i,bottom:s,left:o,width:n,height:r}=t;this.set(e,i,s,o,n,r)}getBoundsFrom(t){const{top:e,right:i,bottom:s,left:o,width:n,height:r}=this;return new lt(o,e,n||t.width-o-i,r||t.height-e-s)}}var ut,pt;t.Direction4=void 0,(ut=t.Direction4||(t.Direction4={}))[ut.top=0]="top",ut[ut.right=1]="right",ut[ut.bottom=2]="bottom",ut[ut.left=3]="left",t.Direction9=void 0,(pt=t.Direction9||(t.Direction9={}))[pt.topLeft=0]="topLeft",pt[pt.top=1]="top",pt[pt.topRight=2]="topRight",pt[pt.right=3]="right",pt[pt.bottomRight=4]="bottomRight",pt[pt.bottom=5]="bottom",pt[pt.bottomLeft=6]="bottomLeft",pt[pt.left=7]="left",pt[pt.center=8]="center",pt[pt["top-left"]=0]="top-left",pt[pt["top-right"]=2]="top-right",pt[pt["bottom-right"]=4]="bottom-right",pt[pt["bottom-left"]=6]="bottom-left";const _t=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];_t.forEach((t=>t.type="percent"));const gt={directionData:_t,tempPoint:{},get:ft,toPoint(t,e,i,s,o){i||(i={});const n=ft(t);i.x=n.x,i.y=n.y,"percent"===n.type&&(i.x*=e.width,i.y*=e.height,o&&(i.x-=o.x,i.y-=o.y,n.x&&(i.x-=1===n.x?o.width:.5===n.x?n.x*o.width:0),n.y&&(i.y-=1===n.y?o.height:.5===n.y?n.y*o.height:0))),s||(i.x+=e.x,i.y+=e.y)}};function ft(e){return"string"==typeof e?_t[t.Direction9[e]]:e}const{toPoint:yt}=gt,vt={toPoint(t,e,i,s,o){yt(t,i,s,o,e)}},mt={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1};class wt{constructor(t){this.repeatMap={},this.name=t}static get(t){return new wt(t)}static set filter(t){this.filterList=xt(t)}static set exclude(t){this.excludeList=xt(t)}log(...t){if(bt.enable){if(bt.filterList.length&&bt.filterList.every((t=>t!==this.name)))return;if(bt.excludeList.length&&bt.excludeList.some((t=>t===this.name)))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){bt.enable&&this.warn(...t)}warn(...t){bt.showWarn&&console.warn(this.name,...t)}repeat(t,...e){this.repeatMap[t]||(this.warn("repeat:"+t,...e),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(e){console.error(this.name,...t,e)}}}function xt(t){return t?"string"==typeof t&&(t=[t]):t=[],t}wt.filterList=[],wt.excludeList=[],wt.showWarn=!0;const bt=wt,Et=wt.get("RunTime"),kt={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(t,e){const i=s.create(s.RUNTIME);return Bt.currentId=Bt.idMap[i]=e?performance.now():Date.now(),Bt.currentName=Bt.nameMap[i]=t,Bt.nameToIdMap[t]=i,i},end(t,e){const i=Bt.idMap[t],s=Bt.nameMap[t],o=e?(performance.now()-i)/1e3:Date.now()-i;Bt.idMap[t]=Bt.nameMap[t]=Bt.nameToIdMap[s]=void 0,Et.log(s,o,"ms")},endOfName(t,e){const i=Bt.nameToIdMap[t];void 0!==i&&Bt.end(i,e)}},Bt=kt,Tt=wt.get("UICreator"),Lt={list:{},register(t){const{__tag:e}=t.prototype;Pt[e]?Tt.repeat(e):Pt[e]=t},get(t,e,i,s,o,n){const r=new Pt[t](e);return void 0!==i&&(r.x=i,s&&(r.y=s),o&&(r.width=o),n&&(r.height=n)),r}},{list:Pt}=Lt,Rt=wt.get("EventCreator"),Ct={nameList:{},register(t){let e;Object.keys(t).forEach((i=>{e=t[i],"string"==typeof e&&(St[e]?Rt.repeat(e):St[e]=t)}))},changeName(t,e){const i=St[t];if(i){const s=Object.keys(i).find((e=>i[e]===t));s&&(i[s]=e,St[e]=i)}},has(t){return!!this.nameList[t]},get:(t,...e)=>new St[t](...e)},{nameList:St}=Ct;class Ot{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let e;const{list:s}=this;for(let i=0,o=s.length;i<o;i++)if(e=s[i],e.recycled&&e.isSameSize(t))return e.recycled=!1,e.manager||(e.manager=this),e;const o=i.canvas(t);return this.add(o),o}recycle(t){t.recycled=!0}clearRecycled(){let t;const e=[];for(let i=0,s=this.list.length;i<s;i++)t=this.list[i],t.recycled?t.destroy():e.push(t);this.list=e}clear(){this.list.forEach((t=>{t.destroy()})),this.list.length=0}destroy(){this.clear()}}const Dt={default:(t,e)=>(Mt(e,t),Mt(t,e),t),assign(t,e){let i;Object.keys(e).forEach((s=>{var o;i=e[s],(null==i?void 0:i.constructor)===Object&&(null===(o=t[s])||void 0===o?void 0:o.constructor)===Object?Mt(t[s],e[s]):t[s]=e[s]}))},copyAttrs:(t,e,i)=>(i.forEach((i=>{void 0!==e[i]&&(t[i]=e[i])})),t),clone:t=>JSON.parse(JSON.stringify(t)),toMap(t){const e={};for(let i=0,s=t.length;i<s;i++)e[t[i]]=!0;return e}},{assign:Mt}=Dt;class It{get __useNaturalRatio(){return!0}get __isLinePath(){return this.path&&6===this.path.length}get __blendMode(){if(this.eraser&&"path"!==this.eraser)return"destination-out";const{blendMode:t}=this;return"pass-through"===t?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:e}=this;let i;for(let s in this)"_"!==s[0]&&(i=e?e[s]:void 0,t[s]=void 0===i?this[s]:i);return t}__setInput(t,e){this.__input||(this.__input={}),this.__input[t]=e}__getInput(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}if("path"!==t||this.__pathInputed)return this["_"+t]}__removeInput(t){this.__input&&void 0!==this.__input[t]&&(this.__input[t]=void 0)}__getInputData(t,e){const i={};if(t)if(t instanceof Array)for(let e of t)i[e]=this.__getInput(e);else for(let e in t)i[e]=this.__getInput(e);else{let t,e,{__input:s}=this;i.tag=this.__leaf.tag;for(let o in this)if("_"!==o[0]&&(t=this["_"+o],void 0!==t)){if("path"===o&&!this.__pathInputed)continue;e=s?s[o]:void 0,i[o]=void 0===e?t:e}}if(e&&e.matrix){const{a:t,b:e,c:s,d:o,e:n,f:r}=this.__leaf.__localMatrix;i.matrix={a:t,b:e,c:s,d:o,e:n,f:r}}return i}__setMiddle(t,e){this.__middle||(this.__middle={}),this.__middle[t]=e}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if("pass-through"===t.blendMode){const e=this.__leaf;t.opacity<1&&e.isBranch||e.__hasEraser||t.eraser?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}var At;t.Answer=void 0,(At=t.Answer||(t.Answer={}))[At.No=0]="No",At[At.Yes=1]="Yes",At[At.NoAndSkip=2]="NoAndSkip",At[At.YesAndSkip=3]="YesAndSkip";function Wt(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r}function zt(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))}function Ft(t){return(e,i)=>{t||(t=i),Object.defineProperty(e,i,{get(){return this.context[t]},set(e){this.context[t]=e}})}}"function"==typeof SuppressedError&&SuppressedError;const Ut=[];function Ht(){return(t,e)=>{Ut.push(e)}}const Nt=[];class Yt{set blendMode(t){"normal"===t&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||Nt)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;Ut.forEach((e=>{t=this.context[e],t&&(this[e]=t.bind(this.context))})),this.textBaseline="alphabetic"}setTransform(t,e,i,s,o,n){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,e,i,s,o,n){"object"==typeof t?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,e,i,s,o,n)}translate(t,e){}scale(t,e){}rotate(t){}fill(t,e){}stroke(t){}clip(t,e){}fillRect(t,e,i,s){}strokeRect(t,e,i,s){}clearRect(t,e,i,s){}drawImage(t,e,i,s,o,n,r,a,h){switch(arguments.length){case 9:if(e<0){const t=-e/s*a;s+=e,e=0,n+=t,a-=t}if(i<0){const t=-i/o*h;o+=i,i=0,r+=t,h-=t}this.context.drawImage(t,e,i,s,o,n,r,a,h);break;case 5:this.context.drawImage(t,e,i,s,o);break;case 3:this.context.drawImage(t,e,i)}}beginPath(){}moveTo(t,e){}lineTo(t,e){}bezierCurveTo(t,e,i,s,o,n){}quadraticCurveTo(t,e,i,s){}closePath(){}arc(t,e,i,s,o,n){}arcTo(t,e,i,s,o){}ellipse(t,e,i,s,o,n,r,a){}rect(t,e,i,s){}roundRect(t,e,i,s,o){}createConicGradient(t,e,i){}createLinearGradient(t,e,i,s){}createPattern(t,e){}createRadialGradient(t,e,i,s,o,n){}fillText(t,e,i,s){}measureText(t){}strokeText(t,e,i,s){}destroy(){this.context=null}}Wt([Ft("imageSmoothingEnabled")],Yt.prototype,"smooth",void 0),Wt([Ft("imageSmoothingQuality")],Yt.prototype,"smoothLevel",void 0),Wt([Ft("globalAlpha")],Yt.prototype,"opacity",void 0),Wt([Ft()],Yt.prototype,"fillStyle",void 0),Wt([Ft()],Yt.prototype,"strokeStyle",void 0),Wt([Ft("lineWidth")],Yt.prototype,"strokeWidth",void 0),Wt([Ft("lineCap")],Yt.prototype,"strokeCap",void 0),Wt([Ft("lineJoin")],Yt.prototype,"strokeJoin",void 0),Wt([Ft("lineDashOffset")],Yt.prototype,"dashOffset",void 0),Wt([Ft()],Yt.prototype,"miterLimit",void 0),Wt([Ft()],Yt.prototype,"shadowBlur",void 0),Wt([Ft()],Yt.prototype,"shadowColor",void 0),Wt([Ft()],Yt.prototype,"shadowOffsetX",void 0),Wt([Ft()],Yt.prototype,"shadowOffsetY",void 0),Wt([Ft()],Yt.prototype,"filter",void 0),Wt([Ft()],Yt.prototype,"font",void 0),Wt([Ft()],Yt.prototype,"fontKerning",void 0),Wt([Ft()],Yt.prototype,"fontStretch",void 0),Wt([Ft()],Yt.prototype,"fontVariantCaps",void 0),Wt([Ft()],Yt.prototype,"textAlign",void 0),Wt([Ft()],Yt.prototype,"textBaseline",void 0),Wt([Ft()],Yt.prototype,"textRendering",void 0),Wt([Ft()],Yt.prototype,"wordSpacing",void 0),Wt([Ft()],Yt.prototype,"letterSpacing",void 0),Wt([Ft()],Yt.prototype,"direction",void 0),Wt([Ht()],Yt.prototype,"setTransform",null),Wt([Ht()],Yt.prototype,"resetTransform",null),Wt([Ht()],Yt.prototype,"getTransform",null),Wt([Ht()],Yt.prototype,"save",null),Wt([Ht()],Yt.prototype,"restore",null),Wt([Ht()],Yt.prototype,"translate",null),Wt([Ht()],Yt.prototype,"scale",null),Wt([Ht()],Yt.prototype,"rotate",null),Wt([Ht()],Yt.prototype,"fill",null),Wt([Ht()],Yt.prototype,"stroke",null),Wt([Ht()],Yt.prototype,"clip",null),Wt([Ht()],Yt.prototype,"fillRect",null),Wt([Ht()],Yt.prototype,"strokeRect",null),Wt([Ht()],Yt.prototype,"clearRect",null),Wt([Ht()],Yt.prototype,"beginPath",null),Wt([Ht()],Yt.prototype,"moveTo",null),Wt([Ht()],Yt.prototype,"lineTo",null),Wt([Ht()],Yt.prototype,"bezierCurveTo",null),Wt([Ht()],Yt.prototype,"quadraticCurveTo",null),Wt([Ht()],Yt.prototype,"closePath",null),Wt([Ht()],Yt.prototype,"arc",null),Wt([Ht()],Yt.prototype,"arcTo",null),Wt([Ht()],Yt.prototype,"ellipse",null),Wt([Ht()],Yt.prototype,"rect",null),Wt([Ht()],Yt.prototype,"roundRect",null),Wt([Ht()],Yt.prototype,"createConicGradient",null),Wt([Ht()],Yt.prototype,"createLinearGradient",null),Wt([Ht()],Yt.prototype,"createPattern",null),Wt([Ht()],Yt.prototype,"createRadialGradient",null),Wt([Ht()],Yt.prototype,"fillText",null),Wt([Ht()],Yt.prototype,"measureText",null),Wt([Ht()],Yt.prototype,"strokeText",null);const{copy:Vt}=b,Xt={width:1,height:1,pixelRatio:1},Gt=["width","height","pixelRatio"];class jt extends Yt{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio}get pixelHeight(){return this.height*this.pixelRatio}get allowBackgroundColor(){return this.view&&this.parentView}constructor(t,i){super(),this.size={},this.worldTransform={},t||(t=Xt),t.pixelRatio||(t.pixelRatio=e.devicePixelRatio),this.manager=i,this.innerId=s.create(s.CNAVAS);const{width:o,height:n,pixelRatio:r}=t;this.autoLayout=!o||!n,this.size.pixelRatio=r,this.config=t,this.init()}init(){}__createContext(){const{view:t}=this,{contextSettings:e}=this.config;this.context=e?t.getContext("2d",e):t.getContext("2d"),this.__bindContext()}export(t,e){}toBlob(t,e){}toDataURL(t,e){}saveAs(t,e){}resize(t){if(this.isSameSize(t))return;let e;this.context&&!this.unreal&&this.width&&(e=this.getSameCanvas(),e.copyWorld(this)),Dt.copyAttrs(this.size,t,Gt),this.size.pixelRatio||(this.size.pixelRatio=1),this.bounds=new lt(0,0,this.width,this.height),this.context&&!this.unreal&&(this.updateViewSize(),this.smooth=this.config.smooth),this.updateClientBounds(),this.context&&!this.unreal&&e&&(this.clearWorld(e.bounds),this.copyWorld(e),e.recycle())}updateViewSize(){}updateClientBounds(){}getClientBounds(t){return t&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(t,e){}stopAutoLayout(){}setCursor(t){}setWorld(t,e){const{pixelRatio:i}=this,s=this.worldTransform;if(e){const{a:o,b:n,c:r,d:a,e:h,f:l}=e;this.setTransform(s.a=(t.a*o+t.b*r)*i,s.b=(t.a*n+t.b*a)*i,s.c=(t.c*o+t.d*r)*i,s.d=(t.c*n+t.d*a)*i,s.e=(t.e*o+t.f*r+h)*i,s.f=(t.e*n+t.f*a+l)*i)}else this.setTransform(s.a=t.a*i,s.b=t.b*i,s.c=t.c*i,s.d=t.d*i,s.e=t.e*i,s.f=t.f*i)}useWorldTransform(t){t&&(this.worldTransform=t);const e=this.worldTransform;e&&this.setTransform(e.a,e.b,e.c,e.d,e.e,e.f)}setStroke(t,e,i){e&&(this.strokeWidth=e),t&&(this.strokeStyle=t),i&&this.setStrokeOptions(i)}setStrokeOptions(t){this.strokeCap="none"===t.strokeCap?"butt":t.strokeCap,this.strokeJoin=t.strokeJoin,this.dashPattern=t.dashPattern,this.dashOffset=t.dashOffset,this.miterLimit=t.miterLimit}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,e){return!0}hitStroke(t,e){return!0}hitPixel(t,e,i=1){return!0}setWorldShadow(t,e,i,s){const{pixelRatio:o}=this;this.shadowOffsetX=t*o,this.shadowOffsetY=e*o,this.shadowBlur=i*o,this.shadowColor=s||"black"}setWorldBlur(t){const{pixelRatio:e}=this;this.filter=`blur(${t*e}px)`}copyWorld(t,e,i,s){if(s&&(this.blendMode=s),e){const{pixelRatio:s}=this;i||(i=e),this.drawImage(t.view,e.x*s,e.y*s,e.width*s,e.height*s,i.x*s,i.y*s,i.width*s,i.height*s)}else this.drawImage(t.view,0,0);s&&(this.blendMode="source-over")}copyWorldToInner(t,e,i,s){if(s&&(this.blendMode=s),e.b||e.c)this.save(),this.resetTransform(),this.copyWorld(t,e,nt.tempToOuterOf(i,e)),this.restore();else{const{pixelRatio:s}=this;this.drawImage(t.view,e.x*s,e.y*s,e.width*s,e.height*s,i.x,i.y,i.width,i.height)}s&&(this.blendMode="source-over")}copyWorldByReset(t,e,i,s,o){this.resetTransform(),this.copyWorld(t,e,i,s),o||this.useWorldTransform()}useMask(t,e,i){this.copyWorld(t,e,i,"destination-in")}useEraser(t,e,i){this.copyWorld(t,e,i,"destination-out")}fillWorld(t,e,i){i&&(this.blendMode=i),this.fillStyle=e,dt.set(t).scale(this.pixelRatio),this.fillRect(dt.x,dt.y,dt.width,dt.height),i&&(this.blendMode="source-over")}strokeWorld(t,e,i){i&&(this.blendMode=i),this.strokeStyle=e,dt.set(t).scale(this.pixelRatio),this.strokeRect(dt.x,dt.y,dt.width,dt.height),i&&(this.blendMode="source-over")}clearWorld(t,e){dt.set(t).scale(this.pixelRatio),e&&dt.ceil(),this.clearRect(dt.x,dt.y,dt.width,dt.height)}clipWorld(t,e){this.beginPath(),dt.set(t).scale(this.pixelRatio),e&&dt.ceil(),this.rect(dt.x,dt.y,dt.width,dt.height),this.clip()}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t+2,this.height*t+2)}isSameSize(t){return this.width===t.width&&this.height===t.height&&this.pixelRatio===t.pixelRatio}getSameCanvas(t,e){const s=this.manager?this.manager.get(this.size):i.canvas(Object.assign({},this.size));return s.save(),t&&(Vt(s.worldTransform,this.worldTransform),s.useWorldTransform()),e&&(s.smooth=this.smooth),s}recycle(t){this.recycled||(this.restore(),t?this.clearWorld(t,!0):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(t){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}}const Zt={creator:{},parse(t,e){},convertToCanvasData(t,e){}},Kt={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},qt=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Kt),Jt={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},$t={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},Qt=Object.assign(Object.assign({},$t),Kt),te=qt,ee={};for(let t in te)ee[te[t]]=t;const ie={};for(let t in te)ie[te[t]]=Jt[t];const se={drawRoundRect(t,e,i,s,o,n){const r=h.fourNumber(n,Math.min(s/2,o/2)),a=e+s,l=i+o;r[0]?t.moveTo(e+r[0],i):t.moveTo(e,i),r[1]?t.arcTo(a,i,a,l,r[1]):t.lineTo(a,i),r[2]?t.arcTo(a,l,e,l,r[2]):t.lineTo(a,l),r[3]?t.arcTo(e,l,e,i,r[3]):t.lineTo(e,l),r[0]?t.arcTo(e,i,a,i,r[0]):t.lineTo(e,i)}},{sin:oe,cos:ne,atan2:re,ceil:ae,abs:he,PI:le,sqrt:de,pow:ce}=Math,{setPoint:ue,addPoint:pe}=N,{set:_e}=D,{M:ge,L:fe,C:ye,Q:ve,Z:me}=qt,we={},xe={points(t,e,i,s){if(t.push(ge,e[0],e[1]),i&&e.length>5){let o,n,r,a,h,l,d,c,u,p,_,g,f,y=e.length;const v=!0===i?.5:i;s&&(y=(e=[e[y-2],e[y-1],...e,e[0],e[1],e[2],e[3]]).length);for(let i=2;i<y-2;i+=2)o=e[i-2],n=e[i-1],r=e[i],a=e[i+1],h=e[i+2],l=e[i+3],_=de(ce(r-o,2)+ce(a-n,2)),g=de(ce(h-r,2)+ce(l-a,2)),f=_+g,_=v*_/f,g=v*g/f,h-=o,l-=n,d=r-_*h,c=a-_*l,2===i?s||t.push(ve,d,c,r,a):t.push(ye,u,p,d,c,r,a),u=r+g*h,p=a+g*l;s||t.push(ve,u,p,e[y-2],e[y-1])}else for(let i=2,s=e.length;i<s;i+=2)t.push(fe,e[i],e[i+1]);s&&t.push(me)},rect(t,e,i,s,o){Zt.creator.path=t,Zt.creator.moveTo(e,i).lineTo(e+s,i).lineTo(e+s,i+o).lineTo(e,i+o).lineTo(e,i)},roundRect(t,e,i,s,o,n){Zt.creator.path=[],se.drawRoundRect(Zt.creator,e,i,s,o,n),t.push(...Zt.convertToCanvasData(Zt.creator.path,!0))},arcTo(t,e,i,s,o,n,r,a,h,u,p){const _=s-e,g=o-i,f=n-s,y=r-o;let v=re(g,_),m=re(y,f),w=m-v;if(w<0&&(w+=d),w===le||he(_+g)<1e-12||he(f+y)<1e-12)return t&&t.push(fe,s,o),h&&(ue(h,e,i),pe(h,s,o)),p&&_e(p,e,i),void(u&&_e(u,s,o));const x=_*y-f*g<0,b=x?-1:1,E=a/ne(w/2),k=s+E*ne(v+w/2+c*b),B=o+E*oe(v+w/2+c*b);return v-=c*b,m-=c*b,ke(t,k,B,a,a,0,v/l,m/l,x,h,u,p)},arc:(t,e,i,s,o,n,r,a,h,l)=>ke(t,e,i,s,s,0,o,n,r,a,h,l),ellipse(t,e,i,s,o,n,r,a,h,u,p,_){const g=n*l,f=oe(g),y=ne(g);let v=r*l,m=a*l;v>le&&(v-=d),m<0&&(m+=d);let w=m-v;w<0?w+=d:w>d&&(w-=d),h&&(w-=d);const x=ae(he(w/c)),b=w/x,E=oe(b/4),k=8/3*E*E/oe(b/2);m=v+b;let B,T,L,P,R,C,S,O,D=ne(v),M=oe(v),I=L=y*s*D-f*o*M,A=P=f*s*D+y*o*M,W=e+L,z=i+P;t&&t.push(fe,W,z),u&&ue(u,W,z),_&&_e(_,W,z);for(let n=0;n<x;n++)B=ne(m),T=oe(m),L=y*s*B-f*o*T,P=f*s*B+y*o*T,R=e+I-k*(y*s*M+f*o*D),C=i+A-k*(f*s*M-y*o*D),S=e+L+k*(y*s*T+f*o*B),O=i+P+k*(f*s*T-y*o*B),t&&t.push(ye,R,C,S,O,e+L,i+P),u&&Ee(e+I,i+A,R,C,S,O,e+L,i+P,u,!0),I=L,A=P,D=B,M=T,v=m,m+=b;p&&_e(p,e+L,i+P)},quadraticCurveTo(t,e,i,s,o,n,r){t.push(ye,(e+2*s)/3,(i+2*o)/3,(n+2*s)/3,(r+2*o)/3,n,r)},toTwoPointBoundsByQuadraticCurve(t,e,i,s,o,n,r,a){Ee(t,e,(t+2*i)/3,(e+2*s)/3,(o+2*i)/3,(n+2*s)/3,o,n,r,a)},toTwoPointBounds(t,e,i,s,o,n,r,a,h,l){const d=[];let c,u,p,_,g,f,y,v,m=t,w=i,x=o,b=r;for(let t=0;t<2;++t)if(1==t&&(m=e,w=s,x=n,b=a),c=-3*m+9*w-9*x+3*b,u=6*m-12*w+6*x,p=3*w-3*m,Math.abs(c)<1e-12){if(Math.abs(u)<1e-12)continue;_=-p/u,0<_&&_<1&&d.push(_)}else y=u*u-4*p*c,v=Math.sqrt(y),y<0||(g=(-u+v)/(2*c),0<g&&g<1&&d.push(g),f=(-u-v)/(2*c),0<f&&f<1&&d.push(f));l?pe(h,t,e):ue(h,t,e),pe(h,r,a);for(let l=0,c=d.length;l<c;l++)be(d[l],t,e,i,s,o,n,r,a,we),pe(h,we.x,we.y)},getPointAndSet(t,e,i,s,o,n,r,a,h,l){const d=1-t,c=d*d*d,u=3*d*d*t,p=3*d*t*t,_=t*t*t;l.x=c*e+u*s+p*n+_*a,l.y=c*i+u*o+p*r+_*h},getPoint(t,e,i,s,o,n,r,a,h){const l={};return be(t,e,i,s,o,n,r,a,h,l),l}},{getPointAndSet:be,toTwoPointBounds:Ee,ellipse:ke}=xe,{sin:Be,cos:Te,sqrt:Le,atan2:Pe}=Math,{ellipse:Re}=xe,Ce={ellipticalArc(t,i,s,o,n,r,a,h,c,u,p){const _=(c-i)/2,g=(u-s)/2,f=r*l,y=Be(f),v=Te(f),m=-v*_-y*g,w=-v*g+y*_,x=o*o,b=n*n,E=w*w,k=m*m,B=x*b-x*E-b*k;let T=0;if(B<0){const t=Le(1-B/(x*b));o*=t,n*=t}else T=(a===h?-1:1)*Le(B/(x*E+b*k));const L=T*o*w/n,P=-T*n*m/o,R=Pe((w-P)/n,(m-L)/o),C=Pe((-w-P)/n,(-m-L)/o);let S=C-R;0===h&&S>0?S-=d:1===h&&S<0&&(S+=d);const O=i+_+v*L-y*P,D=s+g+y*L+v*P,M=S<0?1:0;p||e.ellipseToCurve?Re(t,O,D,o,n,r,R/l,C/l,M):o!==n||r?t.push(qt.G,O,D,o,n,r,R/l,C/l,M):t.push(qt.O,O,D,o,R/l,C/l,M)}},{M:Se,m:Oe,L:De,l:Me,H:Ie,h:Ae,V:We,v:ze,C:Fe,c:Ue,S:He,s:Ne,Q:Ye,q:Ve,T:Xe,t:Ge,A:je,a:Ze,Z:Ke,z:qe,N:Je,D:$e,X:Qe,G:ti,F:ei,O:ii,P:si,U:oi}=qt,{rect:ni,roundRect:ri,arcTo:ai,arc:hi,ellipse:li,quadraticCurveTo:di}=xe,{ellipticalArc:ci}=Ce,ui=wt.get("PathConvert"),pi={},_i={current:{dot:0},stringify(t,e){let i,s,o,n=0,r=t.length,a="";for(;n<r;){s=t[n],i=ie[s],a+=s===o?" ":ee[s];for(let s=1;s<i;s++)a+=h.float(t[n+s],e),s===i-1||(a+=" ");o=s,n+=i}return a},parse(t,e){let i,s,o,n="";const r=[],a=e?Qt:$t;for(let e=0,h=t.length;e<h;e++)s=t[e],mt[s]?("."===s&&(gi.dot&&(fi(r,n),n=""),gi.dot++),"0"===n&&"."!==s&&(fi(r,n),n=""),n+=s):qt[s]?(n&&(fi(r,n),n=""),gi.name=qt[s],gi.length=Jt[s],gi.index=0,fi(r,gi.name),!i&&a[s]&&(i=!0)):"-"===s||"+"===s?"e"===o||"E"===o?n+=s:(n&&fi(r,n),n=s):n&&(fi(r,n),n=""),o=s;return n&&fi(r,n),i?_i.toCanvasData(r,e):r},toCanvasData(t,e){let i,s,o,n,r,a=0,h=0,l=0,d=0,c=0,u=t.length;const p=[];for(;c<u;){switch(o=t[c],o){case Oe:t[c+1]+=a,t[c+2]+=h;case Se:a=t[c+1],h=t[c+2],p.push(Se,a,h),c+=3;break;case Ae:t[c+1]+=a;case Ie:a=t[c+1],p.push(De,a,h),c+=2;break;case ze:t[c+1]+=h;case We:h=t[c+1],p.push(De,a,h),c+=2;break;case Me:t[c+1]+=a,t[c+2]+=h;case De:a=t[c+1],h=t[c+2],p.push(De,a,h),c+=3;break;case Ne:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,o=He;case He:r=n===Fe||n===He,l=r?2*a-i:t[c+1],d=r?2*h-s:t[c+2],i=t[c+1],s=t[c+2],a=t[c+3],h=t[c+4],p.push(Fe,l,d,i,s,a,h),c+=5;break;case Ue:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,t[c+5]+=a,t[c+6]+=h,o=Fe;case Fe:i=t[c+3],s=t[c+4],a=t[c+5],h=t[c+6],p.push(Fe,t[c+1],t[c+2],i,s,a,h),c+=7;break;case Ge:t[c+1]+=a,t[c+2]+=h,o=Xe;case Xe:r=n===Ye||n===Xe,i=r?2*a-i:t[c+1],s=r?2*h-s:t[c+2],e?di(p,a,h,i,s,t[c+1],t[c+2]):p.push(Ye,i,s,t[c+1],t[c+2]),a=t[c+1],h=t[c+2],c+=3;break;case Ve:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,o=Ye;case Ye:i=t[c+1],s=t[c+2],e?di(p,a,h,i,s,t[c+3],t[c+4]):p.push(Ye,i,s,t[c+3],t[c+4]),a=t[c+3],h=t[c+4],c+=5;break;case Ze:t[c+6]+=a,t[c+7]+=h;case je:ci(p,a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],e),a=t[c+6],h=t[c+7],c+=8;break;case qe:case Ke:p.push(Ke),c++;break;case Je:a=t[c+1],h=t[c+2],e?ni(p,a,h,t[c+3],t[c+4]):yi(p,t,c,5),c+=5;break;case $e:a=t[c+1],h=t[c+2],e?ri(p,a,h,t[c+3],t[c+4],[t[c+5],t[c+6],t[c+7],t[c+8]]):yi(p,t,c,9),c+=9;break;case Qe:a=t[c+1],h=t[c+2],e?ri(p,a,h,t[c+3],t[c+4],t[c+5]):yi(p,t,c,6),c+=6;break;case ti:li(e?p:yi(p,t,c,9),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],t[c+8],null,pi),a=pi.x,h=pi.y,c+=9;break;case ei:e?li(p,t[c+1],t[c+2],t[c+3],t[c+4],0,0,360,!1):yi(p,t,c,5),a=t[c+1]+t[c+3],h=t[c+2],c+=5;break;case ii:hi(e?p:yi(p,t,c,7),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],null,pi),a=pi.x,h=pi.y,c+=7;break;case si:e?hi(p,t[c+1],t[c+2],t[c+3],0,360,!1):yi(p,t,c,4),a=t[c+1]+t[c+3],h=t[c+2],c+=4;break;case oi:ai(e?p:yi(p,t,c,6),a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],null,pi),a=pi.x,h=pi.y,c+=6;break;default:return ui.error(`command: ${o} [index:${c}]`,t),p}n=o}return p},copyData(t,e,i,s){for(let o=i,n=i+s;o<n;o++)t.push(e[o])},pushData(t,e){gi.index===gi.length&&(gi.index=1,t.push(gi.name)),t.push(Number(e)),gi.index++,gi.dot=0}},{current:gi,pushData:fi,copyData:yi}=_i,{M:vi,L:mi,C:wi,Q:xi,Z:bi,N:Ei,D:ki,X:Bi,G:Ti,F:Li,O:Pi,P:Ri,U:Ci}=qt,{getMinDistanceFrom:Si,getRadianFrom:Oi}=D,{tan:Di,min:Mi,abs:Ii}=Math,Ai={},Wi={beginPath(t){t.length=0},moveTo(t,e,i){t.push(vi,e,i)},lineTo(t,e,i){t.push(mi,e,i)},bezierCurveTo(t,e,i,s,o,n,r){t.push(wi,e,i,s,o,n,r)},quadraticCurveTo(t,e,i,s,o){t.push(xi,e,i,s,o)},closePath(t){t.push(bi)},rect(t,e,i,s,o){t.push(Ei,e,i,s,o)},roundRect(t,e,i,s,o,n){if("number"==typeof n)t.push(Bi,e,i,s,o,n);else{const r=h.fourNumber(n);r?t.push(ki,e,i,s,o,...r):t.push(Ei,e,i,s,o)}},ellipse(t,e,i,s,o,n,r,a,h){void 0===n?t.push(Li,e,i,s,o):(void 0===r&&(r=0),void 0===a&&(a=360),t.push(Ti,e,i,s,o,n,r,a,h?1:0))},arc(t,e,i,s,o,n,r){void 0===o?t.push(Ri,e,i,s):(void 0===n&&(n=360),t.push(Pi,e,i,s,o,n,r?1:0))},arcTo(t,e,i,s,o,n,r,a){if(void 0!==r){const h=Di(Oi(r,a,e,i,s,o)/2)*(Si(r,a,e,i,s,o)/2);t.push(Ci,e,i,s,o,Mi(n,Ii(h)))}else t.push(Ci,e,i,s,o,n)},drawEllipse(t,e,i,s,o,n,r,a,h){xe.ellipse(null,e,i,s,o,void 0===n?0:n,void 0===r?0:r,void 0===a?360:a,h,null,null,Ai),t.push(vi,Ai.x,Ai.y),zi(t,e,i,s,o,n,r,a,h)},drawArc(t,e,i,s,o,n,r){xe.arc(null,e,i,s,void 0===o?0:o,void 0===n?360:n,r,null,null,Ai),t.push(vi,Ai.x,Ai.y),Fi(t,e,i,s,o,n,r)},drawPoints(t,e,i,s){xe.points(t,e,i,s)}},{ellipse:zi,arc:Fi}=Wi,{moveTo:Ui,lineTo:Hi,quadraticCurveTo:Ni,bezierCurveTo:Yi,closePath:Vi,beginPath:Xi,rect:Gi,roundRect:ji,ellipse:Zi,arc:Ki,arcTo:qi,drawEllipse:Ji,drawArc:$i,drawPoints:Qi}=Wi;class ts{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.clearPath=this.beginPath,this.set(t)}set(t){return this.__path=t?"string"==typeof t?Zt.parse(t):t:[],this}beginPath(){return Xi(this.__path),this.paint(),this}moveTo(t,e){return Ui(this.__path,t,e),this.paint(),this}lineTo(t,e){return Hi(this.__path,t,e),this.paint(),this}bezierCurveTo(t,e,i,s,o,n){return Yi(this.__path,t,e,i,s,o,n),this.paint(),this}quadraticCurveTo(t,e,i,s){return Ni(this.__path,t,e,i,s),this.paint(),this}closePath(){return Vi(this.__path),this.paint(),this}rect(t,e,i,s){return Gi(this.__path,t,e,i,s),this.paint(),this}roundRect(t,e,i,s,o){return ji(this.__path,t,e,i,s,o),this.paint(),this}ellipse(t,e,i,s,o,n,r,a){return Zi(this.__path,t,e,i,s,o,n,r,a),this.paint(),this}arc(t,e,i,s,o,n){return Ki(this.__path,t,e,i,s,o,n),this.paint(),this}arcTo(t,e,i,s,o){return qi(this.__path,t,e,i,s,o),this.paint(),this}drawEllipse(t,e,i,s,o,n,r,a){return Ji(this.__path,t,e,i,s,o,n,r,a),this.paint(),this}drawArc(t,e,i,s,o,n){return $i(this.__path,t,e,i,s,o,n),this.paint(),this}drawPoints(t,e,i){return Qi(this.__path,t,e,i),this.paint(),this}paint(){}}const{M:es,L:is,C:ss,Q:os,Z:ns,N:rs,D:as,X:hs,G:ls,F:ds,O:cs,P:us,U:ps}=qt,_s=wt.get("PathDrawer"),gs={drawPathByData(t,e){if(!e)return;let i,s=0,o=e.length;for(;s<o;)switch(i=e[s],i){case es:t.moveTo(e[s+1],e[s+2]),s+=3;break;case is:t.lineTo(e[s+1],e[s+2]),s+=3;break;case ss:t.bezierCurveTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],e[s+6]),s+=7;break;case os:t.quadraticCurveTo(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case ns:t.closePath(),s+=1;break;case rs:t.rect(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case as:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],[e[s+5],e[s+6],e[s+7],e[s+8]]),s+=9;break;case hs:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;case ls:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]*l,e[s+6]*l,e[s+7]*l,e[s+8]),s+=9;break;case ds:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],0,0,d,!1),s+=5;break;case cs:t.arc(e[s+1],e[s+2],e[s+3],e[s+4]*l,e[s+5]*l,e[s+6]),s+=7;break;case us:t.arc(e[s+1],e[s+2],e[s+3],0,d,!1),s+=4;break;case ps:t.arcTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;default:return void _s.error(`command: ${i} [index:${s}]`,e)}}},{M:fs,L:ys,C:vs,Q:ms,Z:ws,N:xs,D:bs,X:Es,G:ks,F:Bs,O:Ts,P:Ls,U:Ps}=qt,{toTwoPointBounds:Rs,toTwoPointBoundsByQuadraticCurve:Cs,arcTo:Ss,arc:Os,ellipse:Ds}=xe,{addPointBounds:Ms,copy:Is,addPoint:As,setPoint:Ws,addBounds:zs,toBounds:Fs}=N,Us=wt.get("PathBounds");let Hs,Ns,Ys;const Vs={},Xs={},Gs={},js={toBounds(t,e){js.toTwoPointBounds(t,Xs),Fs(Xs,e)},toTwoPointBounds(t,e){if(!t||!t.length)return Ws(e,0,0);let i,s,o,n,r,a=0,h=0,l=0;const d=t.length;for(;a<d;)switch(i=t[a],0===a&&(i===ws||i===vs||i===ms?Ws(e,h,l):Ws(e,t[a+1],t[a+2])),i){case fs:case ys:h=t[a+1],l=t[a+2],As(e,h,l),a+=3;break;case vs:n=t[a+5],r=t[a+6],Rs(h,l,t[a+1],t[a+2],t[a+3],t[a+4],n,r,Vs),Ms(e,Vs),h=n,l=r,a+=7;break;case ms:s=t[a+1],o=t[a+2],n=t[a+3],r=t[a+4],Cs(h,l,s,o,n,r,Vs),Ms(e,Vs),h=n,l=r,a+=5;break;case ws:a+=1;break;case xs:h=t[a+1],l=t[a+2],zs(e,h,l,t[a+3],t[a+4]),a+=5;break;case bs:case Es:h=t[a+1],l=t[a+2],zs(e,h,l,t[a+3],t[a+4]),a+=i===bs?9:6;break;case ks:Ds(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],Vs,Gs),0===a?Is(e,Vs):Ms(e,Vs),h=Gs.x,l=Gs.y,a+=9;break;case Bs:h=t[a+1],l=t[a+2],Ns=t[a+3],Ys=t[a+4],zs(e,h-Ns,l-Ys,2*Ns,2*Ys),h+=Ns,a+=5;break;case Ts:Os(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],Vs,Gs),0===a?Is(e,Vs):Ms(e,Vs),h=Gs.x,l=Gs.y,a+=7;break;case Ls:h=t[a+1],l=t[a+2],Hs=t[a+3],zs(e,h-Hs,l-Hs,2*Hs,2*Hs),h+=Hs,a+=4;break;case Ps:Ss(null,h,l,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],Vs,Gs),0===a?Is(e,Vs):Ms(e,Vs),h=Gs.x,l=Gs.y,a+=6;break;default:return void Us.error(`command: ${i} [index:${a}]`,t)}}},{M:Zs,L:Ks,C:qs,Z:Js}=qt,{getCenterX:$s,getCenterY:Qs}=D,{arcTo:to}=Wi,eo={smooth(t,e,i){let s,o=0,n=0,r=0,a=0,h=0,l=0,d=0,c=0,u=0;const p=t.length,_=[];for(;o<p;)switch(s=t[o],s){case Zs:a=c=t[o+1],h=u=t[o+2],o+=3,t[o]===Ks?(l=t[o+1],d=t[o+2],_.push(Zs,$s(a,l),Qs(h,d))):_.push(Zs,a,h);break;case Ks:switch(n=t[o+1],r=t[o+2],o+=3,t[o]){case Ks:to(_,n,r,t[o+1],t[o+2],e,c,u);break;case Js:to(_,n,r,a,h,e,c,u);break;default:_.push(Ks,n,r)}c=n,u=r;break;case qs:_.push(qs,t[o+1],t[o+2],t[o+3],t[o+4],t[o+5],t[o+6]),o+=7;break;case Js:to(_,a,h,l,d,e,c,u),_.push(Js),o+=1}return s!==Js&&(_[1]=a,_[2]=h),_}};Zt.creator=new ts,Zt.parse=_i.parse,Zt.convertToCanvasData=_i.toCanvasData;const io=new ts,{drawRoundRect:so}=se;function oo(t){!function(t){t&&!t.roundRect&&(t.roundRect=function(t,e,i,s,o){so(this,t,e,i,s,o)})}(t)}const no={opacityTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType:t=>!t||t.startsWith("image")?t:("jpg"===t&&(t="jpeg"),"image/"+t),fileType(t){const e=t.split(".");return e[e.length-1]},isOpaqueImage(t){const e=ro.fileType(t);return["jpg","jpeg"].some((t=>t===e))},getExportOptions(t){switch(typeof t){case"object":return t;case"number":return{quality:t};case"boolean":return{blob:t};default:return{}}}},ro=no;ro.opacityTypes.forEach((t=>ro.upperCaseTypeMap[t]=t.toUpperCase()));const ao=wt.get("TaskProcessor");class ho{constructor(t){this.parallel=!0,this.time=1,this.id=s.create(s.TASK),this.task=t}run(){return zt(this,void 0,void 0,(function*(){try{this.task&&!this.isComplete&&this.parent.running&&(yield this.task())}catch(t){ao.error(t)}}))}complete(){this.isComplete=!0,this.parent=null,this.task=null}cancel(){this.isCancel=!0,this.complete()}}class lo{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let e=0,i=0;for(let s=0;s<t;s++)s<=this.finishedIndex?(i+=this.list[s].time,s===this.finishedIndex&&(e=i)):e+=this.list[s].time;return this.isComplete?1:i/e}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&Dt.assign(this.config,t),this.empty()}add(t,e){let i,s,o,n;const r=new ho(t);return r.parent=this,"number"==typeof e?n=e:e&&(s=e.parallel,i=e.start,o=e.time,n=e.delay),o&&(r.time=o),!1===s&&(r.parallel=!1),void 0===n?this.push(r,i):(this.delayNumber++,setTimeout((()=>{this.delayNumber&&(this.delayNumber--,this.push(r,i))}),n)),this.isComplete=!1,r}push(t,e){this.list.push(t),!1===e||this.timer||(this.timer=setTimeout((()=>this.start())))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach((t=>{t.isComplete||t.cancel()})),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];t?t.run().then((()=>{this.onTask(t),this.index++,this.nextTask()})).catch((t=>{this.onError(t)})):this.nextTask()}runParallelTasks(){this.parallelList.forEach((t=>this.runParallelTask(t)))}runParallelTask(t){t.run().then((()=>{this.onTask(t),this.fillParallelTask()})).catch((t=>{this.onParallelError(t)}))}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout((()=>this.run()))}setParallelList(){let t;this.parallelList=[],this.parallelSuccessNumber=0;let e=this.index+this.config.parallel;e>this.list.length&&(e=this.list.length);for(let i=this.index;i<e&&(t=this.list[i],t.parallel);i++)this.parallelList.push(t)}fillParallelTask(){let t;const e=this.parallelList;this.parallelSuccessNumber++,e.pop();const i=e.length,s=this.finishedIndex+i;if(e.length){if(!this.running)return;s<this.total&&(t=this.list[s],t&&t.parallel&&(e.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach((t=>{t.parallel=!1})),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const co={map:{},recycledList:[],tasker:new lo,patternTasker:new lo,get isComplete(){return uo.tasker.isComplete},get(t){let e=uo.map[t.url];return e||(e=i.image(t),uo.map[t.url]=e),e.use++,e},recycle(t){t.use--,setTimeout((()=>{t.use||uo.recycledList.push(t)}))},clearRecycled(){const t=uo.recycledList;t.length>100&&(t.forEach((t=>{!t.use&&t.url&&(delete uo.map[t.url],t.destroy())})),t.length=0)},hasOpacityPixel:t=>no.opacityTypes.some((e=>uo.isFormat(e,t))),isFormat(t,e){if(e.format===t)return!0;const{url:i}=e;if(i.startsWith("data:")){if(i.startsWith("data:"+no.mineType(t)))return!0}else if(i.includes("."+t)||i.includes("."+no.upperCaseTypeMap[t]))return!0;return!1},destroy(){uo.map={},uo.recycledList=[]}},uo=co,{IMAGE:po,create:_o}=s;class go{get url(){return this.config.url}get completed(){return this.ready||!!this.error}constructor(t){this.use=0,this.waitComplete=[],this.innerId=_o(po),this.config=t||{url:""},this.isSVG=co.isFormat("svg",t),this.hasOpacityPixel=co.hasOpacityPixel(t)}load(t,i){return this.loading||(this.loading=!0,co.tasker.add((()=>zt(this,void 0,void 0,(function*(){return yield e.origin.loadImage(this.url).then((t=>{this.ready=!0,this.width=t.naturalWidth||t.width,this.height=t.naturalHeight||t.height,this.view=t,this.onComplete(!0)})).catch((t=>{this.error=t,this.onComplete(!1)}))}))))),this.waitComplete.push(t,i),this.waitComplete.length-2}unload(t,e){const i=this.waitComplete;if(e){const e=i[t+1];e&&e({type:"stop"})}i[t]=i[t+1]=void 0}onComplete(t){let e;this.waitComplete.forEach(((i,s)=>{e=s%2,i&&(t?e||i(this):e&&i(this.error))})),this.waitComplete.length=0,this.loading=!1}getCanvas(t,i,s,o){if(t||(t=this.width),i||(i=this.height),this.cache){let{params:t,data:e}=this.cache;for(let i in t)if(t[i]!==arguments[i]){e=null;break}if(e)return e}const n=e.origin.createCanvas(t,i),r=n.getContext("2d");return s&&(r.globalAlpha=s),r.drawImage(this.view,0,0,t,i),this.cache=this.use>1?{data:n,params:arguments}:null,n}getPattern(t,i,s,o){const n=e.canvas.createPattern(t,i);try{s&&n.setTransform&&(n.setTransform(s),s=null)}catch(t){}return o&&(o.transform=s),n}destroy(){this.config={url:""},this.cache=null,this.waitComplete.length=0}}function fo(t,e,i,s){s||(i.configurable=i.enumerable=!0),Object.defineProperty(t,e,i)}function yo(t,e){return Object.getOwnPropertyDescriptor(t,e)}function vo(t,e){return(i,s)=>wo(i,s,t,e&&e(s))}function mo(t){return t}function wo(t,e,i,s){const o={get(){return this.__getAttr(e)},set(t){this.__setAttr(e,t)}};fo(t,e,Object.assign(o,s||{})),Vo(t,e,i)}function xo(t){return vo(t)}function bo(t,e){return vo(t,(t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}})))}function Eo(t){return vo(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__hasAutoLayout=!!e,this.__local||this.__layout.createLocal())}})))}function ko(t,e){return vo(t,(t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}})))}function Bo(t,e){return vo(t,(t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}})))}function To(t,e){return vo(t,(t=>({set(i){this.__setAttr(t,i,e)&&Po(this)}})))}function Lo(t){return vo(t,(t=>({set(e){this.__setAttr(t,e)&&(Po(this),this.__.__removeNaturalSize())}})))}function Po(t){t.__layout.boxChanged||t.__layout.boxChange(),t.__hasAutoLayout&&(t.__layout.matrixChanged||t.__layout.matrixChange())}function Ro(t){return vo(t,(t=>({set(e){const i=this.__;2!==i.__pathInputed&&(i.__pathInputed=e?1:0),e||(i.__pathForRender=void 0),this.__setAttr(t,e),Po(this)}})))}const Co=To;function So(t){return vo(t,(t=>({set(e){this.__setAttr(t,e)&&Oo(this)}})))}function Oo(t){t.__layout.strokeChanged||t.__layout.strokeChange(),t.__.__useArrow&&Po(t)}const Do=So;function Mo(t){return vo(t,(t=>({set(e){this.__setAttr(t,e),this.__layout.renderChanged||this.__layout.renderChange()}})))}function Io(t){return vo(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}})))}function Ao(t){return vo(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange())}})))}function Wo(t){return vo(t,(t=>({set(e){const i=this.visible;this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange(),0!==i&&0!==e||Po(this))}})))}function zo(t){return vo(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange(),this.waitParent((()=>{this.parent.__layout.childrenSortChange()})))}})))}function Fo(t){return vo(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent((()=>{this.parent.__updateMask(e)})))}})))}function Uo(t){return vo(t,(t=>({set(e){this.__setAttr(t,e)&&this.waitParent((()=>{this.parent.__updateEraser(e)}))}})))}function Ho(t){return vo(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.hitCanvasChanged=!0,wt.showHitView&&(this.__layout.surfaceChanged||this.__layout.surfaceChange()),this.leafer&&this.leafer.updateCursor())}})))}function No(t){return vo(t,(t=>({set(e){this.__setAttr(t,e),this.leafer&&this.leafer.updateCursor()}})))}function Yo(t){return(e,i)=>{fo(e,"__DataProcessor",{get:()=>t})}}function Vo(t,e,i){const s=t.__DataProcessor.prototype,o="_"+e,n=function(t){return"set"+t.charAt(0).toUpperCase()+t.slice(1)}(e),r={get(){const t=this[o];return void 0===t?i:t},set(t){this[o]=t}};void 0===i?r.get=function(){return this[o]}:"width"===e?r.get=function(){const t=this[o];if(void 0===t){const t=this;return t._height&&t.__naturalWidth&&t.__useNaturalRatio?t._height*t.__naturalWidth/t.__naturalHeight:t.__naturalWidth||i}return t}:"height"===e&&(r.get=function(){const t=this[o];if(void 0===t){const t=this;return t._width&&t.__naturalHeight&&t.__useNaturalRatio?t._width*t.__naturalHeight/t.__naturalWidth:t.__naturalHeight||i}return t});let a,h=s;for(;!a&&h;)a=yo(h,e),h=h.__proto__;a&&a.set&&(r.set=a.set),s[n]&&(r.set=s[n],delete s[n]),fo(s,e,r)}const Xo=new wt("rewrite"),Go=[],jo=["destroy","constructor"];function Zo(t){return(e,i)=>{Go.push({name:e.constructor.name+"."+i,run:()=>{e[i]=t}})}}function Ko(){return t=>{qo()}}function qo(t){Go.length&&(Go.forEach((e=>{t&&Xo.error(e.name,"Class@rewriteAble()"),e.run()})),Go.length=0)}function Jo(t,e){return i=>{var s;(t.prototype?(s=t.prototype,Object.getOwnPropertyNames(s)):Object.keys(t)).forEach((s=>{if(!(jo.includes(s)||e&&e.includes(s)))if(t.prototype){yo(t.prototype,s).writable&&(i.prototype[s]=t.prototype[s])}else i.prototype[s]=t[s]}))}}function $o(){return t=>{Lt.register(t)}}function Qo(){return t=>{Ct.register(t)}}setTimeout((()=>qo(!0)));const{copy:tn,toInnerPoint:en,toOuterPoint:sn,scaleOfOuter:on,rotateOfOuter:nn,skewOfOuter:rn,multiplyParent:an,divideParent:hn,getLayout:ln}=b,dn={},cn={updateAllMatrix(t,e,i){if(e&&t.__hasAutoLayout&&t.__layout.matrixChanged&&(i=!0),_n(t,e,i),t.isBranch){const{children:s}=t;for(let t=0,o=s.length;t<o;t++)pn(s[t],e,i)}},updateMatrix(t,e,i){const s=t.__layout;e?i&&(s.waitAutoLayout=!0,t.__hasAutoLayout&&(s.matrixChanged=!1)):s.waitAutoLayout&&(s.waitAutoLayout=!1),s.matrixChanged&&t.__updateLocalMatrix(),s.waitAutoLayout||t.__updateWorldMatrix()},updateBounds(t){const e=t.__layout;e.boundsChanged&&t.__updateLocalBounds(),e.waitAutoLayout||t.__updateWorldBounds()},updateAllWorldOpacity(t){if(t.__updateWorldOpacity(),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)gn(e[t])}},updateAllChange(t){if(gn(t),t.__updateChange(),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)fn(e[t])}},worldHittable(t){for(;t;){if(!t.__.hittable)return!1;t=t.parent}return!0},moveWorld(t,e,i=0,s){const o="object"==typeof e?Object.assign({},e):{x:e,y:i};s?sn(t.localTransform,o,o,!0):t.parent&&en(t.parent.worldTransform,o,o,!0),un.moveLocal(t,o.x,o.y)},moveLocal(t,e,i=0){"object"==typeof e?(t.x+=e.x,t.y+=e.y):(t.x+=e,t.y+=i)},zoomOfWorld(t,e,i,s,o){un.zoomOfLocal(t,vn(t,e),i,s,o)},zoomOfLocal(t,e,i,s=i,o){tn(dn,t.__localMatrix),on(dn,e,i,s),t.origin||t.around?un.setTransform(t,dn,o):(yn(t,dn),t.scaleResize(i,s,!0!==o))},rotateOfWorld(t,e,i){un.rotateOfLocal(t,vn(t,e),i)},rotateOfLocal(t,e,i){tn(dn,t.__localMatrix),nn(dn,e,i),t.origin||t.around?un.setTransform(t,dn):(yn(t,dn),t.rotation=h.formatRotation(t.rotation+i))},skewOfWorld(t,e,i,s,o){un.skewOfLocal(t,vn(t,e),i,s,o)},skewOfLocal(t,e,i,s=0,o){tn(dn,t.__localMatrix),rn(dn,e,i,s),un.setTransform(t,dn,o)},transformWorld(t,e,i){tn(dn,t.worldTransform),an(dn,e),t.parent&&hn(dn,t.parent.worldTransform),un.setTransform(t,dn,i)},transform(t,e,i){tn(dn,t.localTransform),an(dn,e),un.setTransform(t,dn,i)},setTransform(t,e,i){const s=ln(e,t.origin&&un.getInnerOrigin(t,t.origin),t.around&&un.getInnerOrigin(t,t.around));if(i){const e=s.scaleX/t.scaleX,o=s.scaleY/t.scaleY;delete s.scaleX,delete s.scaleY,t.set(s),t.scaleResize(e,o,!0!==i)}else t.set(s)},getFlipTransform(t,e){const i={a:1,b:0,c:0,d:1,e:0,f:0},s="x"===e?1:-1;return on(i,un.getLocalOrigin(t,"center"),-1*s,1*s),i},getLocalOrigin:(t,e)=>D.tempToOuterOf(un.getInnerOrigin(t,e),t.localTransform),getInnerOrigin(t,e){const i={};return gt.toPoint(e,t.boxBounds,i),i},getRelativeWorld:(t,e,i)=>(tn(dn,t.worldTransform),hn(dn,e.worldTransform),i?dn:Object.assign({},dn)),drop(t,e,i,s){t.setTransform(un.getRelativeWorld(t,e,!0),s),e.add(t,i)},hasParent(t,e){if(!e)return!1;for(;t;){if(e===t)return!0;t=t.parent}}},un=cn,{updateAllMatrix:pn,updateMatrix:_n,updateAllWorldOpacity:gn,updateAllChange:fn}=un;function yn(t,e){const{e:i,f:s}=t.__localMatrix;t.x+=e.e-i,t.y+=e.f-s}function vn(t,e){return t.__layout.update(),t.parent?D.tempToInnerOf(e,t.parent.__world):e}const mn={worldBounds:t=>t.__world,localBoxBounds:t=>t.__.eraser||0===t.__.visible?null:t.__local||t.__layout,localStrokeBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localStrokeBounds,localRenderBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localRenderBounds,maskLocalBoxBounds:t=>t.__.mask?t.__localBoxBounds:null,maskLocalStrokeBounds:t=>t.__.mask?t.__layout.localStrokeBounds:null,maskLocalRenderBounds:t=>t.__.mask?t.__layout.localRenderBounds:null,excludeRenderBounds:(t,e)=>!(!e.bounds||e.bounds.hit(t.__world,e.matrix))||!(!e.hideBounds||!e.hideBounds.includes(t.__world,e.matrix))},{updateBounds:wn}=cn,xn={sort:(t,e)=>t.__.zIndex===e.__.zIndex?t.__tempNumber-e.__tempNumber:t.__.zIndex-e.__.zIndex,pushAllChildBranch(t,e){if(t.__tempNumber=1,t.__.__childBranchNumber){const{children:i}=t;for(let s=0,o=i.length;s<o;s++)(t=i[s]).isBranch&&(t.__tempNumber=1,e.add(t),bn(t,e))}},pushAllParent(t,e){const{keys:i}=e;if(i)for(;t.parent&&void 0===i[t.parent.innerId];)e.add(t.parent),t=t.parent;else for(;t.parent;)e.add(t.parent),t=t.parent},pushAllBranchStack(t,e){let i=e.length;const{children:s}=t;for(let t=0,i=s.length;t<i;t++)s[t].isBranch&&e.push(s[t]);for(let t=i,s=e.length;t<s;t++)En(e[t],e)},updateBounds(t,e){const i=[t];En(t,i),kn(i,e)},updateBoundsByBranchStack(t,e){let i,s;for(let o=t.length-1;o>-1;o--){i=t[o],s=i.children;for(let t=0,e=s.length;t<e;t++)wn(s[t]);e&&e===i||wn(i)}}},{pushAllChildBranch:bn,pushAllBranchStack:En,updateBoundsByBranchStack:kn}=xn,Bn={run(t){if(t&&t.length){const e=t.length;for(let i=0;i<e;i++)t[i]();t.length===e?t.length=0:t.splice(0,e)}}},{getRelativeWorld:Tn}=cn,{toOuterOf:Ln,getPoints:Pn,copy:Rn}=nt,Cn="_localContentBounds",Sn="_worldContentBounds",On="_worldBoxBounds",Dn="_worldStrokeBounds";class Mn{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}get localContentBounds(){return Ln(this.contentBounds,this.leaf.__localMatrix,this[Cn]||(this[Cn]={})),this[Cn]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return Ln(this.contentBounds,this.leaf.__world,this[Sn]||(this[Sn]={})),this[Sn]}get worldBoxBounds(){return Ln(this.boxBounds,this.leaf.__world,this[On]||(this[On]={})),this[On]}get worldStrokeBounds(){return Ln(this.strokeBounds,this.leaf.__world,this[Dn]||(this[Dn]={})),this[Dn]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.boxBounds={x:0,y:0,width:0,height:0},this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),this.boxChange(),this.matrixChange()}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leafer:t}=this.leaf;if(t)t.ready?t.watcher.changed&&t.layouter.layout():t.start();else{let t=this.leaf;for(;t.parent&&!t.parent.leafer;)t=t.parent;e.layout(t)}}getTransform(t="world"){this.update();const{leaf:e}=this;switch(t){case"world":return e.__world;case"local":return e.__localMatrix;case"inner":return b.defaultMatrix;case"page":t=e.zoomLayer;default:return Tn(e,t)}}getBounds(t,e="world"){switch(this.update(),e){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":e=this.leaf.zoomLayer;default:return new lt(this.getInnerBounds(t)).toOuterOf(this.getTransform(e))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,e="world",i){const{leaf:s}=this;let o,n,r=this.getInnerBounds(t);switch(e){case"world":o=s.getWorldPoint(r),n=s.__world;break;case"local":o=s.getLocalPointByInner(r),n=s.__localMatrix;break;case"inner":o=r,n=b.defaultMatrix;break;case"page":e=s.zoomLayer;default:o=s.getWorldPoint(r,e),n=Tn(s,e,!0)}const a=b.getLayout(n);if(Rn(a,r),D.copy(a,o),i){const{scaleX:t,scaleY:e}=a,i=Math.abs(t),s=Math.abs(e);1===i&&1===s||(a.scaleX/=i,a.scaleY/=s,a.width*=i,a.height*=s)}return a}getLayoutPoints(t,e="world"){const{leaf:i}=this,s=Pn(this.getInnerBounds(t));let o;switch(e){case"world":o=null;break;case"local":o=i.parent;break;case"inner":break;case"page":e=i.zoomLayer;default:o=e}return void 0!==o&&s.forEach((t=>i.innerToWorld(t,null,!1,o))),s}shrinkContent(){const{x:t,y:e,width:i,height:s}=this.boxBounds;this._contentBounds={x:t,y:e,width:i,height:s}}spreadStroke(){const{x:t,y:e,width:i,height:s}=this.strokeBounds;this._strokeBounds={x:t,y:e,width:i,height:s},this._localStrokeBounds={x:t,y:e,width:i,height:s},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:e,width:i,height:s}=this.renderBounds;this._renderBounds={x:t,y:e,width:i,height:s},this._localRenderBounds={x:t,y:e,width:i,height:s}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged||this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=!0,this.leaf.forceUpdate("surface"))}destroy(){}}const In={},An={on(t,e,i){let s,o,n;i&&("once"===i?o=!0:"boolean"==typeof i?s=i:(s=i.capture,o=i.once));const r=Wn(this,s,!0),a="string"==typeof t?t.split(" "):t,h=o?{listener:e,once:o}:{listener:e};a.forEach((t=>{t&&(n=r[t],n?-1===n.findIndex((t=>t.listener===e))&&n.push(h):r[t]=[h])}))},off(t,e,i){if(t){const s="string"==typeof t?t.split(" "):t;if(e){let t,o,n;i&&(t="boolean"==typeof i?i:"once"!==i&&i.capture);const r=Wn(this,t);s.forEach((t=>{t&&(o=r[t],o&&(n=o.findIndex((t=>t.listener===e)),n>-1&&o.splice(n,1),o.length||delete r[t]))}))}else{const{__bubbleMap:t,__captureMap:e}=this;s.forEach((i=>{t&&delete t[i],e&&delete e[i]}))}}else this.__bubbleMap=this.__captureMap=void 0},on_(t,e,i,s){return i&&(e=e.bind(i)),this.on(t,e,s),{type:t,current:this,listener:e,options:s}},off_(t){if(!t)return;const e=t instanceof Array?t:[t];e.forEach((t=>t.current.off(t.type,t.listener,t.options))),e.length=0},once(t,e,i){this.on(t,e,{once:!0,capture:i})},emit(t,e,i){!e&&Ct.has(t)&&(e=Ct.get(t,{type:t,target:this,current:this}));const s=Wn(this,i)[t];if(s){let o;for(let n=0,r=s.length;n<r&&(o=s[n],o.listener(e),o.once&&(this.off(t,o.listener,i),n--,r--),!e||!e.isStopNow);n++);}this.syncEventer&&this.syncEventer.emitEvent(e,i)},emitEvent(t,e){t.current=this,this.emit(t.type,t,e)},hasEvent(t,e){if(this.syncEventer&&this.syncEventer.hasEvent(t,e))return!0;const{__bubbleMap:i,__captureMap:s}=this,o=i&&i[t],n=s&&s[t];return!!(void 0===e?o||n:e?n:o)}};function Wn(t,e,i){if(e){const{__captureMap:e}=t;return e||(i?t.__captureMap={}:In)}{const{__bubbleMap:e}=t;return e||(i?t.__bubbleMap={}:In)}}class zn{constructor(t,e){this.bubbles=!1,this.type=t,e&&(this.target=e)}stopDefault(){this.isStopDefault=!0,this.origin&&e.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&e.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&e.event.stop(this.origin)}}class Fn extends zn{constructor(t,e,i){super(t,e),this.parent=i,this.child=e}}Fn.ADD="child.add",Fn.REMOVE="child.remove",Fn.DESTROY="child.destroy";class Un extends zn{constructor(t,e,i,s,o){super(t,e),this.attrName=i,this.oldValue=s,this.newValue=o}}Un.CHANGE="property.change",Un.LEAFER_CHANGE="property.leafer_change";class Hn extends zn{constructor(t,e){super(t),Object.assign(this,e)}}Hn.LOAD="image.load",Hn.LOADED="image.loaded",Hn.ERROR="image.error";class Nn extends zn{get bigger(){if(!this.old)return!0;const{width:t,height:e}=this.old;return this.width>=t&&this.height>=e}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,e){"object"==typeof t?(super(Nn.RESIZE),Object.assign(this,t)):super(t),this.old=e}}Nn.RESIZE="resize";class Yn extends zn{constructor(t,e){super(t),this.data=e}}Yn.REQUEST="watch.request",Yn.DATA="watch.data";class Vn extends zn{constructor(t,e,i){super(t),e&&(this.data=e,this.times=i)}}Vn.CHECK_UPDATE="layout.check_update",Vn.REQUEST="layout.request",Vn.START="layout.start",Vn.BEFORE="layout.before",Vn.LAYOUT="layout",Vn.AFTER="layout.after",Vn.AGAIN="layout.again",Vn.END="layout.end";class Xn extends zn{}Xn.FRAME="animate.frame";class Gn extends zn{constructor(t,e,i,s){super(t),e&&(this.times=e),i&&(this.renderBounds=i,this.renderOptions=s)}}Gn.REQUEST="render.request",Gn.START="render.start",Gn.BEFORE="render.before",Gn.RENDER="render",Gn.AFTER="render.after",Gn.AGAIN="render.again",Gn.END="render.end",Gn.NEXT="render.next";class jn extends zn{}jn.START="leafer.start",jn.BEFORE_READY="leafer.before_ready",jn.READY="leafer.ready",jn.AFTER_READY="leafer.after_ready",jn.VIEW_READY="leafer.view_ready",jn.VIEW_COMPLETED="leafer.view_completed",jn.STOP="leafer.stop",jn.RESTART="leafer.restart",jn.END="leafer.end";const{isFinite:Zn}=Number,Kn=wt.get("setAttr"),qn={__setAttr(t,e,i){if(this.leafer&&this.leafer.created){const s=this.__.__getInput(t);if(i&&!Zn(e)&&void 0!==e&&(Kn.warn(this.innerName,t,e),e=void 0),"object"==typeof e||s!==e){this.__[t]=e,this.__proxyData&&this.setProxyAttr(t,e);const{CHANGE:i}=Un,o=new Un(i,this,t,s,e);return this.isLeafer?this.emitEvent(new Un(Un.LEAFER_CHANGE,this,t,s,e)):this.hasEvent(i)&&this.emitEvent(o),this.leafer.emitEvent(o),!0}return!1}return this.__[t]=e,this.__proxyData&&this.setProxyAttr(t,e),!0},__getAttr(t){return this.__proxyData?this.getProxyAttr(t):this.__.__get(t)}},{setLayout:Jn,multiplyParent:$n,translateInner:Qn,defaultWorld:tr}=b,{toPoint:er,tempPoint:ir}=gt,sr={__updateWorldMatrix(){$n(this.__local||this.__layout,this.parent?this.parent.__world:tr,this.__world,!!this.__layout.affectScaleOrRotation,this.__,this.parent&&this.parent.__)},__updateLocalMatrix(){if(this.__local){const t=this.__layout,e=this.__local,i=this.__;t.affectScaleOrRotation&&(t.scaleChanged||t.rotationChanged)&&(Jn(e,i,null,null,t.affectRotation),t.scaleChanged=t.rotationChanged=!1),e.e=i.x+i.offsetX,e.f=i.y+i.offsetY,(i.around||i.origin)&&(er(i.around||i.origin,t.boxBounds,ir),Qn(e,-ir.x,-ir.y,!i.around))}this.__layout.matrixChanged=!1}},{updateMatrix:or,updateAllMatrix:nr}=cn,{updateBounds:rr}=xn,{toOuterOf:ar,copyAndSpread:hr,copy:lr}=nt,{toBounds:dr}=js,cr={__updateWorldBounds(){ar(this.__layout.renderBounds,this.__world,this.__world),this.__layout.resized&&(this.__onUpdateSize(),this.__layout.resized=!1)},__updateLocalBounds(){const t=this.__layout;t.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),t.resized=!0),t.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),t.localBoxChanged=!1,t.strokeSpread&&(t.strokeChanged=!0),t.renderSpread&&(t.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),t.boxChanged=!1,t.strokeChanged&&(t.strokeSpread=this.__updateStrokeSpread(),t.strokeSpread?(t.strokeBounds===t.boxBounds&&t.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):t.spreadStrokeCancel(),t.strokeChanged=!1,(t.renderSpread||t.strokeSpread!==t.strokeBoxSpread)&&(t.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),t.resized=!0),t.renderChanged&&(t.renderSpread=this.__updateRenderSpread(),t.renderSpread?(t.renderBounds!==t.boxBounds&&t.renderBounds!==t.strokeBounds||t.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):t.spreadRenderCancel(),t.renderChanged=!1,this.parent&&this.parent.__layout.renderChange()),t.boundsChanged=!1},__updateLocalBoxBounds(){this.__hasAutoLayout&&this.__updateAutoLayout(),ar(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){ar(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){ar(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(){const t=this.__layout.boxBounds,e=this.__;e.__pathInputed?dr(e.__pathForRender,t):(t.x=0,t.y=0,t.width=e.width,t.height=e.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.leafer&&this.leafer.ready&&this.leafer.layouter.addExtra(this),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),nr(this),rr(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(nr(this),rr(this,this))):or(this)},__updateNaturalSize(){const{__:t,__layout:e}=this;t.__naturalWidth=e.boxBounds.width,t.__naturalHeight=e.boxBounds.height},__updateStrokeBounds(){const t=this.__layout;hr(t.strokeBounds,t.boxBounds,t.strokeBoxSpread)},__updateRenderBounds(){const t=this.__layout;t.renderSpread>0?hr(t.renderBounds,t.boxBounds,t.renderSpread):lr(t.renderBounds,t.strokeBounds)}},ur={__render(t,e){if(this.__worldOpacity)if(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),t.opacity=this.__.opacity,this.__.__single){if("path"===this.__.eraser)return this.__renderEraser(t,e);const i=t.getSameCanvas(!0,!0);this.__draw(i,e),this.__worldFlipped?t.copyWorldByReset(i,this.__nowWorld,null,this.__.__blendMode,!0):t.copyWorldToInner(i,this.__nowWorld,this.__layout.renderBounds,this.__.__blendMode),i.recycle(this.__nowWorld)}else this.__draw(t,e)},__clip(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawRenderPath(t),this.__.windingRule?t.clip(this.__.windingRule):t.clip())},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:pr}=mn,_r={__updateChange(){const{__layout:t}=this;t.childrenSortChanged&&(this.__updateSortChildren(),t.childrenSortChanged=!1),this.__.__checkSingle()},__render(t,e){if(this.__worldOpacity)if(this.__.__single){if("path"===this.__.eraser)return this.__renderEraser(t,e);const i=t.getSameCanvas(!1,!0);this.__renderBranch(i,e);const s=this.__getNowWorld(e);t.opacity=this.__.opacity,t.copyWorldByReset(i,s,s,this.__.__blendMode,!0),i.recycle(s)}else this.__renderBranch(t,e)},__renderBranch(t,e){if(this.__hasMask)this.__renderMask(t,e);else{const{children:i}=this;for(let s=0,o=i.length;s<o;s++)pr(i[s],e)||i[s].__render(t,e)}},__clip(t,e){if(this.__worldOpacity){const{children:i}=this;for(let s=0,o=i.length;s<o;s++)pr(i[s],e)||i[s].__clip(t,e)}}},{LEAF:gr,create:fr}=s,{toInnerPoint:yr,toOuterPoint:vr,multiplyParent:mr}=b,{toOuterOf:wr}=nt,{copy:xr}=D,{moveLocal:br,zoomOfLocal:Er,rotateOfLocal:kr,skewOfLocal:Br,moveWorld:Tr,zoomOfWorld:Lr,rotateOfWorld:Pr,skewOfWorld:Rr,transform:Cr,transformWorld:Sr,setTransform:Or,getFlipTransform:Dr,getLocalOrigin:Mr,getRelativeWorld:Ir,drop:Ar}=cn;t.Leaf=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return It}get __LayoutProcessor(){return Mn}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.__layout.update(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){const{leafer:t}=this;return t&&t.created&&t.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(t){let e;for(let i in t)e=t[i],e instanceof Array?this.on(i,e[0],e[1]):this.on(i,e)}constructor(t){this.innerId=fr(gr),this.reset(t)}reset(t){this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},null!==t&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0}),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),t&&(t.__&&(t=t.toJSON()),t.children?this.set(t):Object.assign(this,t))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(t,e){e&&(t=t.bind(e)),this.parent?t():this.__parentWait?this.__parentWait.push(t):this.__parentWait=[t]}waitLeafer(t,e){e&&(t=t.bind(e)),this.leafer?t():this.__leaferWait?this.__leaferWait.push(t):this.__leaferWait=[t]}nextRender(t,e,i){this.leafer?this.leafer.nextRender(t,e,i):this.waitLeafer((()=>this.leafer.nextRender(t,e,i)))}removeNextRender(t){this.nextRender(t,null,"off")}__bindLeafer(t){if(this.isLeafer&&null!==t&&(t=this),this.leafer&&!t&&this.leafer.leafs--,this.leafer=t,t&&(t.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.__leaferWait&&Bn.run(this.__leaferWait)),this.isBranch){const{children:e}=this;for(let i=0,s=e.length;i<s;i++)e[i].__bindLeafer(t)}}set(t){}get(t){}setAttr(t,e){this[t]=e}getAttr(t){return this[t]}getComputedAttr(t){return this.__[t]}toJSON(t){return t&&this.__layout.update(),this.__.__getInputData(null,t)}toString(t){return JSON.stringify(this.toJSON(t))}toSVG(){}__SVG(t){}toHTML(){}__setAttr(t,e){return!0}__getAttr(t){}setProxyAttr(t,e){}getProxyAttr(t){}find(t,e){}findTag(t){}findOne(t,e){}findId(t){}focus(t){}updateLayout(){this.__layout.update()}forceUpdate(t){void 0===t?t="width":"surface"===t&&(t="blendMode");const e=this.__.__getInput(t);this.__[t]=void 0===e?null:void 0,this[t]=e}forceRender(t){this.forceUpdate("surface")}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(){}__updateContentBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){this.__hasEraser=!!t||this.children.some((t=>t.__.eraser))}__renderEraser(t,e){t.save(),this.__clip(t,e);const{renderBounds:i}=this.__layout;t.clearRect(i.x,i.y,i.width,i.height),t.restore()}__updateMask(t){this.__hasMask=!!t||this.children.some((t=>t.__.mask))}__renderMask(t,e){}__getNowWorld(t){if(t.matrix){this.__cameraWorld||(this.__cameraWorld={});const e=this.__cameraWorld;return mr(this.__world,t.matrix,e,void 0,this.__world),wr(this.__layout.renderBounds,e,e),e}return this.__world}getTransform(t){return this.__layout.getTransform(t||"local")}getBounds(t,e){return this.__layout.getBounds(t,e)}getLayoutBounds(t,e,i){return this.__layout.getLayoutBounds(t,e,i)}getLayoutPoints(t,e){return this.__layout.getLayoutPoints(t,e)}getWorldBounds(t,e,i){const s=e?Ir(this,e):this.worldTransform,o=i?t:{};return wr(t,s,o),o}worldToLocal(t,e,i,s){this.parent?this.parent.worldToInner(t,e,i,s):e&&xr(e,t)}localToWorld(t,e,i,s){this.parent?this.parent.innerToWorld(t,e,i,s):e&&xr(e,t)}worldToInner(t,e,i,s){s&&(s.innerToWorld(t,e,i),t=e||t),yr(this.worldTransform,t,e,i)}innerToWorld(t,e,i,s){vr(this.worldTransform,t,e,i),s&&s.worldToInner(e||t,null,i)}getInnerPoint(t,e,i,s){const o=s?t:{};return this.worldToInner(t,o,i,e),o}getInnerPointByLocal(t,e,i,s){return this.getInnerPoint(t,this.parent,i,s)}getLocalPoint(t,e,i,s){const o=s?t:{};return this.worldToLocal(t,o,i,e),o}getLocalPointByInner(t,e,i,s){return this.getWorldPoint(t,this.parent,i,s)}getWorldPoint(t,e,i,s){const o=s?t:{};return this.innerToWorld(t,o,i,e),o}getWorldPointByLocal(t,e,i,s){const o=s?t:{};return this.localToWorld(t,o,i,e),o}getPagePoint(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(t,e,i,s)}getWorldPointByPage(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(t,e,i,s)}setTransform(t,e){Or(this,t,e)}transform(t,e){Cr(this,t,e)}move(t,e){br(this,t,e)}moveInner(t,e){Tr(this,t,e,!0)}scaleOf(t,e,i,s){Er(this,Mr(this,t),e,i,s)}rotateOf(t,e){kr(this,Mr(this,t),e)}skewOf(t,e,i,s){Br(this,Mr(this,t),e,i,s)}transformWorld(t,e){Sr(this,t,e)}moveWorld(t,e){Tr(this,t,e)}scaleOfWorld(t,e,i,s){Lr(this,t,e,i,s)}rotateOfWorld(t,e){Pr(this,t,e)}skewOfWorld(t,e,i,s){Rr(this,t,e,i,s)}flip(t){Cr(this,Dr(this,t))}scaleResize(t,e=t,i){this.scaleX*=t,this.scaleY*=e}__scaleResize(t,e){}resizeWidth(t){}resizeHeight(t){}__hitWorld(t){return!0}__hit(t){return!0}__hitFill(t){return!0}__hitStroke(t,e){return!0}__hitPixel(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,e){}__drawFast(t,e){}__draw(t,e){}__clip(t,e){}__renderShape(t,e,i,s){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}__updateSortChildren(){}add(t,e){}remove(t,e){this.parent&&this.parent.remove(this,e)}dropTo(t,e,i){Ar(this,t,e,i)}on(t,e,i){}off(t,e,i){}on_(t,e,i,s){}off_(t){}once(t,e,i){}emit(t,e,i){}emitEvent(t,e){}hasEvent(t,e){return!1}static changeAttr(t,e,i){i?this.addAttr(t,e,i):Vo(this.prototype,t,e)}static addAttr(t,e,i){i||(i=To),i(e)(this.prototype,t)}destroy(){if(!this.destroyed){const{parent:t}=this;t&&this.remove(),this.children&&this.removeAll(!0),this.hasEvent(Fn.DESTROY)&&this.emitEvent(new Fn(Fn.DESTROY,this,t)),this.__.destroy(),this.__layout.destroy(),this.__captureMap=this.__bubbleMap=this.__parentWait=this.__leaferWait=null,this.destroyed=!0}}},t.Leaf=Wt([Jo(qn),Jo(sr),Jo(cr),Jo(An),Jo(ur)],t.Leaf);const{setListWithFn:Wr}=nt,{sort:zr}=xn,{localBoxBounds:Fr,localStrokeBounds:Ur,localRenderBounds:Hr,maskLocalBoxBounds:Nr,maskLocalStrokeBounds:Yr,maskLocalRenderBounds:Vr}=mn;t.Branch=class extends t.Leaf{__updateStrokeSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.renderSpread)return 1;return 0}__updateBoxBounds(){Wr(this.__layout.boxBounds,this.children,this.__hasMask?Nr:Fr)}__updateStrokeBounds(){Wr(this.__layout.strokeBounds,this.children,this.__hasMask?Yr:Ur)}__updateRenderBounds(){Wr(this.__layout.renderBounds,this.children,this.__hasMask?Vr:Hr)}__updateSortChildren(){let t;const{children:e}=this;if(e.length>1){for(let i=0,s=e.length;i<s;i++)e[i].__tempNumber=i,e[i].__.zIndex&&(t=!0);e.sort(zr),this.__layout.affectChildrenSort=t}}add(t,e){t!==this&&(t.parent&&t.parent.remove(t),t.parent=this,void 0===e?this.children.push(t):this.children.splice(e,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1),t.__layout.boxChanged||t.__layout.boxChange(),t.__layout.matrixChanged||t.__layout.matrixChange(),t.__parentWait&&Bn.run(t.__parentWait),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(Fn.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange())}addMany(...t){t.forEach((t=>this.add(t)))}remove(t,e){if(t){const i=this.children.indexOf(t);i>-1&&(this.children.splice(i,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),e&&t.destroy())}else void 0===t&&super.remove(null,e)}removeAll(t){const{children:e}=this;e.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,e.forEach((e=>{this.__realRemoveChild(e),t&&e.destroy()})))}clear(){this.removeAll(!0)}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(Fn.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,e){const i=new Fn(t,e,this);e.hasEvent(t)&&e.emitEvent(i),this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}},t.Branch=Wt([Jo(_r)],t.Branch);class Xr{get length(){return this.list.length}constructor(t){this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return t&&void 0!==this.keys[t.innerId]}indexAt(t){return this.list[t]}indexOf(t){const e=this.keys[t.innerId];return void 0===e?-1:e}add(t){const{list:e,keys:i}=this;void 0===i[t.innerId]&&(e.push(t),i[t.innerId]=e.length-1)}addAt(t,e=0){const{keys:i}=this;if(void 0===i[t.innerId]){const{list:s}=this;for(let t=e,o=s.length;t<o;t++)i[s[t].innerId]++;0===e?s.unshift(t):(e>s.length&&(e=s.length),s.splice(e,0,t)),i[t.innerId]=e}}addList(t){for(let e=0;e<t.length;e++)this.add(t[e])}remove(t){const{list:e}=this;let i;for(let s=0,o=e.length;s<o;s++)void 0!==i?this.keys[e[s].innerId]=s-1:e[s].innerId===t.innerId&&(i=s,delete this.keys[t.innerId]);void 0!==i&&e.splice(i,1)}sort(t){const{list:e}=this;t?e.sort(((t,e)=>e.__level-t.__level)):e.sort(((t,e)=>t.__level-e.__level))}forEach(t){this.list.forEach(t)}clone(){const t=new Xr;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:e}=this;for(let i=0,s=t.length;i<s;i++)e[t[i].innerId]=i}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class Gr{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return void 0!==this.keys[t.innerId]}without(t){return void 0===this.keys[t.innerId]}sort(t){const{levels:e}=this;t?e.sort(((t,e)=>e-t)):e.sort(((t,e)=>t-e))}addList(t){t.forEach((t=>{this.add(t)}))}add(t){const{keys:e,levelMap:i}=this;e[t.innerId]||(e[t.innerId]=1,i[t.__level]?i[t.__level].push(t):(i[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let e;this.levels.forEach((i=>{e=this.levelMap[i];for(let i=0,s=e.length;i<s;i++)t(e[i])}))}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const jr=wt.get("LeaferCanvas");class Zr extends jt{set zIndex(t){const{style:e}=this.view;e.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:e,parentView:i}=this;if(e&&i){const s=i.children[t];s?(this.setAbsolute(s),i.insertBefore(e,s)):i.appendChild(s)}}init(){const{config:t}=this,i=t.view||t.canvas;i?this.__createViewFrom(i):this.__createView();const{style:s}=this.view;if(s.display||(s.display="block"),this.parentView=this.view.parentElement,this.parentView){const t=this.parentView.style;t.webkitUserSelect=t.userSelect="none"}e.syncDomFont&&!this.parentView&&(s.display="none",document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(t)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return"none"!==this.view.style.pointerEvents}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let e="string"==typeof t?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let t=e;if(e===window||e===document){const e=document.createElement("div"),{style:i}=e;i.position="absolute",i.top=i.bottom=i.left=i.right="0px",document.body.appendChild(e),t=e}this.__createView();const i=this.view;t.hasChildNodes()&&(this.setAbsolute(i),t.style.position||(t.style.position="relative")),t.appendChild(i)}else jr.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:e}=t;e.position="absolute",e.top=e.left="0px"}updateViewSize(){const{width:t,height:e,pixelRatio:i}=this,{style:s}=this.view;s.width=t+"px",s.height=e+"px",this.view.width=Math.ceil(t*i),this.view.height=Math.ceil(e*i)}updateClientBounds(){this.clientBounds=this.view.getBoundingClientRect()}startAutoLayout(t,i){if(this.resizeListener=i,t){this.autoBounds=t;try{this.resizeObserver=new ResizeObserver((t=>{this.updateClientBounds();for(const e of t)this.checkAutoBounds(e.contentRect)}));const t=this.parentView;t?(this.resizeObserver.observe(t),this.checkAutoBounds(t.getBoundingClientRect())):(this.checkAutoBounds(this.view),jr.warn("no parent"))}catch(t){this.imitateResizeObserver()}}else window.addEventListener("resize",(()=>{const t=e.devicePixelRatio;if(this.pixelRatio!==t){const{width:e,height:i}=this;this.emitResize({width:e,height:i,pixelRatio:t})}}))}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),e.requestRender(this.imitateResizeObserver.bind(this)))}checkAutoBounds(t){const i=this.view,{x:s,y:o,width:n,height:r}=this.autoBounds.getBoundsFrom(t),a={width:n,height:r,pixelRatio:e.devicePixelRatio};if(!this.isSameSize(a)){const{style:t}=i;t.marginLeft=s+"px",t.marginTop=o+"px",this.emitResize(a)}}stopAutoLayout(){this.autoLayout=!1,this.resizeListener=null,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}emitResize(t){const e={};Dt.copyAttrs(e,this,Gt),this.resize(t),void 0!==this.width&&this.resizeListener(new Nn(t,e))}unrealCanvas(){if(!this.unreal&&this.parentView){const t=this.view;t&&t.remove(),this.view=this.parentView,this.unreal=!0}}destroy(){if(this.view){if(this.stopAutoLayout(),!this.unreal){const t=this.view;t.parentElement&&t.remove()}super.destroy()}}}oo(CanvasRenderingContext2D.prototype),oo(Path2D.prototype);const{mineType:Kr,fileType:qr}=no;function Jr(t,s){e.origin={createCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i},canvasToDataURL:(t,e,i)=>t.toDataURL(Kr(e),i),canvasToBolb:(t,e,i)=>new Promise((s=>t.toBlob(s,Kr(e),i))),canvasSaveAs:(t,i,s)=>{const o=t.toDataURL(Kr(qr(i)),s);return e.origin.download(o,i)},download:(t,e)=>new Promise((i=>{let s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),i()})),loadImage:t=>new Promise(((i,s)=>{const o=new Image,{crossOrigin:n}=e.image;n&&(o.setAttribute("crossOrigin",n),o.crossOrigin=n),o.onload=()=>{i(o)},o.onerror=t=>{s(t)},o.src=e.image.getRealURL(t)}))},e.event={stopDefault(t){t.preventDefault()},stopNow(t){t.stopImmediatePropagation()},stop(t){t.stopPropagation()}},e.canvas=i.canvas(),e.conicGradientSupport=!!e.canvas.context.createConicGradient}Object.assign(i,{canvas:(t,e)=>new Zr(t,e),image:t=>new go(t)}),e.name="web",e.isMobile="ontouchstart"in window,e.requestRender=function(t){window.requestAnimationFrame(t)},fo(e,"devicePixelRatio",{get:()=>Math.max(1,devicePixelRatio)});const{userAgent:$r}=navigator;$r.indexOf("Firefox")>-1?(e.conicGradientRotate90=!0,e.intWheelDeltaY=!0,e.syncDomFont=!0):$r.indexOf("Safari")>-1&&-1===$r.indexOf("Chrome")&&(e.fullImageShadow=!0),$r.indexOf("Windows")>-1?(e.os="Windows",e.intWheelDeltaY=!0):$r.indexOf("Mac")>-1?e.os="Mac":$r.indexOf("Linux")>-1&&(e.os="Linux");class Qr{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove){const t=new Xr;return this.__updatedList.list.forEach((e=>{e.leafer&&t.add(e)})),t}return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new Xr,this.target=t,e&&(this.config=Dt.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(Gn.REQUEST)}__onAttrChange(t){this.__updatedList.add(t.target),this.update()}__onChildEvent(t){t.type===Fn.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent)),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)this.__pushChild(e[t])}__onRquestData(){this.target.emitEvent(new Yn(Yn.DATA,{updatedList:this.updatedList})),this.__updatedList=new Xr,this.totalTimes++,this.changed=!1,this.hasVisible=!1,this.hasRemove=!1,this.hasAdd=!1}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Un.CHANGE,this.__onAttrChange,this),t.on_([Fn.ADD,Fn.REMOVE],this.__onChildEvent,this),t.on_(Yn.REQUEST,this.__onRquestData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.__updatedList=null)}}const{updateAllMatrix:ta,updateBounds:ea,updateAllWorldOpacity:ia}=cn,{pushAllChildBranch:sa,pushAllParent:oa}=xn;const{worldBounds:na}=mn,ra={x:0,y:0,width:1e5,height:1e5};class aa{constructor(t){this.updatedBounds=new lt,this.beforeBounds=new lt,this.afterBounds=new lt,t instanceof Array&&(t=new Xr(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,na)}setAfter(){const{list:t}=this.updatedList;t.some((t=>t.noBounds))?this.afterBounds.set(ra):this.afterBounds.setListWithFn(t,na),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:ha,updateAllChange:la}=cn,da=wt.get("Layouter");class ca{constructor(t,e){this.totalTimes=0,this.config={},this.__levelList=new Gr,this.target=t,e&&(this.config=Dt.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(!this.running)return;const{target:t}=this;this.times=0;try{t.emit(Vn.START),this.layoutOnce(),t.emitEvent(new Vn(Vn.END,this.layoutedBlocks,this.times))}catch(t){da.error(t)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?da.warn("layouting"):this.times>3?da.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Yn.REQUEST),this.totalTimes>1?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(null===(t=this.__updatedList)||void 0===t?void 0:t.length))return;const e=kt.start("PartLayout"),{target:i,__updatedList:s}=this,{BEFORE:o,LAYOUT:n,AFTER:r}=Vn,a=this.getBlocks(s);a.forEach((t=>t.setBefore())),i.emitEvent(new Vn(o,a,this.times)),this.extraBlock=null,s.sort(),function(t,e){let i;t.list.forEach((t=>{i=t.__layout,e.without(t)&&!i.proxyZoom&&(i.matrixChanged?(ta(t,!0),e.add(t),t.isBranch&&sa(t,e),oa(t,e)):i.boundsChanged&&(e.add(t),t.isBranch&&(t.__tempNumber=0),oa(t,e)))}))}(s,this.__levelList),function(t){let e,i,s;t.sort(!0),t.levels.forEach((o=>{e=t.levelMap[o];for(let t=0,o=e.length;t<o;t++){if(i=e[t],i.isBranch&&i.__tempNumber){s=i.children;for(let t=0,e=s.length;t<e;t++)s[t].isBranch||ea(s[t])}ea(i)}}))}(this.__levelList),function(t){t.list.forEach((t=>{t.__layout.opacityChanged&&ia(t),t.__updateChange()}))}(s),this.extraBlock&&a.push(this.extraBlock),a.forEach((t=>t.setAfter())),i.emitEvent(new Vn(n,a,this.times)),i.emitEvent(new Vn(r,a,this.times)),this.addBlocks(a),this.__levelList.reset(),this.__updatedList=null,kt.end(e)}fullLayout(){const t=kt.start("FullLayout"),{target:e}=this,{BEFORE:i,LAYOUT:s,AFTER:o}=Vn,n=this.getBlocks(new Xr(e));e.emitEvent(new Vn(i,n,this.times)),ca.fullLayout(e),n.forEach((t=>{t.setAfter()})),e.emitEvent(new Vn(s,n,this.times)),e.emitEvent(new Vn(o,n,this.times)),this.addBlocks(n),kt.end(t)}static fullLayout(t){ha(t,!0),t.isBranch?xn.updateBounds(t):cn.updateBounds(t),la(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:e,beforeBounds:i}=this.extraBlock||(this.extraBlock=new aa([]));e.length?i.add(t.__world):i.set(t.__world),e.add(t)}}createBlock(t){return new aa(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Vn.REQUEST,this.layout,this),t.on_(Vn.AGAIN,this.layoutAgain,this),t.on_(Yn.DATA,this.__onReceiveWatchData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const ua=wt.get("Renderer");class pa{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,e,i){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,maxFPS:60},this.target=t,this.canvas=e,i&&(this.config=Dt.default(i,this.config)),this.__listenEvents(),this.__requestRender()}start(){this.running=!0}stop(){this.running=!1}update(){this.changed=!0}requestLayout(){this.target.emit(Vn.REQUEST)}render(t){if(!this.running||!this.canvas.view)return void(this.changed=!0);const{target:e}=this;this.times=0,this.totalBounds=new lt,ua.log(e.innerName,"---\x3e");try{this.emitRender(Gn.START),this.renderOnce(t),this.emitRender(Gn.END,this.totalBounds),co.clearRecycled()}catch(t){this.rendering=!1,ua.error(t)}ua.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return ua.warn("rendering");if(this.times>3)return ua.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new lt,this.renderOptions={},t)this.emitRender(Gn.BEFORE),t();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(Gn.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(Gn.RENDER,this.renderBounds,this.renderOptions),this.emitRender(Gn.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:e}=this;if(!e)return ua.warn("PartRender: need update attr");this.mergeBlocks(),e.forEach((e=>{t.bounds.hit(e)&&!e.isEmpty()&&this.clipRender(e)}))}clipRender(t){const e=kt.start("PartRender"),{canvas:i}=this,s=t.getIntersect(i.bounds),o=t.includes(this.target.__world),n=new lt(s);i.save(),o&&!wt.showRepaint?i.clear():(s.spread(10+1/this.canvas.pixelRatio).ceil(),i.clearWorld(s,!0),i.clipWorld(s,!0)),this.__render(s,o,n),i.restore(),kt.end(e)}fullRender(){const t=kt.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds,!0),e.restore(),kt.end(t)}__render(t,e,i){const s=t.includes(this.target.__world)?{includes:e}:{bounds:t,includes:e};this.needFill&&this.canvas.fillWorld(t,this.config.fill),wt.showRepaint&&this.canvas.strokeWorld(t,"red"),this.target.__render(this.canvas,s),this.renderBounds=i=i||t,this.renderOptions=s,this.totalBounds.isEmpty()?this.totalBounds=i:this.totalBounds.add(i),wt.showHitView&&this.renderHitView(s),wt.showBoundsView&&this.renderBoundsView(s),this.canvas.updateRender(i)}renderHitView(t){}renderBoundsView(t){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new lt;e.setList(t),t.length=0,t.push(e)}}__requestRender(){const t=Date.now();e.requestRender((()=>{this.FPS=Math.min(60,Math.ceil(1e3/(Date.now()-t))),this.running&&(this.target.emit(Xn.FRAME),this.changed&&this.canvas.view&&this.render(),this.target.emit(Gn.NEXT)),this.target&&this.__requestRender()}))}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:e,height:i}=t.old;if(!new lt(0,0,e,i).includes(this.target.__world)||this.needFill||!t.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new lt(0,0,1,1)),this.changed=!0}}__onLayoutEnd(t){t.data&&t.data.map((t=>{let e;t.updatedList&&t.updatedList.list.some((t=>(e=!t.__world.width||!t.__world.height,e&&(t.isLeafer||ua.tip(t.innerName,": empty"),e=!t.isBranch||t.isBranchLeaf),e))),this.addBlock(e?this.canvas.bounds:t.updatedBounds)}))}emitRender(t,e,i){this.target.emitEvent(new Gn(t,this.times,e,i))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Gn.REQUEST,this.update,this),t.on_(Vn.END,this.__onLayoutEnd,this),t.on_(Gn.AGAIN,this.renderAgain,this),t.on_(Nn.RESIZE,this.__onResize,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.canvas=this.config=null)}}const{hitRadiusPoint:_a}=nt;class ga{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,i){e||(e=0),i||(i={});const s=i.through||!1,o=i.ignoreHittable||!1,n=i.target||this.target;this.exclude=i.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=new Xr(i.findList),i.findList||this.hitBranch(n);const{list:r}=this.findList,a=this.getBestMatchLeaf(r,i.bottomList,o),h=o?this.getPath(a):this.getHitablePath(a);return this.clear(),s?{path:h,target:a,throughPath:r.length?this.getThroughPath(r):h}:{path:h,target:a}}getBestMatchLeaf(t,e,i){if(t.length){let e;this.findList=new Xr;const{x:s,y:o}=this.point,n={x:s,y:o,radiusX:0,radiusY:0};for(let s=0,o=t.length;s<o;s++)if(e=t[s],(i||cn.worldHittable(e))&&(this.hitChild(e,n),this.findList.length))return this.findList.list[0]}if(e)for(let t=0,i=e.length;t<i;t++)if(this.hitChild(e[t].target,this.point,e[t].proxy),this.findList.length)return this.findList.list[0];return t[0]}getPath(t){const e=new Xr;for(;t;)e.add(t),t=t.parent;return e.add(this.target),e}getHitablePath(t){const e=this.getPath(t&&t.hittable?t:null);let i,s=new Xr;for(let t=e.list.length-1;t>-1&&(i=e.list[t],i.__.hittable)&&(s.addAt(i,0),i.__.hitChildren);t--);return s}getThroughPath(t){const e=new Xr,i=[];for(let e=t.length-1;e>-1;e--)i.push(this.getPath(t[e]));let s,o,n;for(let t=0,r=i.length;t<r;t++){s=i[t],o=i[t+1];for(let t=0,i=s.length;t<i&&(n=s.list[t],!o||!o.has(n));t++)e.add(n)}return e}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,e){let i,s;const{point:o}=this;for(let n=t.length-1;n>-1;n--)i=t[n],!i.__.visible||e&&!i.__.mask||(s=!!i.__.hitRadius||_a(i.__world,o),i.isBranch?(s||i.__ignoreHitWorld)&&(this.eachFind(i.children,i.__onlyHitMask),i.isBranchLeaf&&!this.findList.length&&this.hitChild(i,o)):s&&this.hitChild(i,o))}hitChild(t,e,i){if((!this.exclude||!this.exclude.has(t))&&t.__hitWorld(e)){const{parent:s}=t;if(s&&s.__hasMask&&!t.__.mask&&!s.children.some((t=>t.__.mask&&t.__hitWorld(e))))return;this.findList.add(i||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}const{Yes:fa,NoAndSkip:ya,YesAndSkip:va}=t.Answer,ma={},wa={},xa={};class ba{constructor(t,e){this.config={},this.innerIdMap={},this.idMap={},this.methods={id:(t,e)=>t.id===e?(this.idMap[e]=t,1):0,innerId:(t,e)=>t.innerId===e?(this.innerIdMap[e]=t,1):0,className:(t,e)=>t.className===e?1:0,tag:(t,e)=>t.__tag===e?1:0,tags:(t,e)=>e[t.__tag]?1:0},this.target=t,e&&(this.config=Dt.default(e,this.config)),this.picker=new ga(t,this),this.__listenEvents()}getBy(t,e,i,s){switch(typeof t){case"number":const o=this.getByInnerId(t,e);return i?o:o?[o]:[];case"string":switch(t[0]){case"#":ma.id=t.substring(1),t=ma;break;case".":wa.className=t.substring(1),t=wa;break;default:xa.tag=t,t=xa}case"object":if(void 0!==t.id){const s=this.getById(t.id,e);return i?s:s?[s]:[]}if(t.tag){const{tag:s}=t,o=s instanceof Array;return this.getByMethod(o?this.methods.tags:this.methods.tag,e,i,o?Dt.toMap(s):s)}return this.getByMethod(this.methods.className,e,i,t.className);case"function":return this.getByMethod(t,e,i,s)}}getByPoint(t,i,s){return"node"===e.name&&this.target.emit(Vn.CHECK_UPDATE),this.picker.getByPoint(t,i,s)}getByInnerId(t,e){const i=this.innerIdMap[t];return i||(this.eachFind(this.toChildren(e),this.methods.innerId,null,t),this.findLeaf)}getById(t,e){const i=this.idMap[t];return i&&cn.hasParent(i,e||this.target)?i:(this.eachFind(this.toChildren(e),this.methods.id,null,t),this.findLeaf)}getByClassName(t,e){return this.getByMethod(this.methods.className,e,!1,t)}getByTag(t,e){return this.getByMethod(this.methods.tag,e,!1,t)}getByMethod(t,e,i,s){const o=i?null:[];return this.eachFind(this.toChildren(e),t,o,s),o||this.findLeaf}eachFind(t,e,i,s){let o,n;for(let r=0,a=t.length;r<a;r++){if(o=t[r],n=e(o,s),n===fa||n===va){if(!i)return void(this.findLeaf=o);i.push(o)}o.isBranch&&n<ya&&this.eachFind(o.children,e,i,s)}}toChildren(t){return this.findLeaf=null,[t||this.target]}__onRemoveChild(t){const{id:e,innerId:i}=t.child;this.idMap[e]&&delete this.idMap[e],this.innerIdMap[i]&&delete this.innerIdMap[i]}__checkIdChange(t){if("id"===t.attrName){const e=t.oldValue;this.idMap[e]&&delete this.idMap[e]}}__listenEvents(){this.__eventIds=[this.target.on_(Fn.REMOVE,this.__onRemoveChild,this),this.target.on_(Un.CHANGE,this.__checkIdChange,this)]}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}destroy(){this.__eventIds.length&&(this.__removeListenEvents(),this.picker.destroy(),this.findLeaf=null,this.innerIdMap={},this.idMap={})}}Object.assign(i,{watcher:(t,e)=>new Qr(t,e),layouter:(t,e)=>new ca(t,e),renderer:(t,e,i)=>new pa(t,e,i),selector:(t,e)=>new ba(t,e)}),e.layout=ca.fullLayout;const Ea={},ka={},Ba={},Ta={},La={},Pa={},Ra={},Ca={},Sa={};function Oa(t){return vo(t,(t=>({set(e){this.__setAttr(t,e),this.waitLeafer((()=>{Sa.setStyle&&Sa.setStyle(this,t+"Style",e)}))}})))}function Da(t){return vo(t,(t=>({set(e){if(this.__setAttr(t,e)){const t=this.__;t.__useArrow="none"!==t.startArrow||"none"!==t.endArrow,Oo(this)}}})))}function Ma(t){return vo(t,(t=>({set(e){this.__setAttr(t,e),e&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}})))}function Ia(t){return vo(t,(t=>({set(e){this.__setAttr(t,e),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}})))}function Aa(){return(t,e)=>{const i="_"+e;fo(t,e,{set(t){this.isLeafer&&(this[i]=t)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[i]||this:this.leafer&&this.leafer.zoomLayer}})}}const{parse:Wa}=_i,za={},Fa=wt.get("UIData");class Ua extends It{get __strokeWidth(){const{strokeWidth:t,strokeWidthFixed:e}=this;if(e){const e=this.__leaf;let{scaleX:i}=e.__nowWorld||e.__world;return i<0&&(i=-i),i>1?t/i:t}return t}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this.__leaf.leafer&&(this.__leaf.leafer.watcher.hasVisible=!0),this._visible=t}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,Fa.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,Fa.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("fill",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isFills=!0,this._fill||(this._fill=za)):(this.__isFills&&(this.__removeInput("fill"),La.recycleImage("fill",this),this.__isFills=!1,this.__pixelFill&&(this.__pixelFill=!1)),this._fill=t)}setStroke(t){"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("stroke",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isStrokes=!0,this._stroke||(this._stroke=za)):(this.__isStrokes&&(this.__removeInput("stroke"),La.recycleImage("stroke",this),this.__isStrokes=!1,this.__pixelStroke&&(this.__pixelStroke=!1)),this._stroke=t)}setPath(t){"string"==typeof t?(this.__setInput("path",t),this._path=Wa(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){this.__setInput("shadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._shadow=t.length?t:null):this._shadow=t?!1===t.visible?null:[t]:null}setInnerShadow(t){this.__setInput("innerShadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._innerShadow=t.length?t:null):this._innerShadow=t?!1===t.visible?null:[t]:null}__computePaint(){const{fill:t,stroke:e}=this.__input;t&&Ta.compute("fill",this.__leaf),e&&Ta.compute("stroke",this.__leaf),this.__needComputePaint=!1}}const Ha={number:(t,e)=>"object"==typeof t?"percent"===t.type?t.value*e:t.value:t};class Na extends Ua{}class Ya extends Na{get __boxStroke(){return!this.__pathInputed}}class Va extends Na{__getInputData(){const t=super.__getInputData();return Gt.forEach((e=>delete t[e])),t}}class Xa extends Ya{}class Ga extends Ua{}class ja extends Ua{get __boxStroke(){return!this.__pathInputed}}class Za extends Ua{get __boxStroke(){return!this.__pathInputed}}class Ka extends Ua{}class qa extends Ua{}class Ja extends Ua{}class $a extends Na{}const Qa={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class th extends Ua{get __useNaturalRatio(){return!1}setFontWeight(t){"string"==typeof t?(this.__setInput("fontWeight",t),this._fontWeight=Qa[t]||400):(this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t)}}class eh extends ja{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.__leaf.image&&(this.__leaf.image=null),this.fill=t?{type:"image",mode:"strench",url:t}:void 0}__getData(){const t=super.__getData();return delete t.fill,t}__getInputData(){const t=super.__getInputData();return delete t.fill,t}}class ih extends ja{__getInputData(){const t=super.__getInputData();return t.url=this.__leaf.canvas.toDataURL("image/png"),t}}const sh={__updateStrokeSpread(){let t=0,e=0;const i=this.__,{strokeAlign:s,strokeWidth:o}=i;if((i.stroke||"all"===i.hitStroke)&&o&&"inside"!==s&&(e=t="center"===s?o/2:o,!i.__boxStroke)){const e=i.__isLinePath?0:10*t,s="none"===i.strokeCap?0:o;t+=Math.max(e,s)}return i.__useArrow&&(t+=5*o),this.__layout.strokeBoxSpread=e,t},__updateRenderSpread(){let t=0;const{shadow:e,innerShadow:i,blur:s,backgroundBlur:o}=this.__;e&&e.forEach((e=>{t=Math.max(t,Math.max(Math.abs(e.y),Math.abs(e.x))+(e.spread>0?e.spread:0)+1.5*e.blur)})),s&&(t=Math.max(t,s));let n=t=Math.ceil(t);return i&&i.forEach((t=>{n=Math.max(n,Math.max(Math.abs(t.y),Math.abs(t.x))+(t.spread<0?-t.spread:0)+1.5*t.blur)})),o&&(n=Math.max(n,o)),this.__layout.renderShapeSpread=n,t+(this.__layout.strokeSpread||0)}},oh={__updateChange(){const t=this.__;if(t.__useEffect){const{shadow:e,innerShadow:i,blur:s,backgroundBlur:o}=this.__;t.__useEffect=!!(e||i||s||o)}t.__checkSingle();t.__isFills||t.__isStrokes||t.cornerRadius||t.__useEffect?t.__complex=!0:t.__complex&&(t.__complex=!1)},__drawFast(t,e){nh(this,t,e)},__draw(t,e){const i=this.__;if(i.__complex){i.__needComputePaint&&i.__computePaint();const{fill:s,stroke:o,__drawAfterFill:n}=i;if(this.__drawRenderPath(t),i.__useEffect){const r=Ta.shape(this,t,e);this.__nowWorld=this.__getNowWorld(e);const{shadow:a,innerShadow:h}=i;a&&Ra.shadow(this,t,r),s&&(i.__isFills?Ta.fills(s,this,t):Ta.fill(s,this,t)),n&&this.__drawAfterFill(t,e),h&&Ra.innerShadow(this,t,r),o&&(i.__isStrokes?Ta.strokes(o,this,t):Ta.stroke(o,this,t)),r.worldCanvas&&r.worldCanvas.recycle(),r.canvas.recycle()}else s&&(i.__isFills?Ta.fills(s,this,t):Ta.fill(s,this,t)),n&&this.__drawAfterFill(t,e),o&&(i.__isStrokes?Ta.strokes(o,this,t):Ta.stroke(o,this,t))}else i.__pathInputed?nh(this,t,e):this.__drawFast(t,e)},__renderShape(t,e,i,s){if(this.__worldOpacity){t.setWorld(this.__nowWorld=this.__getNowWorld(e));const{fill:o,stroke:n}=this.__;this.__drawRenderPath(t),o&&!i&&(this.__.__pixelFill?Ta.fills(o,this,t):Ta.fill("#000000",this,t)),this.__.__isCanvas&&this.__drawAfterFill(t,e),n&&!s&&(this.__.__pixelStroke?Ta.strokes(n,this,t):Ta.stroke("#000000",this,t))}}};function nh(t,e,i){const{fill:s,stroke:o,__drawAfterFill:n}=t.__;t.__drawRenderPath(e),s&&Ta.fill(s,t,e),n&&t.__drawAfterFill(e,i),o&&Ta.stroke(o,t,e)}const rh={__drawFast(t,e){let{width:i,height:s,fill:o,stroke:n,__drawAfterFill:r}=this.__;if(o&&(t.fillStyle=o,t.fillRect(0,0,i,s)),r&&this.__drawAfterFill(t,e),n){const{strokeAlign:o,__strokeWidth:r}=this.__;if(!r)return;t.setStroke(n,r,this.__);const a=r/2;switch(o){case"center":t.strokeRect(0,0,i,s);break;case"inside":i-=r,s-=r,i<0||s<0?(t.save(),this.__clip(t,e),t.strokeRect(a,a,i,s),t.restore()):t.strokeRect(a,a,i,s);break;case"outside":t.strokeRect(-a,-a,i+r,s+r)}}}};var ah,hh;t.UI=ah=class extends t.Leaf{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(t){"number"==typeof t?this.scaleX=this.scaleY=t:(this.scaleX=t.x,this.scaleY=t.y)}get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}get pen(){const{path:t}=this.__;return io.set(this.path=t||[]),t||this.__drawPathByBox(io),io}get editConfig(){}get editOuter(){return this.__.__isLinePath?"LineEditTool":"EditTool"}get editInner(){return"PathEditor"}constructor(t){super(t)}reset(t){}set(t){Object.assign(this,t)}get(t){return"string"==typeof t?this.__.__getInput(t):this.__.__getInputData(t)}createProxyData(){}find(t,e){}findTag(t){return this.find({tag:t})}findOne(t,e){}findId(t){return this.findOne({id:t})}getPath(t,e){this.__layout.update();let i=e?this.__.__pathForRender:this.__.path;return i||(io.set(i=[]),this.__drawPathByBox(io)),t?_i.toCanvasData(i,!0):i}getPathString(t,e){return _i.stringify(this.getPath(t,e))}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const t=this.__;!t.lazy||this.__inLazyBounds||Ca.running?t.__computePaint():t.__needComputePaint=!0}}__updateRenderPath(){if(this.__.path){const t=this.__;t.__pathForRender=t.cornerRadius?eo.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path,t.__useArrow&&Ba.addArrows(this,!t.cornerRadius)}}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path)}__drawPathByData(t,e){e?gs.drawPathByData(t,e):this.__drawPathByBox(t)}__drawPathByBox(t){const{x:e,y:i,width:s,height:o}=this.__layout.boxBounds;if(this.__.cornerRadius){const{cornerRadius:n}=this.__;t.roundRect(e,i,s,o,"number"==typeof n?[n]:n)}else t.rect(e,i,s,o)}export(t,e){return Ca.export(this,t,e)}clone(){return ah.one(this.toJSON())}static one(t,e,i,s,o){return Lt.get(t.tag||this.prototype.__tag,t,e,i,s,o)}static registerUI(){$o()(this)}static registerData(t){Yo(t)(this.prototype)}static setEditConfig(t){}static setEditOuter(t){}static setEditInner(t){}destroy(){this.fill=this.stroke=null,super.destroy()}},Wt([Yo(Ua)],t.UI.prototype,"__",void 0),Wt([Aa()],t.UI.prototype,"zoomLayer",void 0),Wt([xo("")],t.UI.prototype,"id",void 0),Wt([xo("")],t.UI.prototype,"name",void 0),Wt([xo("")],t.UI.prototype,"className",void 0),Wt([Io("pass-through")],t.UI.prototype,"blendMode",void 0),Wt([Ao(1)],t.UI.prototype,"opacity",void 0),Wt([Wo(!0)],t.UI.prototype,"visible",void 0),Wt([Oa(!1)],t.UI.prototype,"selected",void 0),Wt([Oa(!1)],t.UI.prototype,"disabled",void 0),Wt([Io(!1)],t.UI.prototype,"locked",void 0),Wt([zo(0)],t.UI.prototype,"zIndex",void 0),Wt([Fo(!1)],t.UI.prototype,"mask",void 0),Wt([Uo(!1)],t.UI.prototype,"eraser",void 0),Wt([bo(0,!0)],t.UI.prototype,"x",void 0),Wt([bo(0,!0)],t.UI.prototype,"y",void 0),Wt([To(100,!0)],t.UI.prototype,"width",void 0),Wt([To(100,!0)],t.UI.prototype,"height",void 0),Wt([ko(1,!0)],t.UI.prototype,"scaleX",void 0),Wt([ko(1,!0)],t.UI.prototype,"scaleY",void 0),Wt([Bo(0,!0)],t.UI.prototype,"rotation",void 0),Wt([Bo(0,!0)],t.UI.prototype,"skewX",void 0),Wt([Bo(0,!0)],t.UI.prototype,"skewY",void 0),Wt([bo(0,!0)],t.UI.prototype,"offsetX",void 0),Wt([bo(0,!0)],t.UI.prototype,"offsetY",void 0),Wt([bo(0,!0)],t.UI.prototype,"scrollX",void 0),Wt([bo(0,!0)],t.UI.prototype,"scrollY",void 0),Wt([Eo()],t.UI.prototype,"origin",void 0),Wt([Eo()],t.UI.prototype,"around",void 0),Wt([xo(!1)],t.UI.prototype,"lazy",void 0),Wt([Lo(1)],t.UI.prototype,"pixelRatio",void 0),Wt([Ro()],t.UI.prototype,"path",void 0),Wt([Co()],t.UI.prototype,"windingRule",void 0),Wt([Co(!0)],t.UI.prototype,"closed",void 0),Wt([Eo(!1)],t.UI.prototype,"flow",void 0),Wt([To(0)],t.UI.prototype,"padding",void 0),Wt([To(0)],t.UI.prototype,"gap",void 0),Wt([To("top-left")],t.UI.prototype,"flowAlign",void 0),Wt([To(!1)],t.UI.prototype,"flowWrap",void 0),Wt([To("box")],t.UI.prototype,"itemBox",void 0),Wt([To(!0)],t.UI.prototype,"inFlow",void 0),Wt([To()],t.UI.prototype,"autoWidth",void 0),Wt([To()],t.UI.prototype,"autoHeight",void 0),Wt([To()],t.UI.prototype,"lockRatio",void 0),Wt([To()],t.UI.prototype,"autoBox",void 0),Wt([To()],t.UI.prototype,"widthRange",void 0),Wt([To()],t.UI.prototype,"heightRange",void 0),Wt([xo(!1)],t.UI.prototype,"draggable",void 0),Wt([xo()],t.UI.prototype,"dragBounds",void 0),Wt([xo(!1)],t.UI.prototype,"editable",void 0),Wt([Ho(!0)],t.UI.prototype,"hittable",void 0),Wt([Ho("path")],t.UI.prototype,"hitFill",void 0),Wt([Do("path")],t.UI.prototype,"hitStroke",void 0),Wt([Ho(!1)],t.UI.prototype,"hitBox",void 0),Wt([Ho(!0)],t.UI.prototype,"hitChildren",void 0),Wt([Ho(!0)],t.UI.prototype,"hitSelf",void 0),Wt([Ho()],t.UI.prototype,"hitRadius",void 0),Wt([No("")],t.UI.prototype,"cursor",void 0),Wt([Io()],t.UI.prototype,"fill",void 0),Wt([Do()],t.UI.prototype,"stroke",void 0),Wt([Do("inside")],t.UI.prototype,"strokeAlign",void 0),Wt([Do(1)],t.UI.prototype,"strokeWidth",void 0),Wt([Do(!1)],t.UI.prototype,"strokeWidthFixed",void 0),Wt([Do("none")],t.UI.prototype,"strokeCap",void 0),Wt([Do("miter")],t.UI.prototype,"strokeJoin",void 0),Wt([Do()],t.UI.prototype,"dashPattern",void 0),Wt([Do()],t.UI.prototype,"dashOffset",void 0),Wt([Do(10)],t.UI.prototype,"miterLimit",void 0),Wt([Da("none")],t.UI.prototype,"startArrow",void 0),Wt([Da("none")],t.UI.prototype,"endArrow",void 0),Wt([Co(0)],t.UI.prototype,"cornerRadius",void 0),Wt([Co()],t.UI.prototype,"cornerSmoothing",void 0),Wt([Ma()],t.UI.prototype,"shadow",void 0),Wt([Ma()],t.UI.prototype,"innerShadow",void 0),Wt([Ma()],t.UI.prototype,"blur",void 0),Wt([Ma()],t.UI.prototype,"backgroundBlur",void 0),Wt([Ma()],t.UI.prototype,"grayscale",void 0),Wt([xo()],t.UI.prototype,"normalStyle",void 0),Wt([xo()],t.UI.prototype,"hoverStyle",void 0),Wt([xo()],t.UI.prototype,"pressStyle",void 0),Wt([xo()],t.UI.prototype,"focusStyle",void 0),Wt([xo()],t.UI.prototype,"selectedStyle",void 0),Wt([xo()],t.UI.prototype,"disabledStyle",void 0),Wt([xo({})],t.UI.prototype,"data",void 0),Wt([Zo(t.Leaf.prototype.reset)],t.UI.prototype,"reset",null),t.UI=ah=Wt([Jo(sh),Jo(oh),Ko()],t.UI),t.Group=class extends t.UI{get __tag(){return"Group"}get isBranch(){return!0}constructor(t){super(t)}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t){if(t.children){const{children:e}=t;let i;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t),e.forEach((t=>{i=t.__?t:Lt.get(t.tag,t),this.add(i)})),t.children=e}else super.set(t)}toJSON(t){const e=super.toJSON(t);return e.children=this.children.map((e=>e.toJSON(t))),e}pick(t,e){}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}clear(){}},Wt([Yo(Na)],t.Group.prototype,"__",void 0),t.Group=Wt([Jo(t.Branch),$o()],t.Group);const lh=wt.get("Leafer");t.Leafer=hh=class extends t.Group{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&co.isComplete}get layoutLocked(){return!this.layouter.running}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds()}constructor(t,e){super(e),this.config={type:"design",start:!0,hittable:!0,smooth:!0,lazySpeard:100,zoom:{min:.01,max:256},move:{holdSpaceKey:!0,holdMiddleKey:!0,autoDistance:2}},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t),hh.list.add(this)}init(t,e){if(this.canvas)return;let s;this.__setLeafer(this),t&&Dt.assign(this.config,t);const{config:o}=this;this.initType(o.type);const n=this.canvas=i.canvas(o);this.__controllers.push(this.renderer=i.renderer(this,n,o),this.watcher=i.watcher(this,o),this.layouter=i.layouter(this,o)),this.isApp&&this.__setApp(),this.__checkAutoLayout(o,e),this.view=n.view,e?(this.__bindApp(e),s=e.running):(this.selector=i.selector(this),this.interaction=i.interaction(this,n,this.selector,o),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=i.hitCanvasManager()),this.canvasManager=new Ot,s=o.start),this.hittable=o.hittable,this.fill=o.fill,this.canvasManager.add(n),this.__listenEvents(),s&&(this.__startTimer=setTimeout(this.start.bind(this))),Bn.run(this.__initWait),this.onInit()}onInit(){}initType(t){}set(t){this.waitInit((()=>{super.set(t)}))}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.ready?this.emitLeafer(jn.RESTART):this.emitLeafer(jn.START),this.__controllers.forEach((t=>t.start())),this.isApp||this.renderer.render(),this.running=!0)}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach((t=>t.stop())),this.running=!1,this.emitLeafer(jn.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(t){const e=Dt.copyAttrs({},t,Gt);Object.keys(e).forEach((t=>this[t]=e[t]))}forceRender(t){this.renderer.addBlock(t?new lt(t):this.canvas.bounds),this.viewReady&&this.renderer.update()}updateCursor(t){const e=this.interaction;e&&(t?e.setCursor(t):e.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(t){const{canvas:e}=this;if(!e||e.isSameSize(t))return;const i=Dt.copyAttrs({},this.canvas,Gt);e.resize(t),this.updateLazyBounds(),this.__onResize(new Nn(t,i))}__onResize(t){this.emitEvent(t),Dt.copyAttrs(this.__,t,Gt),t.width&&t.height||lh.warn("w = 0 or h = 0"),setTimeout((()=>{this.canvasManager&&this.canvasManager.clearRecycled()}),0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.__level=1}__checkAutoLayout(t,e){e||(t.width&&t.height||(this.autoLayout=new ct(t)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){return this.canvas&&(Gt.includes(t)?(e||lh.warn(t+" is 0"),this.__changeCanvasSize(t,e)):"fill"===t?this.__changeFill(e):"hittable"===t?this.parent||(this.canvas.hittable=e):"zIndex"===t&&(this.canvas.zIndex=e,setTimeout((()=>this.parent&&this.parent.__updateSortChildren())))),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&Gt.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const i=Dt.copyAttrs({},this.canvas,Gt);i[t]=this.config[t]=e,e&&this.canvas.stopAutoLayout(),this.__doResize(i)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready||(this.ready=!0,this.emitLeafer(jn.BEFORE_READY),this.emitLeafer(jn.READY),this.emitLeafer(jn.AFTER_READY),Bn.run(this.__readyWait))}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(jn.VIEW_READY),Bn.run(this.__viewReadyWait))}__onNextRender(){if(this.viewReady){Bn.run(this.__nextRenderWait);const{imageReady:t}=this;t&&!this.viewCompleted&&this.__checkViewCompleted(),t||(this.viewCompleted=!1)}}__checkViewCompleted(t=!0){this.nextRender((()=>{this.imageReady&&(t&&this.emitLeafer(jn.VIEW_COMPLETED),Bn.run(this.__viewCompletedWait),this.viewCompleted=!0)}))}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender((()=>this.interaction.updateCursor()))}waitInit(t,e){e&&(t=t.bind(e)),this.__initWait||(this.__initWait=[]),this.canvas?t():this.__initWait.push(t)}waitReady(t,e){e&&(t=t.bind(e)),this.ready?t():this.__readyWait.push(t)}waitViewReady(t,e){e&&(t=t.bind(e)),this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t,e){e&&(t=t.bind(e)),this.__viewCompletedWait.push(t),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(t,e,i){e&&(t=t.bind(e));const s=this.__nextRenderWait;if(i){for(let e=0;e<s.length;e++)if(s[e]===t){s.splice(e,1);break}}else s.push(t)}zoom(t,e,i){return lh.error("need @leafer-in/view")}getValidMove(t,e){return{x:t,y:e}}getValidScale(t){return t}getWorldPointByClient(t,e){return this.interaction&&this.interaction.getLocal(t,e)}getPagePointByClient(t,e){return this.getPagePoint(this.getWorldPointByClient(t,e))}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(t){}__checkUpdateLayout(){this.__layout.update()}emitLeafer(t){this.emitEvent(new jn(t,this))}__listenEvents(){const t=kt.start("FirstCreate "+this.innerName);this.once(jn.START,(()=>kt.end(t))),this.once(Vn.START,(()=>this.updateLazyBounds())),this.once(Vn.END,(()=>this.__onReady())),this.once(Gn.START,(()=>this.__onCreated())),this.once(Gn.END,(()=>this.__onViewReady())),this.__eventIds.push(this.on_(Yn.DATA,this.__onWatchData,this),this.on_(Gn.NEXT,this.__onNextRender,this),this.on_(Vn.CHECK_UPDATE,this.__checkUpdateLayout,this))}__removeListenEvents(){this.off_(this.__eventIds),this.__eventIds.length=0}destroy(t){const e=()=>{if(!this.destroyed){hh.list.remove(this);try{this.stop(),this.emitEvent(new jn(jn.END,this)),this.__removeListenEvents(),this.__controllers.forEach((t=>{this.parent&&t===this.interaction||t.destroy()})),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager.destroy()),this.canvas.destroy(),this.config.view=this.view=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout((()=>{co.clearRecycled()}),100)}catch(t){lh.error(t)}}};t?e():setTimeout(e)}},t.Leafer.list=new Xr,Wt([Yo(Va)],t.Leafer.prototype,"__",void 0),Wt([To()],t.Leafer.prototype,"pixelRatio",void 0),t.Leafer=hh=Wt([$o()],t.Leafer),t.Rect=class extends t.UI{get __tag(){return"Rect"}constructor(t){super(t)}},Wt([Yo(ja)],t.Rect.prototype,"__",void 0),t.Rect=Wt([Jo(rh),Ko(),$o()],t.Rect);const dh=t.Rect.prototype,ch=t.Group.prototype,uh={},{copy:ph,add:_h,includes:gh,copyAndSpread:fh}=nt;t.Box=class extends t.Group{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(t){const e=this.__;if(this.children.length){if(e.__autoSide){this.leafer&&this.leafer.ready&&this.leafer.layouter.addExtra(this),super.__updateBoxBounds();const{boxBounds:i}=this.__layout;e.__autoSize||(e.__autoWidth?(i.width+=i.x,i.height=e.height,i.y=i.x=0):(i.height+=i.y,i.width=e.width,i.x=i.y=0)),t&&e.flow&&e.padding&&fh(i,i,e.padding,!1,e.__autoSize?null:e.__autoWidth?"width":"height"),this.__updateNaturalSize()}else this.__updateRectBoxBounds();e.flow&&this.__updateContentBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t;const{renderBounds:e}=this.__layout;this.children.length?(super.__updateRenderBounds(),ph(uh,e),this.__updateRectRenderBounds(),t=!gh(e,uh)||!this.pathInputed||!this.__.cornerRadius):this.__updateRectRenderBounds(),this.isOverflow!==t&&(this.isOverflow=t),!(this.__.__drawAfterFill="hide"===this.__.overflow)&&t&&_h(e,uh)}__updateRectRenderBounds(){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.children.length&&this.__renderGroup(t,e))}__drawAfterFill(t,e){const{length:i}=this.children;this.isOverflow?(t.save(),t.clip(),i&&this.__renderGroup(t,e),t.restore()):i&&this.__renderGroup(t,e),this.__.stroke&&i&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}},Wt([Yo(Ya)],t.Box.prototype,"__",void 0),Wt([xo(!1)],t.Box.prototype,"resizeChildren",void 0),Wt([Mo("show")],t.Box.prototype,"overflow",void 0),Wt([Zo(dh.__updateStrokeSpread)],t.Box.prototype,"__updateStrokeSpread",null),Wt([Zo(dh.__updateRenderSpread)],t.Box.prototype,"__updateRectRenderSpread",null),Wt([Zo(dh.__updateBoxBounds)],t.Box.prototype,"__updateRectBoxBounds",null),Wt([Zo(dh.__updateStrokeBounds)],t.Box.prototype,"__updateStrokeBounds",null),Wt([Zo(dh.__updateRenderBounds)],t.Box.prototype,"__updateRectRenderBounds",null),Wt([Zo(dh.__updateChange)],t.Box.prototype,"__updateRectChange",null),Wt([Zo(dh.__render)],t.Box.prototype,"__renderRect",null),Wt([Zo(ch.__render)],t.Box.prototype,"__renderGroup",null),t.Box=Wt([Ko(),$o()],t.Box),t.Frame=class extends t.Box{get __tag(){return"Frame"}get isFrame(){return!0}constructor(t){super(t)}},Wt([Yo(Xa)],t.Frame.prototype,"__",void 0),Wt([Io("#FFFFFF")],t.Frame.prototype,"fill",void 0),Wt([Mo("hide")],t.Frame.prototype,"overflow",void 0),t.Frame=Wt([$o()],t.Frame);const{moveTo:yh,closePath:vh,ellipse:mh}=Wi;t.Ellipse=class extends t.UI{get __tag(){return"Ellipse"}constructor(t){super(t)}__updatePath(){const{width:t,height:i,innerRadius:s,startAngle:o,endAngle:n}=this.__,r=t/2,a=i/2,h=this.__.path=[];s?(o||n?(s<1&&mh(h,r,a,r*s,a*s,0,o,n,!1),mh(h,r,a,r,a,0,n,o,!0),s<1&&vh(h)):(s<1&&(mh(h,r,a,r*s,a*s),yh(h,t,a)),mh(h,r,a,r,a,0,360,0,!0)),e.ellipseToCurve&&(this.__.path=this.getPath(!0))):o||n?(yh(h,r,a),mh(h,r,a,r,a,0,o,n,!1),vh(h)):mh(h,r,a,r,a)}},Wt([Yo(Za)],t.Ellipse.prototype,"__",void 0),Wt([Co(0)],t.Ellipse.prototype,"innerRadius",void 0),Wt([Co(0)],t.Ellipse.prototype,"startAngle",void 0),Wt([Co(0)],t.Ellipse.prototype,"endAngle",void 0),t.Ellipse=Wt([$o()],t.Ellipse);const{moveTo:wh,lineTo:xh,drawPoints:bh}=Wi,{rotate:Eh,getAngle:kh,getDistance:Bh,defaultPoint:Th}=D,{toBounds:Lh}=js;t.Line=class extends t.UI{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:e}=this.__,i={x:0,y:0};return t&&(i.x=t),e&&Eh(i,e),i}set toPoint(t){this.width=Bh(Th,t),this.rotation=kh(Th,t),this.height&&(this.height=0)}constructor(t){super(t)}__updatePath(){const t=this.__,e=t.path=[];t.points?bh(e,t.points,!1,t.closed):(wh(e,0,0),xh(e,this.width,0))}__updateRenderPath(){const t=this.__;!this.pathInputed&&t.points&&t.curve?(bh(t.__pathForRender=[],t.points,t.curve,t.closed),t.__useArrow&&Ba.addArrows(this,!1)):super.__updateRenderPath()}__updateBoxBounds(){this.points?Lh(this.__.__pathForRender,this.__layout.boxBounds):super.__updateBoxBounds()}},Wt([Yo(Ga)],t.Line.prototype,"__",void 0),Wt([So("center")],t.Line.prototype,"strokeAlign",void 0),Wt([To(0)],t.Line.prototype,"height",void 0),Wt([Co()],t.Line.prototype,"points",void 0),Wt([Co(0)],t.Line.prototype,"curve",void 0),Wt([Co(!1)],t.Line.prototype,"closed",void 0),t.Line=Wt([$o()],t.Line);const{sin:Ph,cos:Rh,PI:Ch}=Math,{moveTo:Sh,lineTo:Oh,closePath:Dh,drawPoints:Mh}=Wi,Ih=t.Line.prototype;t.Polygon=class extends t.UI{get __tag(){return"Polygon"}constructor(t){super(t)}__updatePath(){const t=this.__.path=[];if(this.__.points)Mh(t,this.__.points,!1,!0);else{const{width:e,height:i,sides:s}=this.__,o=e/2,n=i/2;Sh(t,o,0);for(let e=1;e<s;e++)Oh(t,o+o*Ph(2*e*Ch/s),n-n*Rh(2*e*Ch/s))}Dh(t)}__updateRenderPath(){}__updateBoxBounds(){}},Wt([Yo(Ka)],t.Polygon.prototype,"__",void 0),Wt([Co(3)],t.Polygon.prototype,"sides",void 0),Wt([Co()],t.Polygon.prototype,"points",void 0),Wt([Co(0)],t.Polygon.prototype,"curve",void 0),Wt([Zo(Ih.__updateRenderPath)],t.Polygon.prototype,"__updateRenderPath",null),Wt([Zo(Ih.__updateBoxBounds)],t.Polygon.prototype,"__updateBoxBounds",null),t.Polygon=Wt([Ko(),$o()],t.Polygon);const{sin:Ah,cos:Wh,PI:zh}=Math,{moveTo:Fh,lineTo:Uh,closePath:Hh}=Wi;t.Star=class extends t.UI{get __tag(){return"Star"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,corners:i,innerRadius:s}=this.__,o=t/2,n=e/2,r=this.__.path=[];Fh(r,o,0);for(let t=1;t<2*i;t++)Uh(r,o+(t%2==0?o:o*s)*Ah(t*zh/i),n-(t%2==0?n:n*s)*Wh(t*zh/i));Hh(r)}},Wt([Yo(qa)],t.Star.prototype,"__",void 0),Wt([Co(5)],t.Star.prototype,"corners",void 0),Wt([Co(.382)],t.Star.prototype,"innerRadius",void 0),t.Star=Wt([$o()],t.Star),t.Image=class extends t.Rect{get __tag(){return"Image"}get ready(){return!!this.image&&this.image.ready}constructor(t){super(t),this.on(Hn.LOADED,(t=>{"fill"===t.attrName&&t.attrValue.url===this.url&&(this.image=t.image)}))}destroy(){this.image=null,super.destroy()}},Wt([Yo(eh)],t.Image.prototype,"__",void 0),Wt([To("")],t.Image.prototype,"url",void 0),t.Image=Wt([$o()],t.Image);const Nh=t.Image;t.Canvas=class extends t.Rect{get __tag(){return"Canvas"}get ready(){return!this.url}constructor(t){super(t),this.canvas=i.canvas(this.__),this.context=this.canvas.context,this.__.__isCanvas=this.__.__drawAfterFill=!0,t&&t.url&&this.drawImage(t.url)}drawImage(t){new go({url:t}).load((t=>{this.context.drawImage(t.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new Hn(Hn.LOADED,{image:t}))}))}draw(t,e,i,s){t.__layout.update();const o=new U(t.__world).invert(),n=new U;e&&n.translate(e.x,e.y),i&&("number"==typeof i?n.scale(i):n.scale(i.x,i.y)),s&&n.rotate(s),o.multiplyParent(n),t.__render(this.canvas,{matrix:o.withScale()}),this.paint()}paint(){this.forceUpdate("fill")}__drawAfterFill(t,e){const i=this.canvas.view,{width:s,height:o}=this;this.__.cornerRadius||this.pathInputed?(t.save(),t.clip(),t.drawImage(this.canvas.view,0,0,i.width,i.height,0,0,s,o),t.restore()):t.drawImage(this.canvas.view,0,0,i.width,i.height,0,0,s,o)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e}=this.__;t.smooth!==e&&(t.smooth=e),t.resize(this.__)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=this.context=null),super.destroy()}},Wt([Yo(ih)],t.Canvas.prototype,"__",void 0),Wt([Ia(100)],t.Canvas.prototype,"width",void 0),Wt([Ia(100)],t.Canvas.prototype,"height",void 0),Wt([Ia(1)],t.Canvas.prototype,"pixelRatio",void 0),Wt([Ia(!0)],t.Canvas.prototype,"smooth",void 0),Wt([Ia()],t.Canvas.prototype,"contextSettings",void 0),t.Canvas=Wt([$o()],t.Canvas);const{copyAndSpread:Yh,includes:Vh,isSame:Xh,spread:Gh,setList:jh}=nt;t.Text=class extends t.UI{get __tag(){return"Text"}get editInner(){return"TextEditor"}get textDrawData(){return this.__layout.update(),this.__.__textDrawData}constructor(t){super(t)}__drawHitPath(t){const{__lineHeight:e,fontSize:i,__baseLine:s,__textDrawData:o}=this.__;t.beginPath(),this.__.__letterSpacing<0?this.__drawPathByData(t):o.rows.forEach((o=>t.rect(o.x,o.y-s,o.width,e<i?i:e)))}__drawPathByData(t,e){const{x:i,y:s,width:o,height:n}=this.__layout.boxBounds;t.rect(i,s,o,n)}__drawRenderPath(t){t.font=this.__.__font}__updateTextDrawData(){const t=this.__;t.__textDrawData=Ea.getDrawData(t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{lineHeight:i,letterSpacing:s,fontFamily:o,fontSize:n,fontWeight:r,italic:a,textCase:l,textOverflow:d,padding:c}=t,u=t.__autoWidth,p=t.__autoHeight;t.__lineHeight=Ha.number(i,n),t.__letterSpacing=Ha.number(s,n),t.__padding=c?h.fourNumber(c):void 0,t.__baseLine=t.__lineHeight-(t.__lineHeight-.7*n)/2,t.__font=`${a?"italic ":""}${"small-caps"===l?"small-caps ":""}${"normal"!==r?r+" ":""}${n}px ${o}`,t.__clipText="show"!==d&&!t.__autoSize,this.__updateTextDrawData();const{bounds:_}=t.__textDrawData,g=e.boxBounds;if(t.__lineHeight<n&&Gh(_,n/2),u||p){if(g.x=u?_.x:0,g.y=p?_.y:0,g.width=u?_.width:t.width,g.height=p?_.height:t.height,c){const[e,i,s,o]=t.__padding;u&&(g.x-=o,g.width+=i+o),p&&(g.y-=e,g.height+=s+e)}this.__updateNaturalSize()}else super.__updateBoxBounds();a&&(g.width+=.16*n);const f=Vh(g,_)?g:_;Xh(f,e.contentBounds)?t.__textBoxBounds=f:(e.contentBounds=f,e.renderChanged=!0,jh(t.__textBoxBounds={},[g,_]))}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.__layout.boxBounds===this.__layout.contentBounds?0:1),t}__updateRenderBounds(){Yh(this.__layout.renderBounds,this.__.__textBoxBounds,this.__layout.renderSpread)}},Wt([Yo(th)],t.Text.prototype,"__",void 0),Wt([To(0)],t.Text.prototype,"width",void 0),Wt([To(0)],t.Text.prototype,"height",void 0),Wt([xo(!1)],t.Text.prototype,"resizeFontSize",void 0),Wt([Io("#000000")],t.Text.prototype,"fill",void 0),Wt([So("outside")],t.Text.prototype,"strokeAlign",void 0),Wt([Ho("all")],t.Text.prototype,"hitFill",void 0),Wt([To("")],t.Text.prototype,"text",void 0),Wt([To("L")],t.Text.prototype,"fontFamily",void 0),Wt([To(12)],t.Text.prototype,"fontSize",void 0),Wt([To("normal")],t.Text.prototype,"fontWeight",void 0),Wt([To(!1)],t.Text.prototype,"italic",void 0),Wt([To("none")],t.Text.prototype,"textCase",void 0),Wt([To("none")],t.Text.prototype,"textDecoration",void 0),Wt([To(0)],t.Text.prototype,"letterSpacing",void 0),Wt([To({type:"percent",value:1.5})],t.Text.prototype,"lineHeight",void 0),Wt([To(0)],t.Text.prototype,"paraIndent",void 0),Wt([To(0)],t.Text.prototype,"paraSpacing",void 0),Wt([To("left")],t.Text.prototype,"textAlign",void 0),Wt([To("top")],t.Text.prototype,"verticalAlign",void 0),Wt([To("normal")],t.Text.prototype,"textWrap",void 0),Wt([To("show")],t.Text.prototype,"textOverflow",void 0),t.Text=Wt([$o()],t.Text),t.Path=class extends t.UI{get __tag(){return"Path"}constructor(t){super(t),this.__.__pathInputed=2}},Wt([Yo(Ja)],t.Path.prototype,"__",void 0),Wt([So("center")],t.Path.prototype,"strokeAlign",void 0),t.Path=Wt([$o()],t.Path),t.Pen=class extends t.Group{get __tag(){return"Pen"}constructor(t){super(t)}setStyle(e){const i=this.pathElement=new t.Path(e);return this.pathStyle=e,this.__path=i.path||(i.path=[]),this.add(i),this}beginPath(){return this.__path.length=0,this.paint(),this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,i,s,o,n){return this}quadraticCurveTo(t,e,i,s){return this}closePath(){return this}rect(t,e,i,s){return this}roundRect(t,e,i,s,o){return this}ellipse(t,e,i,s,o,n,r,a){return this}arc(t,e,i,s,o,n){return this}arcTo(t,e,i,s,o){return this}drawEllipse(t,e,i,s,o,n,r,a){return this}drawArc(t,e,i,s,o,n){return this}drawPoints(t,e,i){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}},Wt([Yo($a)],t.Pen.prototype,"__",void 0),Wt([(t,e)=>{fo(t,e,{get(){return this.__path}})}],t.Pen.prototype,"path",void 0),t.Pen=Wt([Jo(ts,["set","beginPath","path","paint"]),$o()],t.Pen),t.App=class extends t.Leafer{get __tag(){return"App"}get isApp(){return!0}constructor(t,e){super(t,e)}init(t,e){if(super.init(t,e),t){const{ground:e,tree:s,sky:o,editor:n}=t;e&&(this.ground=this.addLeafer(e)),(s||n)&&(this.tree=this.addLeafer(s)),(o||n)&&(this.sky=this.addLeafer(o||{type:"draw",usePartRender:!1})),n&&(this.editor=i.editor(n),this.sky.add(this.editor))}}__setApp(){const{canvas:t}=this,{realCanvas:e,view:i}=this.config;e||i===this.canvas.view||!t.parentView?this.realCanvas=!0:t.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable(),this.__eventIds.push(this.on_(Un.CHANGE,this.__onPropertyChange,this))}start(){super.start(),this.children.forEach((t=>t.start()))}stop(){this.children.forEach((t=>t.stop())),super.stop()}unlockLayout(){super.unlockLayout(),this.children.forEach((t=>t.unlockLayout()))}lockLayout(){super.lockLayout(),this.children.forEach((t=>t.lockLayout()))}forceRender(t){this.children.forEach((e=>e.forceRender(t)))}addLeafer(e){const i=new t.Leafer(e);return this.add(i),i}add(t,e){if(!t.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout((()=>this.add(t,e)),10);t.init(this.__getChildConfig(t.userConfig),this)}super.add(t,e),void 0!==e&&(t.canvas.childIndex=e),this.__listenChildEvents(t)}__onPropertyChange(){wt.showHitView&&this.children.forEach((t=>t.forceUpdate("surface")))}__onCreated(){this.created=this.children.every((t=>t.created))}__onReady(){this.children.every((t=>t.ready))&&super.__onReady()}__onViewReady(){this.children.every((t=>t.viewReady))&&super.__onViewReady()}__onChildRenderEnd(t){this.renderer.addBlock(t.renderBounds),this.viewReady&&this.renderer.update()}__render(t,e){if(t.context){if(e.matrix){const{a:i,b:s,c:o,d:n,e:r,f:a}=e.matrix;t.setTransform(i,s,o,n,r,a)}this.children.forEach((e=>t.copyWorld(e.canvas)))}}__onResize(t){this.children.forEach((e=>e.resize(t))),super.__onResize(t)}__checkUpdateLayout(){this.children.forEach((t=>t.__layout.update()))}__getChildConfig(t){let e=Object.assign({},this.config);return e.hittable=e.realCanvas=void 0,t&&Dt.assign(e,t),this.autoLayout&&Dt.copyAttrs(e,this,Gt),e.view=this.realCanvas?void 0:this.view,e.fill=void 0,e}__listenChildEvents(t){t.once(Vn.END,(()=>this.__onReady())),t.once(Gn.START,(()=>this.__onCreated())),t.once(Gn.END,(()=>this.__onViewReady())),this.realCanvas&&this.__eventIds.push(t.on_(Gn.END,this.__onChildRenderEnd,this))}},t.App=Wt([$o()],t.App);const Zh={},Kh={isHoldSpaceKey:()=>Kh.isHold("Space"),isHold:t=>Zh[t],setDownCode(t){Zh[t]||(Zh[t]=!0)},setUpCode(t){Zh[t]=!1}},qh={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(t){t.buttons||(t.buttons=1)},left:t=>1===t.buttons,right:t=>2===t.buttons,middle:t=>4===t.buttons};class Jh extends zn{get spaceKey(){return Kh.isHoldSpaceKey()}get left(){return qh.left(this)}get right(){return qh.right(this)}get middle(){return qh.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}getPage(){return this.current.getPagePoint(this)}getInner(t){return t||(t=this.current),t.getInnerPoint(this)}getLocal(t){return t||(t=this.current),t.getLocalPoint(this)}static changeName(t,e){Ct.changeName(t,e)}}t.PointerEvent=class extends Jh{},t.PointerEvent.POINTER="pointer",t.PointerEvent.BEFORE_DOWN="pointer.before_down",t.PointerEvent.BEFORE_MOVE="pointer.before_move",t.PointerEvent.BEFORE_UP="pointer.before_up",t.PointerEvent.DOWN="pointer.down",t.PointerEvent.MOVE="pointer.move",t.PointerEvent.UP="pointer.up",t.PointerEvent.OVER="pointer.over",t.PointerEvent.OUT="pointer.out",t.PointerEvent.ENTER="pointer.enter",t.PointerEvent.LEAVE="pointer.leave",t.PointerEvent.TAP="tap",t.PointerEvent.DOUBLE_TAP="double_tap",t.PointerEvent.CLICK="click",t.PointerEvent.DOUBLE_CLICK="double_click",t.PointerEvent.LONG_PRESS="long_press",t.PointerEvent.LONG_TAP="long_tap",t.PointerEvent.MENU="pointer.menu",t.PointerEvent.MENU_TAP="pointer.menu_tap",t.PointerEvent=Wt([Qo()],t.PointerEvent);const $h=t.PointerEvent,Qh={};t.DragEvent=class extends t.PointerEvent{static setList(t){this.list=t instanceof Xr?t:new Xr(t)}static setData(t){this.data=t}static getValidMove(t,e,i){const{draggable:s,dragBounds:o,x:n,y:r}=t,a=t.getLocalPoint(i,null,!0);return a.x+=e.x-n,a.y+=e.y-r,o&&this.getMoveInDragBounds(t.__local,"parent"===o?t.parent.boxBounds:o,a,!0),"x"===s&&(a.y=0),"y"===s&&(a.x=0),a}static getMoveInDragBounds(t,e,i,s){const o=t.x+i.x,n=t.y+i.y,r=o+t.width,a=n+t.height,h=e.x+e.width,l=e.y+e.height;return s||(i=Object.assign({},i)),nt.includes(t,e)?(o>e.x?i.x+=e.x-o:r<h&&(i.x+=h-r),n>e.y?i.y+=e.y-n:a<l&&(i.y+=l-a)):(o<e.x?i.x+=e.x-o:r>h&&(i.x+=h-r),n<e.y?i.y+=e.y-n:a>l&&(i.y+=l-a)),i}getPageMove(t){return this.assignMove(t),this.current.getPagePoint(Qh,null,!0)}getInnerMove(t,e){return t||(t=this.current),this.assignMove(e),t.getInnerPoint(Qh,null,!0)}getLocalMove(t,e){return t||(t=this.current),this.assignMove(e),t.getLocalPoint(Qh,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}getPageBounds(){const t=this.getPageTotal(),e=this.getPage(),i={};return nt.set(i,e.x-t.x,e.y-t.y,t.x,t.y),nt.unsign(i),i}assignMove(t){Qh.x=t?this.totalX:this.moveX,Qh.y=t?this.totalY:this.moveY}},t.DragEvent.BEFORE_DRAG="drag.before_drag",t.DragEvent.START="drag.start",t.DragEvent.DRAG="drag",t.DragEvent.END="drag.end",t.DragEvent.OVER="drag.over",t.DragEvent.OUT="drag.out",t.DragEvent.ENTER="drag.enter",t.DragEvent.LEAVE="drag.leave",t.DragEvent=Wt([Qo()],t.DragEvent);const tl=t.DragEvent;function el(e){e.isApp||e.__eventIds.push(e.on_(t.MoveEvent.BEFORE_MOVE,(t=>{e.zoomLayer.move(e.getValidMove(t.moveX,t.moveY))})),e.on_(t.ZoomEvent.BEFORE_ZOOM,(t=>{const{zoomLayer:i}=e,s=e.getValidScale(t.scale);1!==s&&(D.scaleOf(i,t,s),i.scale=i.__.scaleX*s)})))}t.DropEvent=class extends t.PointerEvent{static setList(e){t.DragEvent.setList(e)}static setData(e){t.DragEvent.setData(e)}},t.DropEvent.DROP="drop",t.DropEvent=Wt([Qo()],t.DropEvent),t.MoveEvent=class extends t.DragEvent{},t.MoveEvent.BEFORE_MOVE="move.before_move",t.MoveEvent.START="move.start",t.MoveEvent.MOVE="move",t.MoveEvent.END="move.end",t.MoveEvent=Wt([Qo()],t.MoveEvent),t.RotateEvent=class extends Jh{},t.RotateEvent.BEFORE_ROTATE="rotate.before_rotate",t.RotateEvent.START="rotate.start",t.RotateEvent.ROTATE="rotate",t.RotateEvent.END="rotate.end",t.RotateEvent=Wt([Qo()],t.RotateEvent),t.SwipeEvent=class extends t.DragEvent{},t.SwipeEvent.SWIPE="swipe",t.SwipeEvent.LEFT="swipe.left",t.SwipeEvent.RIGHT="swipe.right",t.SwipeEvent.UP="swipe.up",t.SwipeEvent.DOWN="swipe.down",t.SwipeEvent=Wt([Qo()],t.SwipeEvent),t.ZoomEvent=class extends Jh{},t.ZoomEvent.BEFORE_ZOOM="zoom.before_zoom",t.ZoomEvent.START="zoom.start",t.ZoomEvent.ZOOM="zoom",t.ZoomEvent.END="zoom.end",t.ZoomEvent=Wt([Qo()],t.ZoomEvent),t.KeyEvent=class extends Jh{},t.KeyEvent.DOWN="key.down",t.KeyEvent.HOLD="key.hold",t.KeyEvent.UP="key.up",t.KeyEvent=Wt([Qo()],t.KeyEvent);const il=wt.get("LeaferTypeCreator"),sl={list:{},register(t,e){ol[t]?il.repeat(t):ol[t]=e},run(t,e){const i=ol[t];i&&i(e)}},{list:ol,register:nl}=sl;nl("design",el),nl("document",(function(t){el(t);const{move:e,zoom:i}=t.config;e.scroll="limit",i.min=1})),nl("block",(function(t){const{config:e}=t;(e.wheel||(e.wheel={})).preventDefault=!1,(e.touch||(e.touch={})).preventDefault="auto"}));const rl=t.Leafer.prototype;rl.initType=function(t){sl.run(t,this)},rl.getValidMove=function(t,e){const{scroll:i,disabled:s}=this.app.config.move;if(i&&(Math.abs(t)>Math.abs(e)?e=0:t=0,"limit"===i)){const{x:i,y:s,width:o,height:n}=new lt(this.__world).addPoint(this.zoomLayer),r=i+o-this.width,a=s+n-this.height;i>=0&&r<=0?t=0:t>0?i+t>0&&(t=-i):t<0&&r+t<0&&(t=-r),s>=0&&a<=0?e=0:e>0?s+e>0&&(e=-s):e<0&&a+e<0&&(e=-a)}return{x:s?0:t,y:s?0:e}},rl.getValidScale=function(t){const{scaleX:e}=this.zoomLayer.__,{min:i,max:s,disabled:o}=this.app.config.zoom,n=Math.abs(e*t);return n<i?t=i/e:n>s&&(t=s/e),o?1:t};class al{get transforming(){return!!(this.moveData||this.zoomData||this.rotateData)}constructor(t){this.interaction=t}move(e){const{interaction:i}=this;if(e.moveType||(e.moveType="move"),!this.moveData){const{path:s}=i.selector.getByPoint(e,i.hitRadius);e.path=s,this.moveData=Object.assign(Object.assign({},e),{moveX:0,moveY:0}),i.cancelHover(),i.emit(t.MoveEvent.START,this.moveData)}e.path=this.moveData.path,i.emit(t.MoveEvent.BEFORE_MOVE,e),i.emit(t.MoveEvent.MOVE,e),this.transformEndWait()}zoom(e){const{interaction:i}=this;if(!this.zoomData){const{path:s}=i.selector.getByPoint(e,i.hitRadius);e.path=s,this.zoomData=Object.assign(Object.assign({},e),{scale:1}),i.cancelHover(),i.emit(t.ZoomEvent.START,this.zoomData)}e.path=this.zoomData.path,i.emit(t.ZoomEvent.BEFORE_ZOOM,e),i.emit(t.ZoomEvent.ZOOM,e),this.transformEndWait()}rotate(e){const{interaction:i}=this;if(!this.rotateData){const{path:s}=i.selector.getByPoint(e,i.hitRadius);e.path=s,this.rotateData=Object.assign(Object.assign({},e),{rotation:0}),i.cancelHover(),i.emit(t.RotateEvent.START,this.rotateData)}e.path=this.rotateData.path,i.emit(t.RotateEvent.BEFORE_ROTATE,e),i.emit(t.RotateEvent.ROTATE,e),this.transformEndWait()}transformEndWait(){clearTimeout(this.transformTimer),this.transformTimer=setTimeout((()=>{this.transformEnd()}),this.interaction.config.pointer.transformTime)}transformEnd(){this.moveEnd(),this.zoomEnd(),this.rotateEnd()}moveEnd(){this.moveData&&(this.interaction.emit(t.MoveEvent.END,this.moveData),this.moveData=null)}zoomEnd(){this.zoomData&&(this.interaction.emit(t.ZoomEvent.END,this.zoomData),this.zoomData=null)}rotateEnd(){this.rotateData&&(this.interaction.emit(t.RotateEvent.END,this.rotateData),this.rotateData=null)}destroy(){this.zoomData=this.moveData=this.rotateData=null}}const hl={getMoveEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:t.x,y:t.y,moveX:e.x,moveY:e.y}),getRotateEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:t.x,y:t.y,rotation:e}),getZoomEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:t.x,y:t.y,scale:e}),getDragEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:i.x,y:i.y,moveX:i.x-e.x,moveY:i.y-e.y,totalX:i.x-t.x,totalY:i.y-t.y}),getDropEventData:(t,e,i)=>Object.assign(Object.assign({},t),{list:e,data:i}),getSwipeDirection:e=>e<-45&&e>-135?t.SwipeEvent.UP:e>45&&e<135?t.SwipeEvent.DOWN:e<=45&&e>=-45?t.SwipeEvent.RIGHT:t.SwipeEvent.LEFT,getSwipeEventData:(t,e,i)=>Object.assign(Object.assign({},i),{moveX:e.moveX,moveY:e.moveY,totalX:i.x-t.x,totalY:i.y-t.y,type:ll.getSwipeDirection(D.getAngle(t,i))}),getBase(t){const e=1===t.button?4:t.button;return{altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,buttons:void 0===t.buttons?1:0===t.buttons?e:t.buttons,origin:t}},pathHasEventType(t,e){const{list:i}=t;for(let t=0,s=i.length;t<s;t++)if(i[t].hasEvent(e))return!0;return!1},filterPathByEventType(t,e){const i=new Xr,{list:s}=t;for(let t=0,o=s.length;t<o;t++)s[t].hasEvent(e)&&i.add(s[t]);return i},pathCanDrag:e=>e&&e.list.some((e=>e.draggable||e.editable||!e.isLeafer&&e.hasEvent(t.DragEvent.DRAG))),pathHasOutside:t=>t&&t.list.some((t=>t.isOutside))},ll=hl,dl=new Xr,{getDragEventData:cl,getDropEventData:ul,getSwipeEventData:pl}=hl;class _l{constructor(t){this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=cl(t,t,t),this.canAnimate=this.canDragOut=!0}getList(){const{proxy:e}=this.interaction.selector;return!this.dragging||e&&e.list.length?dl:t.DragEvent.list||this.dragableList||dl}checkDrag(e,i){const{interaction:s}=this;if(this.moving&&e.buttons<1)return this.canAnimate=!1,void s.pointerCancel();!this.moving&&i&&(this.moving=s.canMove(this.downData)||s.isHoldRightKey||s.isMobileDragEmpty)&&(this.dragData.moveType="drag",s.emit(t.MoveEvent.START,this.dragData)),this.moving||this.dragStart(e,i),this.drag(e)}dragStart(e,i){this.dragging||(this.dragging=i&&qh.left(e),this.dragging&&(this.interaction.emit(t.DragEvent.START,this.dragData),this.getDragableList(this.dragData.path),this.setDragStartPoints(this.realDragableList=this.getList())))}setDragStartPoints(t){this.dragStartPoints={},t.forEach((t=>this.dragStartPoints[t.innerId]={x:t.x,y:t.y}))}getDragableList(t){let e;for(let i=0,s=t.length;i<s;i++)if(e=t.list[i],(e.__.draggable||e.__.editable)&&e.__.hitSelf&&!e.__.locked){this.dragableList=new Xr(e);break}}drag(e){const{interaction:i,dragData:s,downData:o}=this,{path:n,throughPath:r}=o;this.dragData=cl(o,s,e),r&&(this.dragData.throughPath=r),this.dragData.path=n,this.moving?(this.dragData.moveType="drag",i.emit(t.MoveEvent.BEFORE_MOVE,this.dragData),i.emit(t.MoveEvent.MOVE,this.dragData)):this.dragging&&(this.dragReal(),i.emit(t.DragEvent.BEFORE_DRAG,this.dragData),i.emit(t.DragEvent.DRAG,this.dragData))}dragReal(){const{running:e}=this.interaction,i=this.realDragableList;if(i.length&&e){const{totalX:e,totalY:s}=this.dragData;i.forEach((i=>i.draggable&&i.move(t.DragEvent.getValidMove(i,this.dragStartPoints[i.innerId],{x:e,y:s}))))}}dragOverOrOut(e){const{interaction:i}=this,{dragOverPath:s}=this,{path:o}=e;this.dragOverPath=o,s?o.indexAt(0)!==s.indexAt(0)&&(i.emit(t.DragEvent.OUT,e,s),i.emit(t.DragEvent.OVER,e,o)):i.emit(t.DragEvent.OVER,e,o)}dragEnterOrLeave(e){const{interaction:i}=this,{dragEnterPath:s}=this,{path:o}=e;i.emit(t.DragEvent.LEAVE,e,s,o),i.emit(t.DragEvent.ENTER,e,o,s),this.dragEnterPath=o}dragEnd(t,e){if(!this.dragging&&!this.moving)return;const{moveX:i,moveY:s}=this.dragData;this.interaction.config.move.dragAnimate&&this.canAnimate&&this.moving&&(Math.abs(i)>1||Math.abs(s)>1)?(t=Object.assign({},t),e=.9*(e||("touch"===t.pointerType?2:1)),D.move(t,i*e,s*e),this.drag(t),this.animate((()=>{this.dragEnd(t,1)}))):this.dragEndReal(t)}dragEndReal(e){const{interaction:i,downData:s,dragData:o}=this;e||(e=o);const{path:n,throughPath:r}=s,a=cl(s,e,e);if(r&&(a.throughPath=r),a.path=n,this.moving&&(this.moving=!1,a.moveType="drag",i.emit(t.MoveEvent.END,a)),this.dragging){const n=this.getList();this.dragging=!1,i.emit(t.DragEvent.END,a),this.swipe(e,s,o,a),this.drop(e,n,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}animate(t,e){const i=t||this.animateWait;i&&this.interaction.target.nextRender(i,null,e),this.animateWait=t}swipe(t,e,i,s){const{interaction:o}=this;if(D.getDistance(e,t)>o.config.pointer.swipeDistance){const t=pl(e,i,s);this.interaction.emit(t.type,t)}}drop(e,i,s){const o=ul(e,i,t.DragEvent.data);o.path=s,this.interaction.emit(t.DropEvent.DROP,o),this.interaction.emit(t.DragEvent.LEAVE,e,s)}dragReset(){t.DragEvent.list=t.DragEvent.data=this.dragableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null}checkDragOut(t){const{interaction:e}=this;this.autoMoveCancel(),this.dragging&&!e.shrinkCanvasBounds.hitPoint(t)&&this.autoMoveOnDragOut(t)}autoMoveOnDragOut(t){const{interaction:e,downData:i,canDragOut:s}=this,{autoDistance:o,dragOut:n}=e.config.move;if(!n||!s||!o)return;const r=e.shrinkCanvasBounds,{x:a,y:h}=r,l=nt.maxX(r),d=nt.maxY(r),c=t.x<a?o:l<t.x?-o:0,u=t.y<h?o:d<t.y?-o:0;let p=0,_=0;this.autoMoveTimer=setInterval((()=>{p+=c,_+=u,D.move(i,c,u),D.move(this.dragData,c,u),e.move(Object.assign(Object.assign({},t),{moveX:c,moveY:u,totalX:p,totalY:_,moveType:"drag"})),e.pointerMoveReal(t)}),10)}autoMoveCancel(){this.autoMoveTimer&&(clearInterval(this.autoMoveTimer),this.autoMoveTimer=0)}destroy(){this.dragReset()}}const gl=wt.get("emit");const fl=["move","zoom","rotate","key"];function yl(t,e,i,s,o){if(fl.some((t=>e.startsWith(t)))&&t.__.hitChildren&&!ml(t,o)){let n;for(let r=0,a=t.children.length;r<a;r++)n=t.children[r],!i.path.has(n)&&n.__.hittable&&vl(n,e,i,s,o)}}function vl(t,e,i,s,o){if(t.destroyed)return!1;if(t.__.hitSelf&&!ml(t,o)&&(Sa.updateEventStyle&&Sa.updateEventStyle(t,e),t.hasEvent(e,s))){i.phase=s?1:t===i.target?2:3;const o=Ct.get(e,i);if(t.emitEvent(o,s),o.isStop)return!0}return!1}function ml(t,e){return e&&e.has(t)}const wl={getData(t){const e=t[0],i=t[1],s=D.getCenter(e.from,i.from),o=D.getCenter(e.to,i.to),n={x:o.x-s.x,y:o.y-s.y},r=D.getDistance(e.from,i.from);return{move:n,scale:D.getDistance(e.to,i.to)/r,angle:D.getRotation(e.from,i.from,e.to,i.to),center:o}}},xl={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8},preventDefault:!0},pointer:{hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20,preventDefaultMenu:!0},touch:{preventDefault:!0},cursor:!0,keyEvent:!0},{pathHasEventType:bl,getMoveEventData:El,getZoomEventData:kl,getRotateEventData:Bl,pathCanDrag:Tl,pathHasOutside:Ll}=hl;class Pl{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return!0===this.config.move.drag||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.config.pointer.hover&&!this.config.mobile}get isDragEmpty(){return this.config.move.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.config.move.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.config.move.holdMiddleKey&&this.downData&&qh.middle(this.downData)}get isHoldRightKey(){return this.config.move.holdRightKey&&this.downData&&qh.right(this.downData)}get isHoldSpaceKey(){return this.config.move.holdSpaceKey&&Kh.isHoldSpaceKey()}get hitRadius(){return this.config.pointer.hitRadius}constructor(t,e,i,s){this.config=Dt.clone(xl),this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=e,this.selector=i,this.defaultPath=new Xr(t),this.transformer=new al(this),this.dragger=new _l(this),s&&(this.config=Dt.default(s,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(e,i){e||(e=this.hoverData),e&&(qh.defaultLeft(e),this.updateDownData(e),this.checkPath(e,i),this.downTime=Date.now(),this.emit(t.PointerEvent.BEFORE_DOWN,e),this.emit(t.PointerEvent.DOWN,e),qh.left(e)&&(this.tapWait(),this.longPressWait(e)),this.waitMenuTap=qh.right(e),this.dragger.setDragData(e),this.isHoldRightKey||this.updateCursor(e))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:e}=this;e&&qh.defaultLeft(t);(this.canvas.bounds.hitPoint(t)||e)&&(this.pointerMoveReal(t),e&&this.dragger.checkDragOut(t))}pointerMoveReal(e){const{dragHover:i,dragDistance:s}=this.config.pointer;if(this.emit(t.PointerEvent.BEFORE_MOVE,e,this.defaultPath),this.downData){const t=D.getDistance(this.downData,e)>s;t&&(this.waitTap&&this.pointerWaitCancel(),this.waitMenuTap=!1),this.dragger.checkDrag(e,t)}this.dragger.moving||(this.updateHoverData(e),this.checkPath(e),this.emit(t.PointerEvent.MOVE,e),this.dragging&&!i||this.pointerHover(e),this.dragger.dragging&&(this.dragger.dragOverOrOut(e),this.dragger.dragEnterOrLeave(e))),this.updateCursor(this.downData||e)}pointerUp(e){const{downData:i}=this;if(e||(e=i),!i)return;qh.defaultLeft(e),e.multiTouch=i.multiTouch,this.findPath(e);const s=Object.assign(Object.assign({},e),{path:e.path.clone()});e.path.addList(i.path.list),this.checkPath(e),this.downData=null,this.emit(t.PointerEvent.BEFORE_UP,e),this.emit(t.PointerEvent.UP,e),this.touchLeave(e),e.isCancel||(this.tap(e),this.menuTap(e)),this.dragger.dragEnd(e),this.updateCursor(s)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}multiTouch(t,e){const{move:i,angle:s,scale:o,center:n}=wl.getData(e);this.rotate(Bl(n,s,t)),this.zoom(kl(n,o,t)),this.move(El(n,i,t))}menu(e){this.findPath(e),this.emit(t.PointerEvent.MENU,e)}menuTap(e){this.waitMenuTap&&this.emit(t.PointerEvent.MENU_TAP,e)}move(t){this.transformer.move(t)}zoom(t){this.transformer.zoom(t)}rotate(t){this.transformer.rotate(t)}transformEnd(){this.transformer.transformEnd()}keyDown(e){if(!this.config.keyEvent)return;const{code:i}=e;this.downKeyMap[i]||(this.downKeyMap[i]=!0,Kh.setDownCode(i),this.emit(t.KeyEvent.HOLD,e,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(t.KeyEvent.DOWN,e,this.defaultPath)}keyUp(e){if(!this.config.keyEvent)return;const{code:i}=e;this.downKeyMap[i]=!1,Kh.setUpCode(i),this.emit(t.KeyEvent.UP,e,this.defaultPath),"grab"===this.cursor&&this.updateCursor()}pointerHover(t){this.canHover&&(this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(e){const{path:i}=e,{overPath:s}=this;this.overPath=i,s?i.indexAt(0)!==s.indexAt(0)&&(this.emit(t.PointerEvent.OUT,e,s),this.emit(t.PointerEvent.OVER,e,i)):this.emit(t.PointerEvent.OVER,e,i)}pointerEnterOrLeave(e){let{path:i}=e;this.downData&&!this.moveMode&&(i=i.clone(),this.downData.path.forEach((t=>i.add(t))));const{enterPath:s}=this;this.enterPath=i,this.emit(t.PointerEvent.LEAVE,e,s,i),this.emit(t.PointerEvent.ENTER,e,i,s)}touchLeave(e){"touch"===e.pointerType&&this.enterPath&&(this.emit(t.PointerEvent.LEAVE,e),this.dragger.dragging&&this.emit(t.DropEvent.LEAVE,e))}tap(e){const{pointer:i}=this.config,s=this.longTap(e);if(!i.tapMore&&s)return;if(!this.waitTap)return;i.tapMore&&this.emitTap(e);const o=Date.now()-this.downTime,n=[t.PointerEvent.DOUBLE_TAP,t.PointerEvent.DOUBLE_CLICK].some((t=>bl(e.path,t)));o<i.tapTime+50&&n?(this.tapCount++,2===this.tapCount?(this.tapWaitCancel(),this.emitDoubleTap(e)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout((()=>{i.tapMore||(this.tapWaitCancel(),this.emitTap(e))}),i.tapTime))):i.tapMore||(this.tapWaitCancel(),this.emitTap(e))}findPath(t,e){const{hitRadius:i,through:s}=this.config.pointer,{bottomList:o}=this,n=this.selector.getByPoint(t,i,Object.assign({bottomList:o,name:t.type},e||{through:s}));return n.throughPath&&(t.throughPath=n.throughPath),t.path=n.path,n.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const e=this.target.app;return!(!e||!e.isApp)&&(e.editor&&!t.path.has(e.editor)&&t.path.has(e.tree)&&!t.target.syncEventer)}checkPath(t,e){(e||this.moveMode&&!Ll(t.path))&&(t.path=this.defaultPath)}canMove(t){return t&&(this.moveMode||"auto"===this.config.move.drag&&!Tl(t.path))&&!Ll(t.path)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}updateDownData(t,e,i){const{downData:s}=this;!t&&s&&(t=s),t&&(this.findPath(t,e),i&&s&&t.path.addList(s.path.list),this.downData=t)}updateHoverData(e){e||(e=this.hoverData),e&&(this.findPath(e,{exclude:this.dragger.getList(),name:t.PointerEvent.MOVE}),this.hoverData=e)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let e,i;const{path:s}=t;for(let t=0,o=s.length;t<o&&(e=s.list[t],i=e.syncEventer?e.syncEventer.cursor:e.cursor,!i);t++);this.setCursor(i)}setCursor(t){this.cursor=t}getLocal(t,e){const i=this.canvas.getClientBounds(e);return{x:t.clientX-i.x,y:t.clientY-i.y}}emitTap(e){this.emit(t.PointerEvent.TAP,e),this.emit(t.PointerEvent.CLICK,e)}emitDoubleTap(e){this.emit(t.PointerEvent.DOUBLE_TAP,e),this.emit(t.PointerEvent.DOUBLE_CLICK,e)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0}longPressWait(e){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.longPressed=!0,this.emit(t.PointerEvent.LONG_PRESS,e)}),this.config.pointer.longPressTime)}longTap(e){let i;return this.longPressed&&(this.emit(t.PointerEvent.LONG_TAP,e),(bl(e.path,t.PointerEvent.LONG_TAP)||bl(e.path,t.PointerEvent.LONG_PRESS))&&(i=!0)),this.longPressWaitCancel(),i}longPressWaitCancel(){clearTimeout(this.longPressTimer),this.longPressed=!1}__onResize(){this.shrinkCanvasBounds=new lt(this.canvas.bounds),this.shrinkCanvasBounds.spread(-2)}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Nn.RESIZE,this.__onResize,this)],t.once(jn.READY,(()=>this.__onResize()))}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,e,i,s){this.running&&function(t,e,i,s){if(!i&&!e.path)return;let o;e.type=t,i?e=Object.assign(Object.assign({},e),{path:i}):i=e.path,e.target=i.indexAt(0);try{for(let n=i.length-1;n>-1;n--){if(o=i.list[n],vl(o,t,e,!0,s))return;o.isApp&&yl(o,t,e,!0,s)}for(let n=0,r=i.length;n<r;n++)if(o=i.list[n],o.isApp&&yl(o,t,e,!1,s),vl(o,t,e,!1,s))return}catch(t){gl.error(t)}}(t,e,i,s)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class Rl{static set(t,e){this.custom[t]=e}static get(t){return this.custom[t]}}Rl.custom={};class Cl extends Ot{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new Xr,this.pixelList=new Xr}getPixelType(t,e){return this.__autoClear(),this.pixelList.add(t),i.hitCanvas(e)}getPathType(t){return this.__autoClear(),this.pathList.add(t),i.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach((t=>{t.__hitCanvas&&(t.__hitCanvas.destroy(),t.__hitCanvas=null)})),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}}const{toInnerRadiusPointOf:Sl,copy:Ol,setRadius:Dl}=D,Ml={},Il=t.Leaf.prototype;Il.__hitWorld=function(t){if(!this.__.hitSelf)return!1;this.__.hitRadius&&(Ol(Ml,t),Dl(t=Ml,this.__.hitRadius)),Sl(t,this.__world,Ml);const{width:e,height:i}=this.__world,s=e<10&&i<10;if(this.__.hitBox||s){if(nt.hitRadiusPoint(this.__layout.boxBounds,Ml))return!0;if(s)return!1}return!this.__layout.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),this.__layout.boundsChanged||(this.__layout.hitCanvasChanged=!1)),this.__hit(Ml)},Il.__hitFill=function(t){var e;return null===(e=this.__hitCanvas)||void 0===e?void 0:e.hitFill(t,this.__.windingRule)},Il.__hitStroke=function(t,e){var i;return null===(i=this.__hitCanvas)||void 0===i?void 0:i.hitStroke(t,e)},Il.__hitPixel=function(t){var e;return null===(e=this.__hitCanvas)||void 0===e?void 0:e.hitPixel(t,this.__layout.renderBounds,this.__hitCanvas.hitScale)},Il.__drawHitPath=function(t){t&&this.__drawRenderPath(t)};const Al=new U,Wl=t.UI.prototype;Wl.__updateHitCanvas=function(){const t=this.__,{hitCanvasManager:i}=this.leafer,s=(t.__pixelFill||t.__isCanvas)&&"pixel"===t.hitFill,o=t.__pixelStroke&&"pixel"===t.hitStroke,n=s||o;this.__hitCanvas||(this.__hitCanvas=n?i.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):i.getPathType(this));const r=this.__hitCanvas;if(n){const{renderBounds:i}=this.__layout,n=e.image.hitCanvasSize,a=r.hitScale=dt.set(0,0,n,n).getFitMatrix(i,.5).a,{x:h,y:l,width:d,height:c}=dt.set(i).scale(a);r.resize({width:d,height:c,pixelRatio:1}),r.clear(),co.patternLocked=!0,this.__renderShape(r,{matrix:Al.setWith(this.__world).scaleWith(1/a).invertWith().translate(-h,-l)},!s,!o),co.patternLocked=!1,r.resetTransform(),t.__isHitPixel=!0}else t.__isHitPixel&&(t.__isHitPixel=!1);this.__drawHitPath(r),r.setStrokeOptions(t)},Wl.__hit=function(t){"miniapp"===e.name&&this.__drawHitPath(this.__hitCanvas);const i=this.__;if(i.__isHitPixel&&this.__hitPixel(t))return!0;const{hitFill:s}=i,o=(i.fill||i.__isCanvas)&&("path"===s||"pixel"===s&&!(i.__pixelFill||i.__isCanvas))||"all"===s;if(o&&this.__hitFill(t))return!0;const{hitStroke:n,__strokeWidth:r}=i,a=i.stroke&&("path"===n||"pixel"===n&&!i.__pixelStroke)||"all"===n;if(!o&&!a)return!1;const h=2*t.radiusX;let l=h;if(a)switch(i.strokeAlign){case"inside":if(l+=2*r,!o&&this.__hitFill(t)&&this.__hitStroke(t,l))return!0;l=h;break;case"center":l+=r;break;case"outside":if(l+=2*r,!o){if(!this.__hitFill(t)&&this.__hitStroke(t,l))return!0;l=h}}return!!l&&this.__hitStroke(t,l)};const zl=new t.UI,Fl=t.Rect.prototype;Fl.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&"pixel"===this.hitFill||"all"===this.hitStroke?zl.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},Fl.__hitFill=function(t){return this.__hitCanvas?zl.__hitFill.call(this,t):nt.hitRadiusPoint(this.__layout.boxBounds,t)};const Ul=t.UI.prototype,Hl=t.Group.prototype;Ul.find=function(t,e){return this.leafer?this.leafer.selector.getBy(t,this,!1,e):[]},Ul.findOne=function(t,e){return this.leafer?this.leafer.selector.getBy(t,this,!0,e):null},Hl.pick=function(t,e){return this.__layout.update(),e||(e={}),this.leafer?this.leafer.selector.getByPoint(t,e.hitRadius||0,Object.assign(Object.assign({},e),{target:this})):null};const Nl=jt.prototype;Nl.hitFill=function(t,e){return e?this.context.isPointInPath(t.x,t.y,e):this.context.isPointInPath(t.x,t.y)},Nl.hitStroke=function(t,e){return this.strokeWidth=e,this.context.isPointInStroke(t.x,t.y)},Nl.hitPixel=function(t,e,i=1){let{x:s,y:o,radiusX:n,radiusY:r}=t;e&&(s-=e.x,o-=e.y),dt.set(s-n,o-r,2*n,2*r).scale(i).ceil();const{data:a}=this.context.getImageData(dt.x,dt.y,dt.width||1,dt.height||1);for(let t=0,e=a.length;t<e;t+=4)if(a[t+3]>0)return!0;return a[3]>0};const Yl={convert(t,e){const i=hl.getBase(t),s=Object.assign(Object.assign({},i),{x:e.x,y:e.y,width:t.width,height:t.height,pointerType:t.pointerType,pressure:t.pressure});return"pen"===s.pointerType&&(s.tangentialPressure=t.tangentialPressure,s.tiltX=t.tiltX,s.tiltY=t.tiltY,s.twist=t.twist),s},convertMouse(t,e){const i=hl.getBase(t);return Object.assign(Object.assign({},i),{x:e.x,y:e.y,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(t,e){const i=Yl.getTouch(t),s=hl.getBase(t);return Object.assign(Object.assign({},s),{x:e.x,y:e.y,width:1,height:1,pointerType:"touch",multiTouch:t.touches.length>1,pressure:i.force})},getTouch:t=>t.targetTouches[0]||t.changedTouches[0]},Vl={getMove(t,e){let{moveSpeed:i}=e,{deltaX:s,deltaY:o}=t;return t.shiftKey&&!s&&(s=o,o=0),s>50&&(s=Math.max(50,s/3)),o>50&&(o=Math.max(50,o/3)),{x:-s*i*2,y:-o*i*2}},getScale(t,i){let s,o=1,{zoomMode:n,zoomSpeed:r}=i;const a=t.deltaY||t.deltaX;if(n?(s="mouse"===n||!t.deltaX&&(e.intWheelDeltaY?Math.abs(a)>17:Math.ceil(a)!==a),(t.shiftKey||t.metaKey||t.ctrlKey)&&(s=!0)):s=!t.shiftKey&&(t.metaKey||t.ctrlKey),s){r=h.within(r,0,1);o=1-a/(4*(t.deltaY?i.delta.y:i.delta.x))*r,o<.5&&(o=.5),o>=1.5&&(o=1.5)}return o}},Xl={convert(t){const e=hl.getBase(t);return Object.assign(Object.assign({},e),{code:t.code,key:t.key})}},{getMoveEventData:Gl,getZoomEventData:jl,getRotateEventData:Zl,pathCanDrag:Kl}=hl;class ql extends Pl{__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:i}=this;for(let i in e)e[i]=e[i].bind(this),t.addEventListener(i,e[i]);for(let t in i)i[t]=i[t].bind(this),window.addEventListener(t,i[t])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let e in t)this.view.removeEventListener(e,t[e]),this.viewEvents={};for(let t in e)window.removeEventListener(t,e[t]),this.windowEvents={}}getTouches(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(t[i]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(Xl.convert(t))}onKeyUp(t){this.keyUp(Xl.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu(Yl.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),this.config.pointer.touch||this.useMultiTouch||(this.usePointer||(this.usePointer=!0),this.pointerDown(Yl.convert(t,this.getLocal(t))))}onPointerMove(t){this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t)||(this.usePointer||(this.usePointer=!0),this.pointerMove(Yl.convert(t,this.getLocal(t,!0))))}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t)||this.pointerUp(Yl.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.pointerDown(Yl.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerMove(Yl.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerUp(Yl.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.useTouch||this.usePointer||this.pointerCancel()}onTouchStart(t){const e=Yl.getTouch(t),i=this.getLocal(e,!0),{preventDefault:s}=this.config.touch;(!0===s||"auto"===s&&Kl(this.findPath(i)))&&t.preventDefault(),this.multiTouchStart(t),this.usePointer||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(Yl.convertTouch(t,i)))}onTouchMove(t){if(this.multiTouchMove(t),this.usePointer||this.preventWindowPointer(t))return;const e=Yl.getTouch(t);this.pointerMove(Yl.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.usePointer||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout((()=>{this.useTouch=!1}),500);const e=Yl.getTouch(t);this.pointerUp(Yl.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.usePointer||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),i=this.getKeepTouchList(this.touches,e);i.length>1&&(this.multiTouch(hl.getBase(t),i),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let i;const s=[];return t.forEach((t=>{i=e.find((e=>e.identifier===t.identifier)),i&&s.push({from:this.getLocal(t),to:this.getLocal(i)})})),s}getLocalTouchs(t){return t.map((t=>this.getLocal(t)))}onWheel(t){this.preventDefaultWheel(t);const{wheel:e}=this.config;if(e.disabled)return;const i=e.getScale?e.getScale(t,e):Vl.getScale(t,e),s=this.getLocal(t),o=hl.getBase(t);1!==i?this.zoom(jl(s,i,o)):this.move(Gl(s,e.getMove?e.getMove(t,e):Vl.getMove(t,e),o))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const e=this.getLocal(t),i=hl.getBase(t),s=t.scale/this.lastGestureScale,o=t.rotation-this.lastGestureRotation;let{rotateSpeed:n}=this.config.wheel;n=h.within(n,0,1),this.zoom(jl(e,s*s,i)),this.rotate(Zl(e,o/Math.PI*180*(n/4+.1),i)),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const e=[];this.eachCursor(t,e),"object"==typeof e[e.length-1]&&e.push("default"),this.canvas.view.style.cursor=e.map((t=>"object"==typeof t?`url(${t.url}) ${t.x||0} ${t.y||0}`:t)).join(",")}eachCursor(t,e,i=0){if(i++,t instanceof Array)t.forEach((t=>this.eachCursor(t,e,i)));else{const s="string"==typeof t&&Rl.get(t);s&&i<2?this.eachCursor(s,e,i):e.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function Jl(t,e){let i;const{rows:s,decorationY:o,decorationHeight:n}=t.__.__textDrawData;for(let t=0,r=s.length;t<r;t++)i=s[t],i.text?e.fillText(i.text,i.x,i.y):i.data&&i.data.forEach((t=>{e.fillText(t.char,t.x,i.y)})),o&&e.fillRect(i.x,i.y+o,i.width,n)}function $l(t,e,i){const{strokeAlign:s}=e.__,o="string"!=typeof t;switch(s){case"center":i.setStroke(o?void 0:t,e.__.strokeWidth,e.__),o?ed(t,!0,e,i):td(e,i);break;case"inside":Ql("inside",t,o,e,i);break;case"outside":Ql("outside",t,o,e,i)}}function Ql(t,e,i,s,o){const{__strokeWidth:n,__font:r}=s.__,a=o.getSameCanvas(!0,!0);a.setStroke(i?void 0:e,2*n,s.__),a.font=r,i?ed(e,!0,s,a):td(s,a),a.blendMode="outside"===t?"destination-out":"destination-in",Jl(s,a),a.blendMode="normal",s.__worldFlipped?o.copyWorldByReset(a,s.__nowWorld):o.copyWorldToInner(a,s.__nowWorld,s.__layout.renderBounds),a.recycle(s.__nowWorld)}function td(t,e){let i;const{rows:s,decorationY:o,decorationHeight:n}=t.__.__textDrawData;for(let t=0,r=s.length;t<r;t++)i=s[t],i.text?e.strokeText(i.text,i.x,i.y):i.data&&i.data.forEach((t=>{e.strokeText(t.char,t.x,i.y)})),o&&e.strokeRect(i.x,i.y+o,i.width,n)}function ed(t,e,i,s){let o;for(let n=0,r=t.length;n<r;n++)o=t[n],o.image&&La.checkImage(i,s,o,!1)||o.style&&(s.strokeStyle=o.style,o.blendMode?(s.saveBlendMode(o.blendMode),e?td(i,s):s.stroke(),s.restoreBlendMode()):e?td(i,s):s.stroke())}const{getSpread:id,getOuterOf:sd,getByMove:od,getIntersectData:nd}=nt;let rd;function ad(t,e,i){if("object"!=typeof e||!1===e.visible||0===e.opacity)return;const{boxBounds:s}=i.__layout;switch(e.type){case"solid":let{type:o,blendMode:n,color:r,opacity:a}=e;return{type:o,blendMode:n,style:ka.string(r,a)};case"image":return La.image(i,t,e,s,!rd||!rd[e.url]);case"linear":return Pa.linearGradient(e,s);case"radial":return Pa.radialGradient(e,s);case"angular":return Pa.conicGradient(e,s);default:return void 0!==e.r?{type:"solid",style:ka.string(e)}:void 0}}const hd={compute:function(t,e){const i=e.__,s=[];let o,n=i.__input[t];n instanceof Array||(n=[n]),rd=La.recycleImage(t,i);for(let i,o=0,r=n.length;o<r;o++)i=ad(t,n[o],e),i&&s.push(i);i["_"+t]=s.length?s:void 0,s.length&&s[0].image&&(o=s[0].image.hasOpacityPixel),"fill"===t?i.__pixelFill=o:i.__pixelStroke=o},fill:function(t,e,i){i.fillStyle=t,e.__.__font?Jl(e,i):e.__.windingRule?i.fill(e.__.windingRule):i.fill()},fills:function(t,e,i){let s;const{windingRule:o,__font:n}=e.__;for(let r=0,a=t.length;r<a;r++)s=t[r],s.image&&La.checkImage(e,i,s,!n)||s.style&&(i.fillStyle=s.style,s.transform?(i.save(),i.transform(s.transform),s.blendMode&&(i.blendMode=s.blendMode),n?Jl(e,i):o?i.fill(o):i.fill(),i.restore()):s.blendMode?(i.saveBlendMode(s.blendMode),n?Jl(e,i):o?i.fill(o):i.fill(),i.restoreBlendMode()):n?Jl(e,i):o?i.fill(o):i.fill())},fillText:Jl,stroke:function(t,e,i){const s=e.__,{__strokeWidth:o,strokeAlign:n,__font:r}=s;if(o)if(r)$l(t,e,i);else switch(n){case"center":i.setStroke(t,o,s),i.stroke();break;case"inside":i.save(),i.setStroke(t,2*o,s),s.windingRule?i.clip(s.windingRule):i.clip(),i.stroke(),i.restore();break;case"outside":const n=i.getSameCanvas(!0,!0);n.setStroke(t,2*o,s),e.__drawRenderPath(n),n.stroke(),s.windingRule?n.clip(s.windingRule):n.clip(),n.clearWorld(e.__layout.renderBounds),e.__worldFlipped?i.copyWorldByReset(n,e.__nowWorld):i.copyWorldToInner(n,e.__nowWorld,e.__layout.renderBounds),n.recycle(e.__nowWorld)}},strokes:function(t,e,i){const s=e.__,{__strokeWidth:o,strokeAlign:n,__font:r}=s;if(o)if(r)$l(t,e,i);else switch(n){case"center":i.setStroke(void 0,o,s),ed(t,!1,e,i);break;case"inside":i.save(),i.setStroke(void 0,2*o,s),s.windingRule?i.clip(s.windingRule):i.clip(),ed(t,!1,e,i),i.restore();break;case"outside":const{renderBounds:n}=e.__layout,r=i.getSameCanvas(!0,!0);e.__drawRenderPath(r),r.setStroke(void 0,2*o,s),ed(t,!1,e,r),s.windingRule?r.clip(s.windingRule):r.clip(),r.clearWorld(n),e.__worldFlipped?i.copyWorldByReset(r,e.__nowWorld):i.copyWorldToInner(r,e.__nowWorld,n),r.recycle(e.__nowWorld)}},strokeText:$l,drawTextStroke:td,shape:function(t,e,i){const s=e.getSameCanvas(),o=t.__nowWorld;let n,r,a,h,{scaleX:l,scaleY:d}=o;if(l<0&&(l=-l),d<0&&(d=-d),e.bounds.includes(o))h=s,n=a=o;else{const{renderShapeSpread:s}=t.__layout,c=nd(s?id(e.bounds,l===d?s*l:[s*d,s*l]):e.bounds,o);r=e.bounds.getFitMatrix(c);let{a:u,d:p}=r;if(r.a<1&&(h=e.getSameCanvas(),t.__renderShape(h,i),l*=u,d*=p),a=sd(o,r),n=od(a,-r.e,-r.f),i.matrix){const{matrix:t}=i;r.multiply(t),u*=t.scaleX,p*=t.scaleY}i=Object.assign(Object.assign({},i),{matrix:r.withScale(u,p)})}return t.__renderShape(s,i),{canvas:s,matrix:r,bounds:n,worldCanvas:h,shapeBounds:a,scaleX:l,scaleY:d}}};let ld={};const{get:dd,rotateOfOuter:cd,translate:ud,scaleOfOuter:pd,scale:_d,rotate:gd}=b;function fd(t,e,i,s,o,n,r){const a=dd();ud(a,e.x+i,e.y+s),_d(a,o,n),r&&cd(a,{x:e.x+e.width/2,y:e.y+e.height/2},r),t.transform=a}function yd(t,e,i,s,o,n,r){const a=dd();ud(a,e.x+i,e.y+s),o&&_d(a,o,n),r&&gd(a,r),t.transform=a}function vd(t,e,i,s,o,n,r,a,h,l){const d=dd();if(h)if("center"===l)cd(d,{x:i/2,y:s/2},h);else switch(gd(d,h),h){case 90:ud(d,s,0);break;case 180:ud(d,i,s);break;case 270:ud(d,0,i)}ld.x=e.x+o,ld.y=e.y+n,ud(d,ld.x,ld.y),r&&pd(d,ld,r,a),t.transform=d}const{get:md,translate:wd}=b,xd=new lt,bd={},Ed={};function kd(t,e,i,s){const{blendMode:o,sync:n}=i;o&&(t.blendMode=o),n&&(t.sync=n),t.data=Bd(i,s,e)}function Bd(t,e,i){let{width:s,height:o}=i;t.padding&&(e=xd.set(e).shrink(t.padding));const{opacity:n,mode:r,align:a,offset:l,scale:d,size:c,rotation:u,repeat:p}=t,_=e.width===s&&e.height===o,g={mode:r},f="center"!==a&&(u||0)%180==90,y=f?o:s,v=f?s:o;let m,w,x=0,b=0;if(r&&"cover"!==r&&"fit"!==r)(d||c)&&(h.getScaleData(d,c,i,Ed),m=Ed.scaleX,w=Ed.scaleY);else if(!_||u){const t=e.width/y,i=e.height/v;m=w="fit"===r?Math.min(t,i):Math.max(t,i),x+=(e.width-s*m)/2,b+=(e.height-o*w)/2}if(a){const t={x:x,y:b,width:y,height:v};m&&(t.width*=m,t.height*=w),vt.toPoint(a,t,e,bd,!0),x+=bd.x,b+=bd.y}switch(l&&(x+=l.x,b+=l.y),r){case"strench":_||(s=e.width,o=e.height);break;case"normal":case"clip":(x||b||m||u)&&yd(g,e,x,b,m,w,u);break;case"repeat":(!_||m||u)&&vd(g,e,s,o,x,b,m,w,u,a),p||(g.repeat="repeat");break;default:m&&fd(g,e,x,b,m,w,u)}return g.transform||(e.x||e.y)&&(g.transform=md(),wd(g.transform,e.x,e.y)),m&&"strench"!==r&&(g.scaleX=m,g.scaleY=w),g.width=s,g.height=o,n&&(g.opacity=n),p&&(g.repeat="string"==typeof p?"x"===p?"repeat-x":"repeat-y":"repeat"),g}let Td,Ld=new lt;const{isSame:Pd}=nt;function Rd(t,e,i,s,o,n){if("fill"===e&&!t.__.__naturalWidth){const e=t.__;if(e.__naturalWidth=s.width/e.pixelRatio,e.__naturalHeight=s.height/e.pixelRatio,e.__autoSide)return t.forceUpdate("width"),t.__proxyData&&(t.setProxyAttr("width",e.width),t.setProxyAttr("height",e.height)),!1}return o.data||kd(o,s,i,n),!0}function Cd(t,e){Dd(t,Hn.LOAD,e)}function Sd(t,e){Dd(t,Hn.LOADED,e)}function Od(t,e,i){e.error=i,t.forceUpdate("surface"),Dd(t,Hn.ERROR,e)}function Dd(t,e,i){t.hasEvent(e)&&t.emitEvent(new Hn(e,i))}function Md(t,e){const{leafer:i}=t;i&&i.viewReady&&(i.renderer.ignore=e)}const{get:Id,scale:Ad,copy:Wd}=b,{ceil:zd,abs:Fd}=Math;function Ud(t,i,s){let{scaleX:o,scaleY:n}=co.patternLocked?t.__world:t.__nowWorld;const r=o+"-"+n;if(i.patternId===r||t.destroyed)return!1;{o=Fd(o),n=Fd(n);const{image:t,data:a}=i;let h,l,{width:d,height:c,scaleX:u,scaleY:p,opacity:_,transform:g,repeat:f}=a;u&&(l=Id(),Wd(l,g),Ad(l,1/u,1/p),o*=u,n*=p),o*=s,n*=s,d*=o,c*=n;const y=d*c;if(!f&&y>e.image.maxCacheSize)return!1;let v=e.image.maxPatternSize;if(!t.isSVG){const e=t.width*t.height;v>e&&(v=e)}y>v&&(h=Math.sqrt(y/v)),h&&(o/=h,n/=h,d/=h,c/=h),u&&(o/=u,n/=p),(g||1!==o||1!==n)&&(l||(l=Id(),g&&Wd(l,g)),Ad(l,1/o,1/n));const m=t.getCanvas(zd(d)||1,zd(c)||1,_),w=t.getPattern(m,f||e.origin.noRepeat||"no-repeat",l,i);return i.style=w,i.patternId=r,!0}}const{abs:Hd}=Math;const Nd={image:function(t,e,i,s,o){let n,r;const a=co.get(i);return Td&&i===Td.paint&&Pd(s,Td.boxBounds)?n=Td.leafPaint:(n={type:i.type,image:a},Td=a.use>1?{leafPaint:n,paint:i,boxBounds:Ld.set(s)}:null),(o||a.loading)&&(r={image:a,attrName:e,attrValue:i}),a.ready?(Rd(t,e,i,a,n,s),o&&(Cd(t,r),Sd(t,r))):a.error?o&&Od(t,r,a.error):(Md(t,!0),o&&Cd(t,r),n.loadId=a.load((()=>{Md(t,!1),t.destroyed||(Rd(t,e,i,a,n,s)&&(a.hasOpacityPixel&&(t.__layout.hitCanvasChanged=!0),t.forceUpdate("surface")),Sd(t,r)),n.loadId=null}),(e=>{Md(t,!1),Od(t,r,e),n.loadId=null}))),n},checkImage:function(t,i,s,o){const{scaleX:n,scaleY:r}=co.patternLocked?t.__world:t.__nowWorld;if(!s.data||s.patternId===n+"-"+r&&!Ca.running)return!1;{const{data:a}=s;if(o)if(a.repeat)o=!1;else{let{width:t,height:s}=a;t*=Hd(n)*i.pixelRatio,s*=Hd(r)*i.pixelRatio,a.scaleX&&(t*=a.scaleX,s*=a.scaleY),o=t*s>e.image.maxCacheSize||Ca.running}return o?(i.save(),i.clip(),s.blendMode&&(i.blendMode=s.blendMode),a.opacity&&(i.opacity*=a.opacity),a.transform&&i.transform(a.transform),i.drawImage(s.image.view,0,0,a.width,a.height),i.restore(),!0):(!s.style||s.sync||Ca.running?Ud(t,s,i.pixelRatio):s.patternTask||(s.patternTask=co.patternTasker.add((()=>zt(this,void 0,void 0,(function*(){s.patternTask=null,i.bounds.hit(t.__nowWorld)&&Ud(t,s,i.pixelRatio),t.forceUpdate("surface")}))),300)),!1)}},createPattern:Ud,recycleImage:function(t,e){const i=e["_"+t];if(i instanceof Array){let s,o,n,r;for(let a=0,h=i.length;a<h;a++)s=i[a].image,r=s&&s.url,r&&(o||(o={}),o[r]=!0,co.recycle(s),s.loading&&(n||(n=e.__input&&e.__input[t]||[],n instanceof Array||(n=[n])),s.unload(i[a].loadId,!n.some((t=>t.url===r)))));return o}return null},createData:kd,getPatternData:Bd,fillOrFitMode:fd,clipMode:yd,repeatMode:vd},{toPoint:Yd}=gt,Vd={},Xd={};function Gd(t,e,i){let s;for(let o=0,n=e.length;o<n;o++)s=e[o],"string"==typeof s?t.addColorStop(o/(n-1),ka.string(s,i)):t.addColorStop(s.offset,ka.string(s.color,i))}const{getAngle:jd,getDistance:Zd}=D,{get:Kd,rotateOfOuter:qd,scaleOfOuter:Jd}=b,{toPoint:$d}=gt,Qd={},tc={};function ec(t,e,i,s,o){let n;const{width:r,height:a}=t;if(r!==a||s){const t=jd(e,i);n=Kd(),o?(Jd(n,e,r/a*(s||1),1),qd(n,e,t+90)):(Jd(n,e,1,r/a*(s||1)),qd(n,e,t))}return n}const{getDistance:ic}=D,{toPoint:sc}=gt,oc={},nc={};const rc={linearGradient:function(t,i){let{from:s,to:o,type:n,blendMode:r,opacity:a}=t;Yd(s||"top",i,Vd),Yd(o||"bottom",i,Xd);const h=e.canvas.createLinearGradient(Vd.x,Vd.y,Xd.x,Xd.y);Gd(h,t.stops,a);const l={type:n,style:h};return r&&(l.blendMode=r),l},radialGradient:function(t,i){let{from:s,to:o,type:n,opacity:r,blendMode:a,stretch:h}=t;$d(s||"center",i,Qd),$d(o||"bottom",i,tc);const l=e.canvas.createRadialGradient(Qd.x,Qd.y,0,Qd.x,Qd.y,Zd(Qd,tc));Gd(l,t.stops,r);const d={type:n,style:l},c=ec(i,Qd,tc,h,!0);return c&&(d.transform=c),a&&(d.blendMode=a),d},conicGradient:function(t,i){let{from:s,to:o,type:n,opacity:r,blendMode:a,stretch:h}=t;sc(s||"center",i,oc),sc(o||"bottom",i,nc);const l=e.conicGradientSupport?e.canvas.createConicGradient(0,oc.x,oc.y):e.canvas.createRadialGradient(oc.x,oc.y,0,oc.x,oc.y,ic(oc,nc));Gd(l,t.stops,r);const d={type:n,style:l},c=ec(i,oc,nc,h||1,e.conicGradientRotate90);return c&&(d.transform=c),a&&(d.blendMode=a),d},getTransform:ec},{copy:ac,toOffsetOutBounds:hc}=nt,lc={},dc={};function cc(t,i,s,o){const{bounds:n,shapeBounds:r}=o;if(e.fullImageShadow){if(ac(lc,t.bounds),lc.x+=i.x-r.x,lc.y+=i.y-r.y,s){const{matrix:t}=o;lc.x-=(n.x+(t?t.e:0)+n.width/2)*(s-1),lc.y-=(n.y+(t?t.f:0)+n.height/2)*(s-1),lc.width*=s,lc.height*=s}t.copyWorld(o.canvas,t.bounds,lc)}else s&&(ac(lc,i),lc.x-=i.width/2*(s-1),lc.y-=i.height/2*(s-1),lc.width*=s,lc.height*=s),t.copyWorld(o.canvas,r,s?lc:i)}const{toOffsetOutBounds:uc}=nt,pc={};const _c={shadow:function(t,e,i){let s,o;const{__nowWorld:n,__layout:r}=t,{shadow:a}=t.__,{worldCanvas:h,bounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,p=e.getSameCanvas(),_=a.length-1;hc(l,dc),a.forEach(((a,g)=>{p.setWorldShadow(dc.offsetX+a.x*c,dc.offsetY+a.y*u,a.blur*c,a.color),o=a.spread?1+2*a.spread/(r.boxBounds.width+2*(r.strokeBoxSpread||0)):0,cc(p,dc,o,i),s=l,a.box&&(p.restore(),p.save(),h&&(p.copyWorld(p,l,n,"copy"),s=n),h?p.copyWorld(h,n,n,"destination-out"):p.copyWorld(i.canvas,d,l,"destination-out")),t.__worldFlipped?e.copyWorldByReset(p,s,n,a.blendMode):e.copyWorldToInner(p,s,r.renderBounds,a.blendMode),_&&g<_&&p.clearWorld(s,!0)})),p.recycle(s)},innerShadow:function(t,e,i){let s,o;const{__nowWorld:n,__layout:r}=t,{innerShadow:a}=t.__,{worldCanvas:h,bounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,p=e.getSameCanvas(),_=a.length-1;uc(l,pc),a.forEach(((a,g)=>{p.save(),p.setWorldShadow(pc.offsetX+a.x*c,pc.offsetY+a.y*u,a.blur*c),o=a.spread?1-2*a.spread/(r.boxBounds.width+2*(r.strokeBoxSpread||0)):0,cc(p,pc,o,i),p.restore(),h?(p.copyWorld(p,l,n,"copy"),p.copyWorld(h,n,n,"source-out"),s=n):(p.copyWorld(i.canvas,d,l,"source-out"),s=l),p.fillWorld(s,a.color,"source-in"),t.__worldFlipped?e.copyWorldByReset(p,s,n,a.blendMode):e.copyWorldToInner(p,s,r.renderBounds,a.blendMode),_&&g<_&&p.clearWorld(s,!0)})),p.recycle(s)},blur:function(t,e,i){const{blur:s}=t.__;i.setWorldBlur(s*t.__nowWorld.a),i.copyWorldToInner(e,t.__nowWorld,t.__layout.renderBounds),i.filter="none"},backgroundBlur:function(t,e,i){}},{excludeRenderBounds:gc}=mn;function fc(t,e,i,s,o,n){switch(e){case"alpha":!function(t,e,i,s){const o=t.__nowWorld;i.resetTransform(),i.opacity=1,i.useMask(s,o),s.recycle(o),vc(t,e,i,1)}(t,i,s,o);break;case"opacity-path":vc(t,i,s,n);break;case"path":i.restore()}}function yc(t){return t.getSameCanvas(!1,!0)}function vc(t,e,i,s){const o=t.__nowWorld;e.resetTransform(),e.opacity=s,e.copyWorld(i,o),i.recycle(o)}t.Group.prototype.__renderMask=function(t,e){let i,s,o,n,r;const{children:a}=this;for(let h=0,l=a.length;h<l;h++)i=a[h],i.__.mask&&(r&&(fc(this,r,t,o,s,n),s=o=null),"path"===i.__.mask?(i.opacity<1?(r="opacity-path",n=i.opacity,o||(o=yc(t))):(r="path",t.save()),i.__clip(o||t,e)):(r="alpha",s||(s=yc(t)),o||(o=yc(t)),i.__render(s,e)),"clipping"!==i.__.mask)||gc(i,e)||i.__render(o||t,e);fc(this,r,t,o,s,n)};const mc=">)]}%!?,.:;'\"",wc=mc+"_#~&*+\\=|",xc=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map((([t,e])=>`[\\u${t.toString(16)}-\\u${e.toString(16)}]`)).join("|"));function bc(t){const e={};return t.split("").forEach((t=>e[t]=!0)),e}const Ec=bc("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),kc=bc("{[(<'\""),Bc=bc(mc),Tc=bc(wc),Lc=bc("- ");var Pc;!function(t){t[t.Letter=0]="Letter",t[t.Single=1]="Single",t[t.Before=2]="Before",t[t.After=3]="After",t[t.Symbol=4]="Symbol",t[t.Break=5]="Break"}(Pc||(Pc={}));const{Letter:Rc,Single:Cc,Before:Sc,After:Oc,Symbol:Dc,Break:Mc}=Pc;function Ic(t){return Ec[t]?Rc:Lc[t]?Mc:kc[t]?Sc:Bc[t]?Oc:Tc[t]?Dc:xc.test(t)?Cc:Rc}const Ac={trimRight(t){const{words:e}=t;let i,s=0,o=e.length;for(let n=o-1;n>-1&&(i=e[n].data[0]," "===i.char);n--)s++,t.width-=i.width;s&&e.splice(o-s,s)}};function Wc(t,e,i){switch(e){case"title":return i?t.toUpperCase():t;case"upper":return t.toUpperCase();case"lower":return t.toLowerCase();default:return t}}const{trimRight:zc}=Ac,{Letter:Fc,Single:Uc,Before:Hc,After:Nc,Symbol:Yc,Break:Vc}=Pc;let Xc,Gc,jc,Zc,Kc,qc,Jc,$c,Qc,tu,eu,iu,su,ou,nu,ru,au=[];function hu(t,e){Qc&&!$c&&($c=Qc),Xc.data.push({char:t,width:e}),jc+=e}function lu(){Zc+=jc,Xc.width=jc,Gc.words.push(Xc),Xc={data:[]},jc=0}function du(){ou&&(nu.paraNumber++,Gc.paraStart=!0,ou=!1),Qc&&(Gc.startCharSize=$c,Gc.endCharSize=Qc,$c=0),Gc.width=Zc,ru.width&&zc(Gc),au.push(Gc),Gc={words:[]},Zc=0}const cu=0,uu=1,pu=2;const{top:_u,right:gu,bottom:fu,left:yu}=t.Direction4;function vu(t,e,i){const{bounds:s,rows:o}=t;s[e]+=i;for(let t=0;t<o.length;t++)o[t][e]+=i}const mu={getDrawData:function(t,i){"string"!=typeof t&&(t=String(t));let s=0,o=0,n=i.__getInput("width")||0,r=i.__getInput("height")||0;const{textDecoration:a,__font:h,__padding:l}=i;l&&(n&&(s=l[yu],n-=l[gu]+l[yu]),r&&(o=l[_u],r-=l[_u]+l[fu]));const d={bounds:{x:s,y:o,width:n,height:r},rows:[],paraNumber:0,font:e.canvas.font=h};return function(t,i,s){nu=t,au=t.rows,ru=t.bounds;const{__letterSpacing:o,paraIndent:n,textCase:r}=s,{canvas:a}=e,{width:h,height:l}=ru;if(h||l||o||"none"!==r){const t="none"!==s.textWrap,e="break"===s.textWrap;ou=!0,eu=null,$c=Jc=Qc=jc=Zc=0,Xc={data:[]},Gc={words:[]};for(let s=0,l=i.length;s<l;s++)qc=i[s],"\n"===qc?(jc&&lu(),Gc.paraEnd=!0,du(),ou=!0):(tu=Ic(qc),tu===Fc&&"none"!==r&&(qc=Wc(qc,r,!jc)),Jc=a.measureText(qc).width,o&&(o<0&&(Qc=Jc),Jc+=o),iu=tu===Uc&&(eu===Uc||eu===Fc)||eu===Uc&&tu!==Nc,su=!(tu!==Hc&&tu!==Uc||eu!==Yc&&eu!==Nc),Kc=ou&&n?h-n:h,t&&h&&Zc+jc+Jc>Kc&&(e?(jc&&lu(),Zc&&du()):(su||(su=tu===Fc&&eu==Nc),iu||su||tu===Vc||tu===Hc||tu===Uc||jc+Jc>Kc?(jc&&lu(),Zc&&du()):Zc&&du()))," "===qc&&!0!==ou&&Zc+jc===0||(tu===Vc?(" "===qc&&jc&&lu(),hu(qc,Jc),lu()):iu||su?(jc&&lu(),hu(qc,Jc)):hu(qc,Jc)),eu=tu);jc&&lu(),Zc&&du(),au.length>0&&(au[au.length-1].paraEnd=!0)}else i.split("\n").forEach((t=>{nu.paraNumber++,au.push({x:n||0,text:t,width:a.measureText(t).width,paraStart:!0})}))}(d,t,i),l&&function(t,e,i,s,o){if(!s)switch(i.textAlign){case"left":vu(e,"x",t[yu]);break;case"right":vu(e,"x",-t[gu])}if(!o)switch(i.verticalAlign){case"top":vu(e,"y",t[_u]);break;case"bottom":vu(e,"y",-t[fu])}}(l,d,i,n,r),function(t,e){const{rows:i,bounds:s}=t,{__lineHeight:o,__baseLine:n,__letterSpacing:r,__clipText:a,textAlign:h,verticalAlign:l,paraSpacing:d}=e;let c,u,p,{x:_,y:g,width:f,height:y}=s,v=o*i.length+(d?d*(t.paraNumber-1):0),m=n;if(a&&v>y)v=Math.max(y,o),t.overflow=i.length;else switch(l){case"middle":g+=(y-v)/2;break;case"bottom":g+=y-v}m+=g;for(let n=0,l=i.length;n<l;n++){if(c=i[n],c.x=_,c.width<f||c.width>f&&!a)switch(h){case"center":c.x+=(f-c.width)/2;break;case"right":c.x+=f-c.width}c.paraStart&&d&&n>0&&(m+=d),c.y=m,m+=o,t.overflow>n&&m>v&&(c.isOverflow=!0,t.overflow=n+1),u=c.x,p=c.width,r<0&&(c.width<0?(p=-c.width+e.fontSize+r,u-=p,p+=e.fontSize):p-=r),u<s.x&&(s.x=u),p>s.width&&(s.width=p),a&&f&&f<p&&(c.isOverflow=!0,t.overflow||(t.overflow=i.length))}s.y=g,s.height=v}(d,i),function(t,e,i,s){const{rows:o}=t,{textAlign:n,paraIndent:r,letterSpacing:a}=e;let h,l,d,c,u;o.forEach((t=>{t.words&&(d=r&&t.paraStart?r:0,l=i&&"justify"===n&&t.words.length>1?(i-t.width-d)/(t.words.length-1):0,c=a||t.isOverflow?cu:l>.01?uu:pu,t.isOverflow&&!a&&(t.textMode=!0),c===pu?(t.x+=d,function(t){t.text="",t.words.forEach((e=>{e.data.forEach((e=>{t.text+=e.char}))}))}(t)):(t.x+=d,h=t.x,t.data=[],t.words.forEach((e=>{c===uu?(u={char:"",x:h},h=function(t,e,i){return t.forEach((t=>{i.char+=t.char,e+=t.width})),e}(e.data,h,u),(t.isOverflow||" "!==u.char)&&t.data.push(u)):h=function(t,e,i,s){return t.forEach((t=>{(s||" "!==t.char)&&(t.x=e,i.push(t)),e+=t.width})),e}(e.data,h,t.data,t.isOverflow),!t.paraEnd&&l&&(h+=l,t.width+=l)}))),t.words=null)}))}(d,i,n),d.overflow&&function(t,i,s,o){if(!o)return;const{rows:n,overflow:r}=t;let{textOverflow:a}=i;if(n.splice(r),a&&"show"!==a){let t,h;"hide"===a?a="":"ellipsis"===a&&(a="...");const l=a?e.canvas.measureText(a).width:0,d=s+o-l;("none"===i.textWrap?n:[n[r-1]]).forEach((e=>{if(e.isOverflow&&e.data){let i=e.data.length-1;for(let s=i;s>-1&&(t=e.data[s],h=t.x+t.width,!(s===i&&h<d));s--){if(h<d&&" "!==t.char){e.data.splice(s+1),e.width-=t.width;break}e.width-=t.width}e.width+=l,e.data.push({char:a,x:h}),e.textMode&&function(t){t.text="",t.data.forEach((e=>{t.text+=e.char})),t.data=null}(e)}}))}}(d,i,s,n),"none"!==a&&function(t,e){const{fontSize:i}=e;switch(t.decorationHeight=i/11,e.textDecoration){case"under":t.decorationY=.15*i;break;case"delete":t.decorationY=.35*-i}}(d,i),d}};const wu={string:function(t,e){if("string"==typeof t)return t;let i=void 0===t.a?1:t.a;e&&(i*=e);const s=t.r+","+t.g+","+t.b;return 1===i?"rgb("+s+")":"rgba("+s+","+i+")"}},{setPoint:xu,addPoint:bu,toBounds:Eu}=N;const ku={export(t,s,o){this.running=!0;const n=no.fileType(s),r=s.includes(".");return o=no.getExportOptions(o),function(t){Bu||(Bu=new lo);return new Promise((e=>{Bu.add((()=>zt(this,void 0,void 0,(function*(){return yield t(e)}))),{parallel:!1})}))}((a=>new Promise((l=>{const d=t=>{a(t),l(),this.running=!1},{toURL:c}=e,{download:u}=e.origin;if("json"===n)return r&&u(c(JSON.stringify(t.toJSON(o.json)),"text"),s),d({data:!!r||t.toJSON(o.json)});if("svg"===n)return r&&u(c(t.toSVG(),"svg"),s),d({data:!!r||t.toSVG()});const{leafer:p}=t;p?(Tu(t),p.waitViewCompleted((()=>zt(this,void 0,void 0,(function*(){let e,n,r=1,a=1;const{worldTransform:l,isLeafer:c,isFrame:u}=t,{slice:_,trim:g,onCanvas:f}=o,y=void 0===o.smooth?p.config.smooth:o.smooth,v=o.contextSettings||p.config.contextSettings,m=o.screenshot||t.isApp,w=c&&m&&void 0===o.fill?t.fill:o.fill,x=no.isOpaqueImage(s)||w,b=new U;if(m)e=!0===m?c?p.canvas.bounds:t.worldRenderBounds:m;else{let i=o.relative||(c?"inner":"local");switch(r=l.scaleX,a=l.scaleY,i){case"inner":b.set(l);break;case"local":b.set(l).divide(t.localTransform),r/=t.scaleX,a/=t.scaleY;break;case"world":r=1,a=1;break;case"page":i=t.leafer;default:b.set(l).divide(t.getTransform(i));const e=i.worldTransform;r/=r/e.scaleX,a/=a/e.scaleY}e=t.getBounds("render",i)}const E={scaleX:1,scaleY:1};h.getScaleData(o.scale,o.size,e,E);let k=o.pixelRatio||1;t.isApp&&(E.scaleX*=k,E.scaleY*=k,k=t.app.pixelRatio);const{x:B,y:T,width:L,height:P}=new lt(e).scale(E.scaleX,E.scaleY),R={matrix:b.scale(1/E.scaleX,1/E.scaleY).invert().translate(-B,-T).withScale(1/r*E.scaleX,1/a*E.scaleY)};let C,S=i.canvas({width:Math.round(L),height:Math.round(P),pixelRatio:k,smooth:y,contextSettings:v});if(_&&(C=t,C.__worldOpacity=0,t=p,R.bounds=S.bounds),S.save(),u&&void 0!==w){const e=t.get("fill");t.fill="",t.__render(S,R),t.fill=e}else t.__render(S,R);if(S.restore(),C&&C.__updateWorldOpacity(),g){n=function(t){const{width:e,height:i}=t.view,{data:s}=t.context.getImageData(0,0,e,i);let o,n,r,a=0;for(let t=0;t<s.length;t+=4)0!==s[t+3]&&(o=a%e,n=(a-o)/e,r?bu(r,o,n):xu(r={},o,n)),a++;const h=new lt;return Eu(r,h),h.scale(1/t.pixelRatio).ceil()}(S);const t=S,{width:e,height:s}=n,o={x:0,y:0,width:e,height:s,pixelRatio:k};S=i.canvas(o),S.copyWorld(t,n,o)}x&&S.fillWorld(S.bounds,w||"#FFFFFF","destination-over"),f&&f(S);const O="canvas"===s?S:yield S.export(s,o);d({data:O,width:S.pixelWidth,height:S.pixelHeight,renderBounds:e,trimBounds:n})}))))):d({data:!1})}))))}};let Bu;function Tu(t){t.__.__needComputePaint&&t.__.__computePaint(),t.isBranch&&t.children.forEach((t=>Tu(t)))}const Lu=jt.prototype,Pu=wt.get("@leafer-ui/export");Lu.export=function(t,e){const{quality:i,blob:s}=no.getExportOptions(e);return t.includes(".")?this.saveAs(t,i):s?this.toBlob(t,i):this.toDataURL(t,i)},Lu.toBlob=function(t,i){return new Promise((s=>{e.origin.canvasToBolb(this.view,t,i).then((t=>{s(t)})).catch((t=>{Pu.error(t),s(null)}))}))},Lu.toDataURL=function(t,i){return e.origin.canvasToDataURL(this.view,t,i)},Lu.saveAs=function(t,i){return new Promise((s=>{e.origin.canvasSaveAs(this.view,t,i).then((()=>{s(!0)})).catch((t=>{Pu.error(t),s(!1)}))}))},Object.assign(Ea,mu),Object.assign(ka,wu),Object.assign(Ta,hd),Object.assign(La,Nd),Object.assign(Pa,rc),Object.assign(Ra,_c),Object.assign(Ca,ku),Object.assign(i,{interaction:(t,e,i,s)=>new ql(t,e,i,s),hitCanvas:(t,e)=>new Zr(t,e),hitCanvasManager:()=>new Cl}),Jr();const{M:Ru,L:Cu,C:Su,Q:Ou,Z:Du,N:Mu,D:Iu,X:Au,G:Wu,F:zu,O:Fu,P:Uu,U:Hu}=qt,Nu={scale(t,e,i){if(!t)return;let s,o=0,n=t.length;for(;o<n;)switch(s=t[o],s){case Ru:case Cu:Yu(t,e,i,o,1),o+=3;break;case Su:Yu(t,e,i,o,3),o+=7;break;case Ou:Yu(t,e,i,o,2),o+=5;break;case Du:o+=1;break;case Mu:Yu(t,e,i,o,2),o+=5;break;case Iu:Yu(t,e,i,o,2),o+=9;break;case Au:Yu(t,e,i,o,2),o+=6;break;case Wu:Yu(t,e,i,o,2),o+=9;break;case zu:Yu(t,e,i,o,2),o+=5;break;case Fu:t[o]=Wu,t.splice(o+4,0,t[o+3],0),Yu(t,e,i,o,2),o+=9,n+=2;break;case Uu:t[o]=zu,t.splice(o+4,0,t[o+3]),Yu(t,e,i,o,2),o+=5,n+=1;break;case Hu:Yu(t,e,i,o,2),o+=6}},scalePoints(t,e,i,s,o){for(let n=o?s+1:0,r=o?n+2*o:t.length;n<r;n+=2)t[n]*=e,t[n+1]*=i}},{scalePoints:Yu}=Nu,Vu=b.get(),{topLeft:Xu,top:Gu,topRight:ju,right:Zu,bottom:Ku,left:qu}=t.Direction9;function Ju(t,e,i){t.pathInputed?Qu(t,e,i):(1!==e&&(t.width*=e),1!==i&&(t.height*=i))}function $u(t,e,i){const{app:s}=t,o=s&&s.editor;if(o.editing){const s=t.__layout;let{width:n,height:r}=s.boxBounds;switch(n*=(i-e)*(t.scaleX<0?-1:1),r*=(e-i)*(t.scaleY<0?-1:1),o.resizeDirection){case Gu:case Ku:t.fontSize*=i,s.affectScaleOrRotation?t.moveInner(-n/2,0):t.x-=n/2;break;case qu:case Zu:t.fontSize*=e,s.affectScaleOrRotation?t.moveInner(0,-r/2):t.y-=r/2;break;case Xu:case ju:t.fontSize*=e,s.affectScaleOrRotation?t.moveInner(0,-r):t.y-=r;break;default:t.fontSize*=e}}else t.fontSize*=e}function Qu(t,e,i){Nu.scale(t.__.path,e,i),t.path=t.__.path}function tp(t,e,i){Nu.scalePoints(t.__.points,e,i),t.points=t.__.points}function ep(t,e,i){const{children:s}=t;for(let t=0;t<s.length;t++)Vu.a=e,Vu.d=i,s[t].transform(Vu,!0)}const ip=t.Leaf.prototype;function sp(t){return t?t instanceof Array?t:[t]:[]}ip.scaleResize=function(t,e=t,i){const s=this;i||s.editConfig&&"scale"===s.editConfig.editSize?(s.scaleX*=t,s.scaleY*=e):(t<0&&(s.scaleX*=-1,t=-t),e<0&&(s.scaleY*=-1,e=-e),this.__scaleResize(t,e))},ip.__scaleResize=function(t,e){Ju(this,t,e)},ip.resizeWidth=function(t){const e=t/this.getBounds("box","local").width;this.scaleOf(this.__layout.boxBounds,e,this.__.lockRatio?e:1,!0)},ip.resizeHeight=function(t){const e=t/this.getBounds("box","local").height;this.scaleOf(this.__layout.boxBounds,this.__.lockRatio?e:1,e,!0)},t.Text.prototype.__scaleResize=function(t,e){this.__.__autoSize&&(this.__.resizeFontSize||this.editConfig&&"font-size"===this.editConfig.editSize)?$u(this,t,e):Ju(this,t,e)},t.Path.prototype.__scaleResize=function(t,e){Qu(this,t,e)},t.Line.prototype.__scaleResize=function(t,e){this.pathInputed?Qu(this,t,e):this.points?tp(this,t,e):this.width*=t},t.Polygon.prototype.__scaleResize=function(t,e){this.pathInputed?Qu(this,t,e):this.points?tp(this,t,e):Ju(this,t,e)},t.Group.prototype.__scaleResize=function(t,e){ep(this,t,e)},t.Box.prototype.__scaleResize=function(t,e){this.__.__autoSize&&this.children.length?ep(this,t,e):(Ju(this,t,e),this.__.resizeChildren&&ep(this,t,e))};class op extends zn{get list(){return sp(this.value)}get oldList(){return sp(this.oldValue)}constructor(t,e){super(t),e&&Object.assign(this,e)}}op.SELECT="editor.select",op.HOVER="editor.hover";class np extends op{constructor(t,e){super(t,e)}}np.MOVE="editor.move";class rp extends op{constructor(t,e){super(t,e)}}rp.SCALE="editor.scale";class ap extends op{constructor(t,e){super(t,e)}}ap.ROTATE="editor.rotate";class hp extends op{constructor(t,e){super(t,e)}}function lp(t){return(e,i)=>{const s="_"+i;fo(e,i,{get(){return this[s]},set(e){const i=this[s];i!==e&&(this[s]=e,t(this,i))}})}}hp.SKEW="editor.skew";const dp=b.get(),{abs:cp}=Math,{copy:up,scale:pp}=b;class _p extends t.UI{constructor(){super(),this.list=[],this.hittable=!1,this.strokeAlign="center"}setTarget(t,e){this.set(e),this.target=t}__draw(t,e){const{list:i}=this;if(i.length){let s;const{stroke:o,strokeWidth:n,fill:r}=this.__,{bounds:a}=e;for(let h=0;h<i.length;h++)if(s=i[h],a&&a.hit(s.__world,e.matrix)){const i=cp(s.__world.scaleX),a=cp(s.__world.scaleY);if(i!==a){up(dp,s.__world),pp(dp,1/i,1/a),t.setWorld(dp,e.matrix),t.beginPath(),this.__.strokeWidth=n;const{x:o,y:r,width:h,height:l}=s.__layout.boxBounds;t.rect(o*i,r*a,h*i,l*a)}else t.setWorld(s.__world,e.matrix),t.beginPath(),s.__.__useArrow?s.__drawPath(t):s.__.__pathForRender?s.__drawRenderPath(t):s.__drawPathByBox(t),this.__.strokeWidth=n/cp(s.__world.scaleX);o&&("string"==typeof o?Ta.stroke(o,this,t):Ta.strokes(o,this,t)),r&&("string"==typeof r?Ta.fill(r,this,t):Ta.fills(r,this,t))}this.__.strokeWidth=n}}destroy(){this.target=null,super.destroy()}}Wt([lp((function(t){const e=t.target;t.list=e?e instanceof Array?e:[e]:[],t.forceUpdate()}))],_p.prototype,"target",void 0);class gp extends t.Group{constructor(e){super(e),this.strokeArea=new t.Rect({strokeAlign:"center"}),this.fillArea=new t.Rect,this.visible=this.hittable=!1,this.addMany(this.fillArea,this.strokeArea)}setStyle(t,e){const{visible:i,stroke:s,strokeWidth:o}=t;this.visible=i,this.strokeArea.reset(Object.assign({stroke:s,strokeWidth:o},e||{})),this.fillArea.reset({visible:!e,fill:s,opacity:.2})}setBounds(t){this.strokeArea.set(t),this.fillArea.set(t)}}const{No:fp,Yes:yp,NoAndSkip:vp,YesAndSkip:mp}=t.Answer,wp={findOne:t=>t.list.find((t=>t.editable)),findBounds(t,e){if(t.__.hittable&&t.__.visible&&!t.__.locked&&e.hit(t.__world)){if(t.__.editable){if(t.isBranch&&!t.__.hitChildren)return t.__.hitSelf?mp:vp;if(t.isFrame)return e.includes(t.__layout.boxBounds,t.__world)?mp:fp;if(e.hit(t.__layout.boxBounds,t.__world)&&t.__.hitSelf)return yp}return fp}return t.isBranch?vp:fp}},{findOne:xp}=wp;class bp extends t.Group{get dragging(){return!!this.originList}get running(){const{editor:t}=this;return this.hittable&&t.visible&&t.hittable&&t.mergeConfig.selector}get isMoveMode(){return this.app&&this.app.interaction.moveMode}constructor(t){super(),this.hoverStroker=new _p,this.targetStroker=new _p,this.bounds=new lt,this.selectArea=new gp,this.__eventIds=[],this.editor=t,this.addMany(this.targetStroker,this.hoverStroker,this.selectArea),this.__listenEvents()}onHover(){const{editor:t}=this;if(!this.running||this.dragging||t.dragging)this.hoverStroker.target=null;else{const{stroke:e,strokeWidth:i,hover:s,hoverStyle:o}=t.mergeConfig;this.hoverStroker.setTarget(s?this.editor.hoverTarget:null,Object.assign({stroke:e,strokeWidth:i},o||{}))}}onSelect(){if(this.running){const{mergeConfig:t,list:e}=this.editor,{stroke:i,strokeWidth:s}=t;this.targetStroker.setTarget(e,{stroke:i,strokeWidth:Math.max(1,s/2)}),this.hoverStroker.target=null}}update(){this.targetStroker.target&&this.targetStroker.forceUpdate()}onPointerMove(t){const{app:e,editor:i}=this;if(this.running&&!this.isMoveMode&&e.interaction.canHover&&!e.interaction.dragging){const e=this.findUI(t);i.hoverTarget=i.hasItem(e)?null:e}this.isMoveMode&&(i.hoverTarget=null)}onBeforeDown(t){if(t.multiTouch)return;const{select:e}=this.editor.mergeConfig;"press"===e&&(this.app.config.mobile?this.waitSelect=()=>this.checkAndSelect(t):this.checkAndSelect(t))}onTap(t){if(t.multiTouch)return;const{editor:e}=this,{select:i}=e.mergeConfig;"tap"===i?this.checkAndSelect(t):this.waitSelect&&this.waitSelect(),this.needRemoveItem?e.removeItem(this.needRemoveItem):this.isMoveMode&&(e.target=null)}checkAndSelect(t){if(this.needRemoveItem=null,this.allowSelect(t)){const{editor:e}=this,i=this.findUI(t);i?this.isMultipleSelect(t)?e.hasItem(i)?this.needRemoveItem=i:e.addItem(i):e.target=i:this.allow(t.target)&&(t.shiftKey||(e.target=null))}}onDragStart(t){if(!t.multiTouch&&(this.waitSelect&&this.waitSelect(),this.allowDrag(t))){const{editor:e}=this,{stroke:i,area:s}=e.mergeConfig,{x:o,y:n}=t.getInner(this);this.bounds.set(o,n),this.selectArea.setStyle({visible:!0,stroke:i,x:o,y:n},s),this.selectArea.setBounds(this.bounds.get()),this.originList=e.leafList.clone()}}onDrag(t){if(!t.multiTouch){if(this.editor.dragging)return this.onDragEnd(t);if(this.dragging){const{editor:e}=this,i=t.getInnerTotal(this),s=this.bounds.clone().unsign(),o=new Xr(e.app.find(wp.findBounds,s));if(this.bounds.width=i.x,this.bounds.height=i.y,this.selectArea.setBounds(s.get()),o.length){const t=[];this.originList.forEach((e=>{o.has(e)||t.push(e)})),o.forEach((e=>{this.originList.has(e)||t.push(e)})),(t.length!==e.list.length||e.list.some(((e,i)=>e!==t[i])))&&(e.target=t)}else e.target=this.originList.list}}}onDragEnd(t){t.multiTouch||this.dragging&&(this.originList=null,this.selectArea.visible=!1)}onAutoMove(t){if(this.dragging){const{x:e,y:i}=t.getLocalMove(this);this.bounds.x+=e,this.bounds.y+=i}}allow(t){return t.leafer!==this.editor.leafer}allowDrag(t){return!(!this.running||!this.editor.mergeConfig.boxSelect||t.target.draggable)&&(!this.editor.editing&&this.allow(t.target)||t.shiftKey&&!xp(t.path))}allowSelect(t){return this.running&&!this.isMoveMode&&!t.middle}findDeepOne(t){const e={exclude:new Xr(this.editor.editBox.rect)};return xp(t.target.leafer.interaction.findPath(t,e))}findUI(t){return this.isMultipleSelect(t)?this.findDeepOne(t):xp(t.path)}isMultipleSelect(t){return t.shiftKey||this.editor.mergeConfig.continuousSelect}__listenEvents(){const{editor:e}=this;e.waitLeafer((()=>{const{app:i}=e;i.selector.proxy=e,this.__eventIds=[e.on_(op.HOVER,this.onHover,this),e.on_(op.SELECT,this.onSelect,this),i.on_(t.PointerEvent.MOVE,this.onPointerMove,this),i.on_(t.PointerEvent.BEFORE_DOWN,this.onBeforeDown,this),i.on_(t.PointerEvent.TAP,this.onTap,this),i.on_(t.DragEvent.START,this.onDragStart,this,!0),i.on_(t.DragEvent.DRAG,this.onDrag,this),i.on_(t.DragEvent.END,this.onDragEnd,this),i.on_(t.MoveEvent.MOVE,this.onAutoMove,this),i.on_([t.ZoomEvent.ZOOM,t.MoveEvent.MOVE],(()=>{this.editor.hoverTarget=null}))]}))}__removeListenEvents(){this.__eventIds&&(this.off_(this.__eventIds),this.__eventIds.length=0)}destroy(){this.editor=this.originList=this.needRemoveItem=null,this.__removeListenEvents(),super.destroy()}}const{topLeft:Ep,top:kp,topRight:Bp,right:Tp,bottomRight:Lp,bottom:Pp,bottomLeft:Rp,left:Cp}=t.Direction9,{toPoint:Sp}=gt,{within:Op}=h,Dp={getScaleData(t,e,i,s,o,n,r,a){let h,l={},d=1,c=1;const{boxBounds:u,widthRange:p,heightRange:_}=t,{width:g,height:f}=e;n&&(s.x*=2,s.y*=2);const y=t.scaleX/e.scaleX,v=t.scaleY/e.scaleY,m=y<0?-1:1,w=v<0?-1:1,x=a?y:m*u.width/g,b=a?v:w*u.height/f;s.x*=a?y:m,s.y*=a?v:w,Math.abs(s.x)===g&&(s.x+=.1),Math.abs(s.y)===f&&(s.y+=.1);const E=(-s.y+f)/f,k=(s.x+g)/g,B=(s.y+f)/f,T=(-s.x+g)/g;switch(i){case kp:c=E,h="bottom";break;case Tp:d=k,h="left";break;case Pp:c=B,h="top";break;case Cp:d=T,h="right";break;case Ep:c=E,d=T,h="bottom-right";break;case Bp:c=E,d=k,h="bottom-left";break;case Lp:c=B,d=k,h="top-left";break;case Rp:c=B,d=T,h="top-right"}if(o){if(!("corner"===o&&i%2)){let t;switch(i){case kp:case Pp:t=c;break;case Cp:case Tp:t=d;break;default:t=Math.sqrt(Math.abs(d*c))}d=d<0?-t:t,c=c<0?-t:t}}if(d/=x,c/=b,!r){const{worldTransform:e}=t;d<0&&(d=1/u.width/e.scaleX),c<0&&(c=1/u.height/e.scaleY)}if(p){const e=u.width*t.scaleX;d=Op(e*d,p)/e}if(_){const e=u.height*t.scaleY;c=Op(e*c,_)/e}return Sp(n||h,u,l),{origin:l,scaleX:d,scaleY:c,direction:i,lockRatio:o,around:n}},getRotateData(t,e,i,s,o){let n,r={};switch(e){case Ep:n="bottom-right";break;case Bp:n="bottom-left";break;case Lp:n="top-left";break;case Rp:n="top-right";break;default:n="center"}return Sp(o||n,t,r),{origin:r,rotation:D.getRotation(s,r,i)}},getSkewData(t,e,i,s){let o,n,r={},a=0,h=0;switch(e){case kp:n={x:.5,y:0},o="bottom",a=1;break;case Pp:n={x:.5,y:1},o="top",a=1;break;case Cp:n={x:0,y:.5},o="right",h=1;break;case Tp:n={x:1,y:.5},o="left",h=1}const{x:l,y:d,width:c,height:u}=t;n.x=l+n.x*c,n.y=d+n.y*u,Sp(s||o,t,r);const p=D.getRotation(n,r,{x:n.x+(a?i.x:0),y:n.y+(h?i.y:0)});return a?a=-p:h=p,{origin:r,skewX:a,skewY:h}},getAround:(t,e)=>e&&!t?"center":t,getRotateDirection:(t,e,i=8)=>((t=(t+Math.round(e/(360/i)))%i)<0&&(t+=i),t),getFlipDirection(t,e,i){if(e)switch(t){case Cp:t=Tp;break;case Ep:t=Bp;break;case Rp:t=Lp;break;case Tp:t=Cp;break;case Bp:t=Ep;break;case Lp:t=Rp}if(i)switch(t){case kp:t=Pp;break;case Ep:t=Rp;break;case Bp:t=Lp;break;case Pp:t=kp;break;case Rp:t=Ep;break;case Lp:t=Bp}return t}},Mp={};function Ip(t,e){const{editBox:i}=t,s=i.enterPoint;if(!s||!t.editing||!i.visible)return;if("circle"===s.name)return;if("button"===s.pointType)return void(s.cursor||(s.cursor="pointer"));let{rotation:o}=i;const{resizeCursor:n,rotateCursor:r,skewCursor:a,resizeable:l,rotateable:d,skewable:c}=t.mergeConfig,{pointType:u}=s,{flippedX:p,flippedY:_}=i;let g="resize"===u;g&&d&&(e.metaKey||e.ctrlKey||!l)&&(g=!1);const f=c&&!g&&"resize-line"===s.name?a:g?n:r;o+=45*(Dp.getFlipDirection(s.direction,p,_)+1),o=2*Math.round(h.formatRotation(o,!0)/2);const{url:y,x:v,y:m}=f,w=y+o;Mp[w]?s.cursor=Mp[w]:Mp[w]=s.cursor={url:Wp(y,o),x:v,y:m}}function Ap(t){t.editBox.rect.cursor=t.mergeConfig.moveCursor}function Wp(t,e){return'"data:image/svg+xml,'+encodeURIComponent(t.replace("{{rotation}}",e.toString()))+'"'}class zp extends t.Box{}const Fp=["top","right","bottom","left"];class Up extends t.Group{get flipped(){return this.flippedX||this.flippedY}get flippedX(){return this.scaleX<0}get flippedY(){return this.scaleY<0}get flippedOne(){return this.scaleX*this.scaleY<0}constructor(e){super(),this.view=new t.Group,this.rect=new t.Box({name:"rect",hitFill:"all",hitStroke:"none",strokeAlign:"center",hitRadius:5}),this.circle=new zp({name:"circle",strokeAlign:"center",around:"center",cursor:"crosshair",hitRadius:5}),this.buttons=new t.Group({around:"center",hitSelf:!1}),this.resizePoints=[],this.rotatePoints=[],this.resizeLines=[],this.__eventIds=[],this.editor=e,this.visible=!1,this.create(),this.rect.syncEventer=e,this.__listenEvents()}create(){let t,e,i;const{view:s,resizePoints:o,rotatePoints:n,resizeLines:r,rect:a,circle:h,buttons:l}=this,d=["bottom-right","bottom","bottom-left","left","top-left","top","top-right","right"];for(let s=0;s<8;s++)t=new zp({name:"rotate-point",around:d[s],width:15,height:15,hitFill:"all"}),n.push(t),this.listenPointEvents(t,"rotate",s),s%2&&(e=new zp({name:"resize-line",around:"center",width:10,height:10,hitFill:"all"}),r.push(e),this.listenPointEvents(e,"resize",s)),i=new zp({name:"resize-point",hitRadius:5}),o.push(i),this.listenPointEvents(i,"resize",s);this.listenPointEvents(h,"rotate",2),s.addMany(...n,a,h,l,...r,...o),this.add(s)}load(){const{mergeConfig:t,element:e,single:i}=this.editor,{rect:s,circle:o,resizePoints:n}=this,{stroke:r,strokeWidth:a,moveable:h}=t,l=this.getPointsStyle(),d=this.getMiddlePointsStyle();let c;for(let t=0;t<8;t++)c=n[t],c.set(this.getPointStyle(t%2?d[(t-1)/2%d.length]:l[t/2%l.length])),t%2||(c.rotation=t/2*90);o.set(this.getPointStyle(t.circle||t.rotatePoint||l[0])),s.set(Object.assign({stroke:r,strokeWidth:a},t.rect||{})),s.hittable=!i&&!!h,e.syncEventer=i&&h?s:null,this.app.interaction.bottomList=i&&h?[{target:s,proxy:e}]:null}update(t){if(this.visible=!this.editor.element.locked,this.view.worldOpacity){const{mergeConfig:e}=this.editor,{width:i,height:s}=t,{rect:o,circle:n,buttons:r,resizePoints:a,rotatePoints:h,resizeLines:l}=this,{middlePoint:d,resizeable:c,rotateable:u,hideOnSmall:p}=e,_="number"==typeof p?p:10,g=!(p&&i<_&&s<_);let f,y,v,m={};for(let o=0;o<8;o++)gt.toPoint(gt.directionData[o],t,m),y=a[o],f=h[o],v=l[Math.floor(o/2)],y.set(m),f.set(m),v.set(m),y.visible=v.visible=g&&!(!c&&!u),f.visible=g&&u&&c&&!e.rotatePoint,o%2&&(y.visible=f.visible=g&&!!d,(o+1)/2%2?(v.width=i,y.width>i-30&&(y.visible=!1)):(v.height=s,y.rotation=90,y.width>s-30&&(y.visible=!1)));n.visible=g&&u&&!(!e.circle&&!e.rotatePoint),n.visible&&this.layoutCircle(e),o.path&&(o.path=null),o.set(Object.assign(Object.assign({},t),{visible:!0})),r.visible=g&&r.children.length>0,r.visible&&this.layoutButtons(e)}}layoutCircle(t){const{circleDirection:e,circleMargin:i,buttonsMargin:s,buttonsDirection:o,middlePoint:n}=t,r=Fp.indexOf(e||(this.buttons.children.length&&"bottom"===o?"top":"bottom"));this.setButtonPosition(this.circle,r,i||s,!!n)}layoutButtons(t){const{buttons:e}=this,{buttonsDirection:i,buttonsFixed:s,buttonsMargin:o,middlePoint:n}=t,{flippedX:r,flippedY:a}=this;let h=Fp.indexOf(i);(h%2&&r||(h+1)%2&&a)&&s&&(h=(h+2)%4);const l=s?Dp.getRotateDirection(h,this.flippedOne?this.rotation:-this.rotation,4):h;this.setButtonPosition(e,l,o,!!n),s&&(e.rotation=90*(l-h)),e.scaleX=r?-1:1,e.scaleY=a?-1:1}setButtonPosition(t,e,i,s){const o=this.resizePoints[2*e+1],n=e%2,r=e&&3!==e?1:-1,a=(i+(e%2?(s?o.width:0)+t.boxBounds.width:(s?o.height:0)+t.boxBounds.height)/2)*r;n?(t.x=o.x+a,t.y=o.y):(t.x=o.x,t.y=o.y+a)}unload(){this.visible=!1}getPointStyle(t){const{stroke:e,strokeWidth:i,pointFill:s,pointSize:o,pointRadius:n}=this.editor.mergeConfig,r={fill:s,stroke:e,strokeWidth:i,around:"center",strokeAlign:"center",width:o,height:o,cornerRadius:n};return t?Object.assign(r,t):r}getPointsStyle(){const{point:t}=this.editor.mergeConfig;return t instanceof Array?t:[t]}getMiddlePointsStyle(){const{middlePoint:t}=this.editor.mergeConfig;return t instanceof Array?t:t?[t]:this.getPointsStyle()}onSelect(t){1===t.oldList.length&&(t.oldList[0].syncEventer=null,this.app&&(this.app.interaction.bottomList=null))}onDragStart(t){this.dragging=!0;const{editor:e}=this;"rect"===t.current.name?(this.moving=!0,e.dragStartPoint={x:e.element.x,y:e.element.y},e.opacity=e.mergeConfig.hideOnMove?0:1):"resize"===t.current.pointType&&(e.dragStartBounds=Object.assign({},e.element.getLayoutBounds("box","local")),e.resizeDirection=t.current.direction)}onDragEnd(t){this.dragging=!1,this.moving=!1,"rect"===t.current.name&&(this.editor.opacity=1),this.editor.resizeDirection=void 0}onDrag(t){const{editor:e}=this,i=this.enterPoint=t.current;"rotate"===i.pointType||t.metaKey||t.ctrlKey||!e.mergeConfig.resizeable?e.mergeConfig.rotateable&&e.onRotate(t):"resize"===i.pointType&&e.onScale(t),Ip(e,t)}onArrow(t){if(this.editor.editing&&this.editor.mergeConfig.keyEvent){const e={x:0,y:0},i=t.shiftKey?10:1;switch(t.code){case"ArrowDown":e.y=i;break;case"ArrowUp":e.y=-i;break;case"ArrowLeft":e.x=-i;break;case"ArrowRight":e.x=i}this.editor.move(e)}}onDoubleTap(t){"double"===this.editor.mergeConfig.openInner&&this.openInner(t)}onLongPress(t){"long"===this.editor.mergeConfig.openInner&&this.openInner(t)}openInner(t){const{editor:e}=this;if(e.single){const{element:i}=e;i.isBranch?(e.openGroup(i),e.target=e.selector.findDeepOne(t)):e.openInnerEditor()}}listenPointEvents(e,i,s){const{editor:o}=this;e.direction=s,e.pointType=i,e.on_(t.DragEvent.START,this.onDragStart,this),e.on_(t.DragEvent.DRAG,this.onDrag,this),e.on_(t.DragEvent.END,this.onDragEnd,this),e.on_(t.PointerEvent.LEAVE,(()=>this.enterPoint=null)),"circle"!==e.name&&e.on_(t.PointerEvent.ENTER,(t=>{this.enterPoint=e,Ip(o,t)}))}__listenEvents(){const{rect:e,editor:i}=this;this.__eventIds=[i.on_(op.SELECT,this.onSelect,this),e.on_(t.DragEvent.START,this.onDragStart,this),e.on_(t.DragEvent.DRAG,i.onMove,i),e.on_(t.DragEvent.END,this.onDragEnd,this),e.on_(t.PointerEvent.ENTER,(()=>Ap(i))),e.on_(t.PointerEvent.DOUBLE_TAP,this.onDoubleTap,this),e.on_(t.PointerEvent.LONG_PRESS,this.onLongPress,this)]}__removeListenEvents(){this.off_(this.__eventIds),this.__eventIds.length=0}destroy(){this.editor=null,this.__removeListenEvents(),super.destroy()}}class Hp extends t.UI{constructor(t){super(),this.editor=t,this.hittable=!1}__draw(t,e){const{editor:i}=this,{mask:s}=i.mergeConfig;if(s&&i.list.length){const{rect:o}=i.editBox,{width:n,height:r}=o.__;t.resetTransform(),t.fillWorld(t.bounds,!0===s?"rgba(0,0,0,0.8)":s),t.setWorld(o.__world,e.matrix),t.clearRect(0,0,n,r)}}destroy(){this.editor=null,super.destroy()}}const Np='\n<feOffset dy="1"/>\n<feGaussianBlur stdDeviation="1.5"/>\n<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"/>\n<feBlend mode="normal" in="SourceGraphic" result="shape"/>',Yp={editSize:"size",keyEvent:!0,stroke:"#836DFF",strokeWidth:2,pointFill:"#FFFFFF",pointSize:10,pointRadius:16,rotateGap:45,buttonsDirection:"bottom",buttonsMargin:12,hideOnSmall:!0,moveCursor:"move",resizeCursor:{url:`\n<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">\n<g filter="url(#f)">\n<g transform="rotate({{rotation}},12,12)">\n<path d="M7.5 8.0H8.5V5.9L6.8 7.2L7.5 8.0ZM3 11.4L2.3 10.6L1.3 11.4L2.3 12.2L3 11.4ZM7.5 10.4H6.5V11.4H7.5V10.4ZM16.5 10.4V11.4H17.5V10.4H16.5ZM16.5 8.0L17.1 7.2L15.5 5.9V8.0H16.5ZM21 11.4L21.6 12.2L22.6 11.4L21.6 10.6L21 11.4ZM16.5 14.9H15.5V16.9L17.1 15.7L16.5 14.9ZM16.5 12.4H17.5V11.4H16.5V12.4ZM7.5 12.4V11.4H6.5V12.4H7.5ZM7.5 14.9L6.8 15.7L8.5 16.9V14.9H7.5ZM6.8 7.2L2.3 10.6L3.6 12.2L8.1 8.7L6.8 7.2ZM8.5 10.4V8.0H6.5V10.4H8.5ZM16.5 9.4H7.5V11.4H16.5V9.4ZM17.5 10.4V8.0H15.5V10.4H17.5ZM15.8 8.7L20.3 12.2L21.6 10.6L17.1 7.2L15.8 8.7ZM20.3 10.6L15.8 14.1L17.1 15.7L21.6 12.2L20.3 10.6ZM17.5 14.9V12.4H15.5V14.9H17.5ZM7.5 13.4H16.5V11.4H7.5V13.4ZM8.5 14.9V12.4H6.5V14.9H8.5ZM2.3 12.2L6.8 15.7L8.1 14.1L3.6 10.6L2.3 12.2Z" fill="white"/>\n<path fill-rule="evenodd" d="M3 11.4L7.5 8.0V10.4H16.5V8.0L21 11.4L16.5 14.9V12.4H7.5V14.9L3 11.4Z" fill="black"/>\n</g>\n</g>\n<defs>\n<filter id="f" x="-1.6" y="3.9" width="27.2" height="16.9" filterUnits="userSpaceOnUse">\n${Np}\n</filter>\n</defs>\n</svg>\n`,x:12,y:12},rotateCursor:{url:`\n<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">\n<g filter="url(#f)">\n<g transform="rotate(135,12,12),rotate({{rotation}},12,12)">\n<path d="M20.4 8H21.4L20.8 7.1L17.3 2.6L17 2.1L16.6 2.6L13.1 7.1L12.5 8H13.5H15.4C14.9 11.8 11.8 14.9 8 15.4V13.5V12.5L7.1 13.1L2.6 16.6L2.1 17L2.6 17.3L7.1 20.8L8 21.4V20.4V18.4C13.5 17.9 17.9 13.5 18.4 8H20.4Z" stroke="white"/>\n<path fill-rule="evenodd" d="M17 3L20.4 7.5H17.9C17.7 13.1 13.1 17.7 7.5 17.9V20.4L3 17L7.5 13.5V15.9C12.0 15.7 15.7 12.0 15.9 7.5H13.5L17 3Z" fill="black"/>\n</g>\n</g>\n<defs>\n<filter id="f" x="-1.6" y="-0.6" width="27.1" height="27.1" filterUnits="userSpaceOnUse">\n${Np}\n</filter>\n</defs>\n</svg>\n`,x:12,y:12},skewCursor:{url:`\n<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">\n<g filter="url(#f)">\n<g transform="rotate(90,12,12),rotate({{rotation}},12,12)">\n<path d="M21 10.4L21 11.4L23.8 11.4L21.6 9.6L21 10.4ZM17 10.4V11.4L17 11.4L17 10.4ZM15.5 6L16.1 5.2L14.5 3.9V6H15.5ZM15.5 8.4V9.4H16.5V8.4H15.5ZM6 8.4V7.4H5V8.4H6ZM6 10.4H5V11.4H6V10.4ZM7 14.4V13.4L7 13.4L7 14.4ZM3 14.4L3 13.4L0.1 13.4L2.3 15.2L3 14.4ZM8.5 18.9L7.8 19.7L9.5 21.0V18.9H8.5ZM8.5 16.4V15.4H7.5V16.4H8.5ZM19 16.4V17.4H20V16.4H19ZM19 14.4H20V13.4H19V14.4ZM21 9.4L17 9.4L17 11.4L21 11.4L21 9.4ZM14.8 6.7L20.3 11.2L21.6 9.6L16.1 5.2L14.8 6.7ZM16.5 8.4V6H14.5V8.4H16.5ZM6 9.4H15.5V7.4H6V9.4ZM7 10.4V8.4H5V10.4H7ZM15.5 9.4H6V11.4H15.5V9.4ZM17 9.4H15.5V11.4H17V9.4ZM7 15.4H8.5V13.4H7V15.4ZM3 15.4L7 15.4L7 13.4L3 13.4L3 15.4ZM9.1 18.1L3.6 13.6L2.3 15.2L7.8 19.7L9.1 18.1ZM7.5 16.4V18.9H9.5V16.4H7.5ZM19 15.4H8.5V17.4H19V15.4ZM18 14.4V16.4H20V14.4H18ZM8.5 15.4H19V13.4H8.5V15.4Z" fill="white"/>\n<path fill-rule="evenodd" d="M17 10.4L21 10.4L15.5 6V8.4H6V10.4H15.5H17ZM8.5 14.4H7L3 14.4L8.5 18.9V16.4H19V14.4H8.5Z" fill="black"/>\n</g>\n</g>\n<defs>\n<filter x="-2.8" y="1.9" width="29.6" height="23.1" filterUnits="userSpaceOnUse" >\n${Np}\n</filter>\n</defs>\n</svg>\n`,x:12,y:12},selector:!0,hover:!0,select:"press",openInner:"double",boxSelect:!0,moveable:!0,resizeable:!0,flipable:!0,rotateable:!0,skewable:!0};function Vp(t){const{simulateTarget:e,leafList:i}=t,{x:s,y:o,width:n,height:r}=(new lt).setListWithFn(i.list,(t=>t.worldBoxBounds)),a=e.parent=i.list[0].leafer.zoomLayer,{scaleX:h,scaleY:l,e:d,f:c}=a.__world;e.reset({x:(s-d)/h,y:(o-c)/l,width:n/h,height:r/l})}const Xp=(t,e)=>t.parent.children.indexOf(t)-e.parent.children.indexOf(e),Gp=(t,e)=>e.parent.children.indexOf(e)-t.parent.children.indexOf(t),jp={group(e,i,s){e.sort(Gp);const{app:o,parent:n}=e[0];let r;r=s&&s.add?s:new t.Group(s),n.addAt(r,n.children.indexOf(e[0])),e.sort(Xp);const a=new U(i.worldTransform);return a.divideParent(n.worldTransform),r.setTransform(a),r.editable=!0,r.hitChildren=!1,o.lockLayout(),e.forEach((t=>t.dropTo(r))),o.unlockLayout(),r},ungroup(t){const{app:e}=t[0],i=[];return e.lockLayout(),t.forEach((t=>{if(t.isBranch){const{parent:e,children:s}=t;for(;s.length;)i.push(s[0]),s[0].dropTo(e,e.children.indexOf(t));t.remove()}else i.push(t)})),e.unlockLayout(),i},toTop(t){t.sort(Xp),t.forEach((t=>{t.parent&&t.parent.add(t)}))},toBottom(t){t.sort(Gp),t.forEach((t=>{t.parent&&t.parent.addAt(t,0)}))}},Zp=wt.get("EditToolCreator");function Kp(){return t=>{Jp.register(t)}}const qp=Kp,Jp={list:{},register(t){const{tag:e}=t.prototype;$p[e]?Zp.repeat(e):$p[e]=t},get:(t,e)=>new $p[t](e)},{list:$p}=Jp;class Qp extends op{constructor(t,e){super(t,e)}}Qp.BEFORE_OPEN="innerEditor.before_open",Qp.OPEN="innerEditor.open",Qp.BEFORE_CLOSE="innerEditor.before_close",Qp.CLOSE="innerEditor.close";class t_ extends op{constructor(t,e){super(t,e)}}t_.GROUP="editor.group",t_.BEFORE_UNGROUP="editor.before_ungroup",t_.UNGROUP="editor.ungroup",t_.OPEN="editor.open_group",t_.CLOSE="editor.close_group";class e_ extends t.Group{get mergeConfig(){const{element:t,config:e}=this;return this.single&&t.editConfig?Object.assign(Object.assign({},e),t.editConfig):e}get list(){return this.leafList.list}get editing(){return!!this.list.length}get groupOpening(){return!!this.openedGroupList.length}get multiple(){return this.list.length>1}get single(){return 1===this.list.length}get dragging(){return this.editBox.dragging}get element(){return this.multiple?this.simulateTarget:this.list[0]}get buttons(){return this.editBox.buttons}constructor(e,i){super(i),this.config=Dt.clone(Yp),this.leafList=new Xr,this.openedGroupList=new Xr,this.simulateTarget=new t.Rect({visible:!1}),this.editBox=new Up(this),this.editToolList={},this.selector=new bp(this),this.editMask=new Hp(this),this.targetEventIds=[],e&&(this.config=Dt.default(e,this.config)),this.addMany(this.editMask,this.selector,this.editBox)}select(t){this.target=t}cancel(){this.target=null}hasItem(t){return this.leafList.has(t)}addItem(t){this.hasItem(t)||t.locked||(this.leafList.add(t),this.target=this.leafList.list)}removeItem(t){this.hasItem(t)&&(this.leafList.remove(t),this.target=this.leafList.list)}shiftItem(t){this.hasItem(t)?this.removeItem(t):this.addItem(t)}update(){this.editing&&(this.innerEditing&&this.innerEditor.update(),this.editTool.update(),this.selector.update())}updateEditBox(){this.multiple&&Vp(this),this.update()}updateEditTool(){const t=this.editTool;if(t&&(this.editBox.unload(),t.unload(),this.editTool=null),this.editing){const t=this.single?this.list[0].editOuter:"EditTool";this.editTool=this.editToolList[t]=this.editToolList[t]||Jp.get(t,this),this.editBox.load(),this.editTool.load()}}getEditSize(t){return this.mergeConfig.editSize}onMove(e){if(e instanceof t.MoveEvent){if("drag"!==e.moveType){const{moveable:t,resizeable:i}=this.mergeConfig,s=e.getLocalMove(this.element);"move"===t?(e.stop(),this.move(s.x,s.y)):"zoom"===i&&e.stop()}}else{const i={x:e.totalX,y:e.totalY};e.shiftKey&&(Math.abs(i.x)>Math.abs(i.y)?i.y=0:i.x=0),this.move(t.DragEvent.getValidMove(this.element,this.dragStartPoint,i))}}onScale(e){const{element:i}=this;let{around:s,lockRatio:o,resizeable:n,flipable:r,editSize:a}=this.mergeConfig;if(e instanceof t.ZoomEvent)"zoom"===n&&(e.stop(),this.scaleOf(i.getInnerPoint(e),e.scale,e.scale));else{const{direction:t}=e.current;(e.shiftKey||i.lockRatio)&&(o=!0);const n=Dp.getScaleData(i,this.dragStartBounds,t,e.getInnerTotal(i),o,Dp.getAround(s,e.altKey),r,this.multiple||"scale"===a);this.editTool.onScaleWithDrag?(n.drag=e,this.scaleWithDrag(n)):this.scaleOf(n.origin,n.scaleX,n.scaleY)}}onRotate(e){const{skewable:i,rotateable:s,around:o,rotateGap:n}=this.mergeConfig,{direction:r,name:a}=e.current;if(i&&"resize-line"===a)return this.onSkew(e);const{element:l}=this;let d,c;if(e instanceof t.RotateEvent){if("rotate"!==s)return;e.stop(),c=e.rotation,d=l.getInnerPoint(e)}else{const t={x:e.x-e.moveX,y:e.y-e.moveY},i=Dp.getRotateData(l.boxBounds,r,e.getInner(l),l.getInnerPoint(t),e.shiftKey?null:l.around||l.origin||o||"center");c=i.rotation,d=i.origin}c=h.getGapRotation(c,n,l.rotation),c&&(l.scaleX*l.scaleY<0&&(c=-c),this.rotateOf(d,h.float(c,2)))}onSkew(t){const{element:e}=this,{around:i}=this.mergeConfig,{origin:s,skewX:o,skewY:n}=Dp.getSkewData(e.boxBounds,t.current.direction,t.getInnerMove(e),Dp.getAround(i,t.altKey));(o||n)&&this.skewOf(s,o,n)}move(t,e=0){if(!this.mergeConfig.moveable||this.element.locked)return;const{element:i}=this,s=i.getWorldPointByLocal("object"==typeof t?Object.assign({},t):{x:t,y:e},null,!0),o=new np(np.MOVE,{target:i,editor:this,moveX:s.x,moveY:s.y});this.editTool.onMove(o),this.emitEvent(o),this.multiple&&i.move(t,e)}scaleWithDrag(t){if(!this.mergeConfig.resizeable||this.element.locked)return;const{element:e}=this,i=new rp(rp.SCALE,Object.assign(Object.assign({},t),{target:e,editor:this,worldOrigin:e.getWorldPoint(t.origin)}));this.editTool.onScaleWithDrag(i),this.emitEvent(i)}scaleOf(t,e,i=e,s){if(!this.mergeConfig.resizeable||this.element.locked)return;const{element:o}=this,n=this.getWorldOrigin(t),r=this.multiple&&this.getChangedTransform((()=>o.scaleOf(t,e,i))),a=new rp(rp.SCALE,{target:o,editor:this,worldOrigin:n,scaleX:e,scaleY:i,transform:r});this.editTool.onScale(a),this.emitEvent(a)}flip(t){if(this.element.locked)return;const{element:e}=this,i=this.getWorldOrigin("center"),s=this.multiple?this.getChangedTransform((()=>e.flip(t))):new U(cn.getFlipTransform(e,t)),o=new rp(rp.SCALE,{target:e,editor:this,worldOrigin:i,scaleX:"x"===t?-1:1,scaleY:"y"===t?-1:1,transform:s});this.editTool.onScale(o),this.emitEvent(o)}rotateOf(t,e){if(!this.mergeConfig.rotateable||this.element.locked)return;const{element:i}=this,s=this.getWorldOrigin(t),o=this.multiple&&this.getChangedTransform((()=>i.rotateOf(t,e))),n=new ap(ap.ROTATE,{target:i,editor:this,worldOrigin:s,rotation:e,transform:o});this.editTool.onRotate(n),this.emitEvent(n)}skewOf(t,e,i=0,s){if(!this.mergeConfig.skewable||this.element.locked)return;const{element:o}=this,n=this.getWorldOrigin(t),r=this.multiple&&this.getChangedTransform((()=>o.skewOf(t,e,i))),a=new hp(hp.SKEW,{target:o,editor:this,worldOrigin:n,skewX:e,skewY:i,transform:r});this.editTool.onSkew(a),this.emitEvent(a)}getWorldOrigin(t){return this.element.getWorldPoint(cn.getInnerOrigin(this.element,t))}getChangedTransform(t){const{element:e}=this,i=new U(e.worldTransform);return t(),new U(e.worldTransform).divide(i)}group(t){return this.multiple&&(this.target=jp.group(this.list,this.element,t),this.emitGroupEvent(t_.GROUP,this.target)),this.target}ungroup(){const{list:t}=this;return t.length&&(t.forEach((t=>t.isBranch&&this.emitGroupEvent(t_.BEFORE_UNGROUP,t))),this.target=jp.ungroup(t),t.forEach((t=>t.isBranch&&this.emitGroupEvent(t_.UNGROUP,t)))),this.list}openGroup(t){this.openedGroupList.add(t),t.hitChildren=!0,this.emitGroupEvent(t_.OPEN,t)}closeGroup(t){this.openedGroupList.remove(t),t.hitChildren=!1,this.emitGroupEvent(t_.CLOSE,t)}checkOpenedGroups(){const t=this.openedGroupList;if(t.length){let{list:e}=t;this.editing&&(e=[],t.forEach((t=>this.list.every((e=>!cn.hasParent(e,t)))&&e.push(t)))),e.forEach((t=>this.closeGroup(t)))}this.editing&&!this.selector.dragging&&this.checkDeepSelect()}checkDeepSelect(){let t,{list:e}=this;for(let i=0;i<e.length;i++)for(t=e[i].parent;t&&!t.hitChildren;)this.openGroup(t),t=t.parent}emitGroupEvent(t,e){const i=new t_(t,{editTarget:e});this.emitEvent(i),e.emitEvent(i)}openInnerEditor(t){if(t&&(this.target=t),this.single){const t=this.element,e=t.editInner;e&&Jp.list[e]&&(this.editTool.unload(),this.innerEditing=!0,this.innerEditor=this.editToolList[e]||Jp.get(e,this),this.innerEditor.editTarget=t,this.emitInnerEvent(Qp.BEFORE_OPEN),this.innerEditor.load(),this.emitInnerEvent(Qp.OPEN))}}closeInnerEditor(){this.innerEditing&&(this.innerEditing=!1,this.emitInnerEvent(Qp.BEFORE_CLOSE),this.innerEditor.unload(),this.emitInnerEvent(Qp.CLOSE),this.editTool.load(),this.innerEditor=null)}emitInnerEvent(t){const{innerEditor:e}=this,{editTarget:i}=e,s=new Qp(t,{editTarget:i,innerEditor:e});this.emitEvent(s),i.emitEvent(s)}lock(){this.list.forEach((t=>t.locked=!0)),this.update()}unlock(){this.list.forEach((t=>t.locked=!1)),this.update()}toTop(){this.list.length&&(jp.toTop(this.list),this.leafList.update())}toBottom(){this.list.length&&(jp.toBottom(this.list),this.leafList.update())}listenTargetEvents(){if(!this.targetEventIds.length){const{leafer:e}=this.list[0];this.targetEventIds=[this.app.on_(t.MoveEvent.BEFORE_MOVE,this.onMove,this,!0),this.app.on_(t.ZoomEvent.BEFORE_ZOOM,this.onScale,this,!0),this.app.on_(t.RotateEvent.BEFORE_ROTATE,this.onRotate,this,!0),e.on_(Gn.START,this.update,this),e.on_([t.KeyEvent.HOLD,t.KeyEvent.UP],(t=>{Ip(this,t)})),e.on_(t.KeyEvent.DOWN,this.editBox.onArrow,this.editBox)]}}removeTargetEvents(){const{targetEventIds:t}=this;t.length&&(this.off_(t),t.length=0)}destroy(){this.destroyed||(this.simulateTarget.destroy(),Object.values(this.editToolList).forEach((t=>t.destroy())),this.editToolList={},this.target=this.hoverTarget=this.simulateTarget=this.editTool=this.innerEditor=null,super.destroy())}}Wt([lp((function(t,e){t.emitEvent(new op(op.HOVER,{editor:t,value:t.hoverTarget,oldValue:e}))}))],e_.prototype,"hoverTarget",void 0),Wt([lp((function(t,e){const{target:i}=t;i?t.leafList=i instanceof Xr?i:new Xr(i):t.leafList.reset(),t.emitEvent(new op(op.SELECT,{editor:t,value:i,oldValue:e})),t.checkOpenedGroups(),t.editing?t.waitLeafer((()=>{t.multiple&&Vp(t),Ap(t),t.updateEditTool(),t.update(),t.listenTargetEvents()})):(t.updateEditTool(),t.removeTargetEvents())}))],e_.prototype,"target",void 0);class i_{static registerInnerEditor(){Jp.register(this)}get tag(){return"InnerEditor"}get editBox(){return this.editor.editBox}constructor(t){this.editor=t,this.create()}onCreate(){}create(){this.view=new t.Group,this.onCreate()}onLoad(){}load(){this.editor.selector.hittable=this.editor.app.tree.hitChildren=!1,this.onLoad()}onUpdate(){}update(){this.onUpdate()}onUnload(){}unload(){this.editor.selector.hittable=this.editor.app.tree.hitChildren=!0,this.onUnload()}onDestroy(){}destroy(){this.onDestroy(),this.editor&&(this.view&&this.view.destroy(),this.eventIds&&this.editor.off_(this.eventIds),this.editor=this.view=this.eventIds=null)}}t.EditTool=class extends i_{static registerEditTool(){Jp.register(this)}get tag(){return"EditTool"}onMove(t){const{moveX:e,moveY:i,editor:s}=t,{app:o,list:n}=s;o.lockLayout(),n.forEach((t=>{t.moveWorld(e,i)})),o.unlockLayout()}onScale(t){const{scaleX:e,scaleY:i,transform:s,worldOrigin:o,editor:n}=t,{app:r,list:a}=n;r.lockLayout(),a.forEach((t=>{const r="scale"!==n.getEditSize(t);s?t.transformWorld(s,r):t.scaleOfWorld(o,e,i,r)})),r.unlockLayout()}onRotate(t){const{rotation:e,transform:i,worldOrigin:s,editor:o}=t,{app:n,list:r}=o;n.lockLayout(),r.forEach((t=>{const n="scale"!==o.getEditSize(t);i?t.transformWorld(i,n):t.rotateOfWorld(s,e)})),n.unlockLayout()}onSkew(t){const{skewX:e,skewY:i,transform:s,worldOrigin:o,editor:n}=t,{app:r,list:a}=n;r.lockLayout(),a.forEach((t=>{const r="scale"!==n.getEditSize(t);s?t.transformWorld(s,r):t.skewOfWorld(o,e,i,r)})),r.unlockLayout()}load(){this.editBox.view.visible=!0,this.onLoad()}update(){const{editor:t,editBox:e}=this,{simulateTarget:i,element:s}=t;t.multiple&&i.parent.updateLayout();const{x:o,y:n,scaleX:r,scaleY:a,rotation:h,skewX:l,skewY:d,width:c,height:u}=s.getLayoutBounds("box",t,!0);e.set({x:o,y:n,scaleX:r,scaleY:a,rotation:h,skewX:l,skewY:d}),e.update({x:0,y:0,width:c,height:u}),this.onUpdate()}unload(){this.editBox.view.visible=!1,this.onUnload()}},t.EditTool=Wt([Kp()],t.EditTool);const{left:s_,right:o_}=t.Direction9,{move:n_,copy:r_}=D;function a_(t,e){let i=1;const s="out"===e,o=Math.abs(t);if(o>1){for(;s?i<o:i<=o;)i*=2;s&&(i/=2)}else{for(;s?i>=o:i>o;)i/=2;s||(i*=2)}return i/t}t.LineEditTool=class extends t.EditTool{constructor(){super(...arguments),this.scaleOfEvent=!0}get tag(){return"LineEditTool"}onScaleWithDrag(t){const{drag:e,direction:i,lockRatio:s,around:o}=t,n=t.target,r=i===s_;if(n.pathInputed){const{path:t}=n.__,{from:i,to:a}=this.getFromToByPath(t);this.dragPoint(i,a,r,o,this.getInnerMove(n,e,s)),t[1]=i.x,t[2]=i.y,t[4]=a.x,t[5]=a.y,n.path=t}else if(n.points){const{points:t}=n,{from:i,to:a}=this.getFromToByPoints(t);this.dragPoint(i,a,r,o,this.getInnerMove(n,e,s)),t[0]=i.x,t[1]=i.y,t[2]=a.x,t[3]=a.y,n.points=t}else{const t={x:0,y:0},{toPoint:i}=n;n.rotation=0,this.dragPoint(t,i,r,o,this.getInnerMove(n,e,s)),n.getLocalPointByInner(t,null,null,!0),n.getLocalPointByInner(i,null,null,!0),n.x=t.x,n.y=t.y,n.getInnerPointByLocal(i,null,null,!0),n.toPoint=i}}getInnerMove(t,e,i){const s=e.getInnerMove(t);return i&&(Math.abs(s.x)>Math.abs(s.y)?s.y=0:s.x=0),s}getFromToByPath(t){return{from:{x:t[1],y:t[2]},to:{x:t[4],y:t[5]}}}getFromToByPoints(t){return{from:{x:t[0],y:t[1]},to:{x:t[2],y:t[3]}}}dragPoint(t,e,i,s,o){const{x:n,y:r}=o;i?(n_(t,n,r),s&&n_(e,-n,-r)):(s&&n_(t,-n,-r),n_(e,n,r))}onSkew(t){}onUpdate(){const{editBox:t}=this,{rotatePoints:e,resizeLines:i,resizePoints:s,rect:o}=t,n=this.editor.element;let r,a;if(n.pathInputed?r=this.getFromToByPath(n.__.path):n.points&&(r=this.getFromToByPoints(n.__.points)),r){const{from:i,to:a}=r;n.innerToWorld(i,i,!1,t),n.innerToWorld(a,a,!1,t),o.pen.clearPath().moveTo(i.x,i.y).lineTo(a.x,a.y),r_(s[7],i),r_(e[7],i),r_(s[3],a),r_(e[3],a)}for(let t=0;t<8;t++)t<4&&(i[t].visible=!1),a=t===s_||t===o_,s[t].visible=a,e[t].visible=!r&&a}},t.LineEditTool=Wt([Kp()],t.LineEditTool),i.editor=function(t){return new e_(t)},t.UI.setEditConfig=function(t){fo(this.prototype,"editConfig",{get(){return"function"==typeof t?t(this):t}})},t.UI.setEditOuter=function(t){fo(this.prototype,"editOuter",{get(){return"string"==typeof t?t:t(this)}})},t.UI.setEditInner=function(t){fo(this.prototype,"editInner",{get(){return"string"==typeof t?t:t(this)}})},t.Leafer.prototype.zoom=function(t,e,i){const{zoomLayer:s}=this,o=this.canvas.bounds.clone().shrink(e||30),n=new lt,r={x:o.x+o.width/2,y:o.y+o.height/2};let a;const{scaleX:h}=this.__;if("string"==typeof t)switch(t){case"in":a=a_(h,"in");break;case"out":a=a_(h,"out");break;case"fit":t=this.boxBounds;break;case"fit-width":(t=new lt(this.boxBounds)).height=0;break;case"fit-height":(t=new lt(this.boxBounds)).width=0}else"number"==typeof t&&(a=t/h);if(a)1!==a&&s.scaleOfWorld(r,this.getValidScale(a));else if("object"==typeof t){const e=t instanceof Array;if(e||t.tag){const i=e?t:[t];n.setListWithFn(i,mn.worldBounds)}else{const e=function(t,e){let i,{x:s,y:o,width:n,height:r}=t;return r||(r=n*(e.height/e.width),i=!0),n||(n=r*(e.width/e.height),i=!0),i?{x:s,y:o,width:n,height:r}:t}(t,o);n.set(s.getWorldBounds(e))}const{x:r,y:a,width:h,height:l}=n;let d=o.x-r,c=o.y-a;if(i)d+=Math.max((o.width-h)/2,0),c+=Math.max((o.height-l)/2,0);else{const t=this.getValidScale(Math.min(o.width/h,o.height/l));d+=(o.width-h*t)/2,c+=(o.height-l*t)/2,s.scaleOfWorld(n,t),n.scaleOf(n,t)}return s.move(d,c),n.move(d,c)}return s.worldBoxBounds};class h_ extends t.Group{get isOutside(){return!0}constructor(t,e){super(),this.config={theme:"light",padding:0,minSize:10},t.isApp&&(t.sky.add(this),t=t.tree),this.target=t,e&&Dt.assign(this.config,e),this.changeTheme(this.config.theme),this.waitLeafer(this.__listenEvents,this)}changeTheme(e){let i;"string"==typeof e?(i={fill:"black",stroke:"rgba(255,255,255,0.8)"},"dark"===e&&(i.fill="white",i.stroke="rgba(0,0,0,0.2)")):i=e,this.scrollXBar||this.addMany(this.scrollXBar=new t.Box,this.scrollYBar=new t.Box),i=Object.assign({strokeAlign:"center",opacity:.5,width:6,cornerRadius:3,hoverStyle:{opacity:.6},pressStyle:{opacity:.7}},i),i.height||(i.height=i.width),this.scrollXBar.set(Object.assign(Object.assign({},i),{visible:!1})),this.scrollYBar.set(Object.assign(Object.assign({},i),{visible:!1})),this.leafer&&this.update()}update(t){if(this.dragScrolling)return;const{minSize:e,padding:i}=this.config,{zoomLayer:s,canvas:o}=this.target.leafer,{worldRenderBounds:n}=s;if(t&&this.scrollBounds&&this.scrollBounds.isSame(n))return;this.scrollBounds=new lt(n);const r=o.bounds.clone().shrink(i),a=r.clone().add(n),h=this.ratioX=r.width/a.width,l=this.ratioY=r.height/a.height,d=(r.x-a.x)/a.width,c=(r.y-a.y)/a.height,u=h<1,p=l<1,{scrollXBar:_,scrollYBar:g}=this,{x:f,y:y,width:v,height:m}=r.shrink([2,p?g.width+6:2,u?_.height+6:2,2]);_.set({x:f+v*d,y:y+m+2,width:Math.max(v*h,e),visible:u}),g.set({x:f+v+2,y:y+m*c,height:Math.max(m*l,e),visible:p})}onDrag(t){this.dragScrolling=!0,this.__dragOut=this.app.config.move.dragOut,this.app.config.move.dragOut=!1;const e=t.current===this.scrollXBar,i=this.target.leafer.getValidMove(e?-t.moveX/this.ratioX:0,e?0:-t.moveY/this.ratioY);this.target.moveWorld(i.x,i.y),t.current.moveWorld(i.x&&-i.x*this.ratioX,i.y&&-i.y*this.ratioY)}onDragEnd(){this.dragScrolling=!1,this.app.config.move.dragOut=this.__dragOut}__listenEvents(){const{scrollXBar:e,scrollYBar:i}=this;this.__eventIds=[e.on_(t.DragEvent.DRAG,this.onDrag,this),i.on_(t.DragEvent.DRAG,this.onDrag,this),e.on_(t.DragEvent.END,this.onDragEnd,this),i.on_(t.DragEvent.END,this.onDragEnd,this),this.target.on_(Gn.BEFORE,(()=>this.update(!0))),this.target.leafer.on_(Nn.RESIZE,(()=>this.update()))]}__removeListenEvents(){this.off_(this.__eventIds)}destroy(){this.destroyed||(this.__removeListenEvents(),this.target=this.config=null,super.destroy())}}class l_ extends Ga{}t.Arrow=class extends t.Line{get __tag(){return"Arrow"}constructor(t){super(t),this.__.__useArrow=!0}},Wt([Yo(l_)],t.Arrow.prototype,"__",void 0),Wt([Do("angle")],t.Arrow.prototype,"endArrow",void 0),t.Arrow=Wt([$o()],t.Arrow);const{M:d_,L:c_,C:u_,Q:p_,O:__}=qt,{rotate:g_,copyFrom:f_,scale:y_}=D,v_={},m_={layout(t,e,i,s,o,n,r){let a,h,l=0,d=t.length;for(;l<d;)switch(a=t[l],a){case d_:case c_:w_(t,l+1,e,i,s,o,n,r),l+=3;break;case u_:for(h=1;h<6;h+=2)w_(t,l+h,e,i,s,o,n,r);l+=7;break;case p_:for(h=1;h<4;h+=2)w_(t,l+h,e,i,s,o,n,r);l+=5;break;case __:t[l+1]+=e,t[l+2]+=i,s&&(t[l+3]*=s),n&&(t[l+4]+=n,t[l+5]+=n),l+=7}},rotate(t,e,i){m_.layout(t,0,0,1,1,e,i)}};function w_(t,e,i,s,o,n,r,a){f_(v_,t[e],t[e+1]),r&&g_(v_,r,a),o&&y_(v_,o,n),t[e]=i+v_.x,t[e+1]=s+v_.y}const{layout:x_,rotate:b_}=m_,{getAngle:E_}=D,k_={x:-.5},B_={connect:k_,offset:{x:-.71,bevelJoin:.36,roundJoin:.22},path:[1,-3,-3,2,0,0,2,-3,3]},T_={connect:k_,offset:{x:-1.207,bevelJoin:.854,roundJoin:.707},path:[1,-3,-3,2,0,0,2,-1,0]},L_={connect:k_,offset:{x:-.9,bevelJoin:.624,roundJoin:.4},path:[1,-3,0,2,-3,-2,2,0,0,2,-3,2,2,-3,0,1,-2.05,1.1,2,-2.05,-1.1]},P_={connect:k_,offset:{x:-1.1,bevelJoin:.872,roundJoin:.6},path:[1,-3,0,2,-3.5,-1.8,2,0,0,2,-3.5,1.8,2,-3,0,1,-2.25,.95,2,-2.25,-.95]},R_={offset:k_,path:[...L_.path]};b_(R_.path,180,{x:-1.5,y:0});const C_={connect:{x:-1.3},path:[1,1.8,-.1,2,1.8,0,26,0,0,1.8,0,359,0]},S_={connect:{x:.5},path:[...C_.path,1,0,0,26,0,0,1,0,360,0]},O_={connect:{x:-1.3},path:[1,-1.4,0,2,-1.4,-1.4,2,1.4,-1.4,2,1.4,1.4,2,-1.4,1.4,2,-1.4,0]},D_={path:[...O_.path,2,-1.4,-.49,2,1,-.49,1,-1.4,.49,2,1,.49]},M_=Dt.clone(O_),I_=Dt.clone(D_);b_(M_.path,45),b_(I_.path,45);const A_={angle:B_,"angle-side":T_,arrow:P_,triangle:L_,"triangle-flip":R_,circle:S_,"circle-line":C_,square:D_,"square-line":O_,diamond:I_,"diamond-line":M_,mark:{offset:k_,path:[1,0,-2,2,0,2]}};function W_(t,e,i,s,o,n){const{strokeCap:r,strokeJoin:a}=t.__,{offset:h,connect:l,path:d}="object"==typeof e?e:A_[e];let c=l?l.x:0,u=h?h.x:0;const p=[...d];return"none"!==r&&(c-=.5),h&&("round"===a&&h.roundJoin?u+=h.roundJoin:"bevel"===a&&h.bevelJoin&&(u+=h.bevelJoin)),u&&x_(p,u,0),x_(p,s.x,s.y,o,o,E_(i,s)),n.x=(c+u)*o,p}const{M:z_,L:F_,C:U_,Q:H_,Z:N_,N:Y_,D:V_,X:X_,G:G_,F:j_,O:Z_,P:K_,U:q_}=qt,{copy:J_,copyFrom:$_,getDistancePoint:Q_}=D,tg={},eg={},ig={},sg={},og={},ng={list:A_,addArrows(t,e){const{startArrow:i,endArrow:s,strokeWidth:o,__pathForRender:n}=t.__;let r,a=0,h=n.length,l=0,d=i&&"none"!==i;for(;a<h;){switch(r=n[a],r){case z_:case F_:(l<2||a+6>=h)&&($_(og,n[a+1],n[a+2]),!l&&d&&J_(eg,og)),a+=3;break;case U_:1!==l&&a+7!==h||rg(n,sg,og,a+3),a+=7;break;case H_:1!==l&&a+5!==h||rg(n,sg,og,a+1),a+=5;break;case N_:return;case Y_:a+=5;break;case V_:a+=9;break;case X_:a+=6;break;case G_:a+=9;break;case j_:a+=5;break;case Z_:a+=7;break;case K_:a+=4;break;case q_:1!==l&&a+6!==h||rg(n,sg,og,a+1),a+=6}if(l++,1===l&&r!==z_)return;if(2===l&&d&&J_(ig,r===F_?og:sg),a===h){const h=t.__.__pathForRender=e?[...n]:n;if(d&&(h.push(...W_(t,i,ig,eg,o,tg)),tg.x&&(Q_(eg,ig,-tg.x,!0),h[1]=ig.x,h[2]=ig.y)),s&&"none"!==s&&(h.push(...W_(t,s,sg,og,o,tg)),tg.x)){let t;switch(Q_(og,sg,-tg.x,!0),r){case F_:t=a-3+1;break;case U_:t=a-7+5;break;case H_:t=a-5+3;break;case q_:t=a-6+3}t&&ag(h,sg,t)}}else J_(sg,og)}}};function rg(t,e,i,s){$_(e,t[s],t[s+1]),$_(i,t[s+2],t[s+3])}function ag(t,e,i){t[i]=e.x,t[i+1]=e.y}Object.assign(Ba,ng);const hg={none:"none",title:"capitalize",upper:"uppercase",lower:"lowercase","small-caps":"small-caps"},lg={top:"flex-start",middle:"center",bottom:"flex-end"};function dg(t,e,i){const{style:s}=t,{fill:o,padding:n,textWrap:r,textOverflow:a,textDecoration:h}=e;s.fontFamily=e.fontFamily,s.fontSize=e.fontSize*i+"px",function(t,e){let i="black";e instanceof Array&&(e=e[0]);if("object"==typeof e)switch(e.type){case"solid":i=ka.string(e.color);break;case"image":break;case"linear":case"radial":case"angular":const t=e.stops[0];i=ka.string("string"==typeof t?t:t.color);break;default:void 0!==e.r&&(i=ka.string(e))}else i=e;t.color=i}(s,o),s.fontStyle=e.italic?"italic":"normal",s.fontWeight=e.fontWeight,s.textDecoration="delete"===h?"line-through":h,s.textTransform=hg[e.textCase],s.textAlign=e.textAlign,s.display="flex",s.flexDirection="column",s.justifyContent=lg[e.verticalAlign],s.lineHeight=(e.__.__lineHeight||0)*i+"px",s.letterSpacing=(e.__.__letterSpacing||0)*i+"px","none"===r?s.whiteSpace="nowrap":"break"===r&&(s.wordBreak="break-all"),s.textIndent=(e.paraIndent||0)*i+"px",s.padding=n instanceof Array?n.map((t=>t*i+"px")).join(" "):(n||0)*i+"px",s.textOverflow="show"===a?"":"hide"===a?"clip":a}t.TextEditor=class extends i_{constructor(){super(...arguments),this.config={selectAll:!0},this.eventIds=[]}get tag(){return"TextEditor"}onLoad(){const{editor:e}=this,{config:i}=e.app,s=this.editTarget;s.visible=!1,this.isHTMLText=!(s instanceof t.Text),this._keyEvent=i.keyEvent,i.keyEvent=!1;const o=this.editDom=document.createElement("div"),{style:n}=o;if(o.contentEditable="true",n.position="fixed",n.transformOrigin="left top",n.boxSizing="border-box",this.isHTMLText)o.innerHTML=s.text,this.textScale=1;else{o.innerText=s.text;const{scaleX:t,scaleY:e}=s.worldTransform;this.textScale=Math.max(Math.abs(t),Math.abs(e));const i=s.fontSize*this.textScale;i<12&&(this.textScale*=12/i)}const{view:r}=e.app;(this.inBody=r instanceof HTMLCanvasElement)?document.body.appendChild(o):r.appendChild(o),this.eventIds=[e.app.on_(t.PointerEvent.DOWN,(t=>{let i,{target:s}=t.origin;for(;s;)s===o&&(i=!0),s=s.parentElement;i||e.closeInnerEditor()}))],this.onFocus=this.onFocus.bind(this),this.onInput=this.onInput.bind(this),this.onUpdate=this.onUpdate.bind(this),this.onEscape=this.onEscape.bind(this),o.addEventListener("focus",this.onFocus),o.addEventListener("input",this.onInput),window.addEventListener("keydown",this.onEscape),window.addEventListener("scroll",this.onUpdate);const a=window.getSelection(),h=document.createRange();if(this.config.selectAll)h.selectNodeContents(o);else{const t=o.childNodes[0];h.setStartAfter(t),h.setEndAfter(t),h.collapse(!0)}a.removeAllRanges(),a.addRange(h)}onInput(){const{editDom:t}=this;this.editTarget.text=this.isHTMLText?t.innerHTML:t.innerText.replace(/\n\n/,"\n")}onFocus(){this.editDom.style.outline="none"}onEscape(t){"Escape"===t.code&&this.editor.closeInnerEditor()}onUpdate(){const{editTarget:t,textScale:e}=this,{style:i}=this.editDom,{x:s,y:o}=this.inBody?t.app.clientBounds:t.app.tree.clientBounds,{a:n,b:r,c:a,d:h,e:l,f:d}=new U(t.worldTransform).scale(1/e);i.transform=`matrix(${n},${r},${a},${h},${l},${d})`,i.left=s-window.scrollX+"px",i.top=o-window.scrollY+"px",i.width=t.width*e+(t.__.__autoWidth?20:0)+"px",i.height=t.height*e+(t.__.__autoHeight?20:0)+"px",this.isHTMLText||dg(this.editDom,t,this.textScale)}onUnload(){const{editTarget:t,editor:e,editDom:i}=this;t&&(this.onInput(),t.visible=!0,e.app.config.keyEvent=this._keyEvent,e.off_(this.eventIds),i.removeEventListener("focus",this.onFocus),i.removeEventListener("input",this.onInput),window.removeEventListener("keydown",this.onEscape),window.removeEventListener("scroll",this.onUpdate),i.remove(),this.editDom=this.eventIds=void 0)}},t.TextEditor=Wt([qp()],t.TextEditor);class cg extends eh{setText(t){this._text=t,this.__htmlChanged=!0}}return t.HTMLText=class extends t.Image{get __tag(){return"HTMLText"}get editInner(){return"TextEditor"}constructor(t){super(t)}__updateBoxBounds(){const t=this.__;if(t.__htmlChanged){const e=document.createElement("div"),{style:i}=e;i.all="initial",i.position="absolute",i.visibility="hidden",e.innerHTML=this.text,document.body.appendChild(e);const{width:s,height:o}=e.getBoundingClientRect(),n=s+10,r=`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${o}">\n                        <foreignObject width="${n}" height="${o}">\n                            <style>\n                                * {\n                                    margin: 0;\n                                    padding: 0;\n                                    box-sizing: border-box;\n                                }\n                            </style>\n                            <body xmlns="http://www.w3.org/1999/xhtml">\n                                ${this.text}\n                            </body>\n                        </foreignObject>\n                    </svg>`;t.__setImageFill("data:image/svg+xml,"+encodeURIComponent(r)),t.__naturalWidth=n/t.pixelRatio,t.__naturalHeight=o/t.pixelRatio,t.__htmlChanged=!1,e.remove()}super.__updateBoxBounds()}},Wt([Yo(cg)],t.HTMLText.prototype,"__",void 0),Wt([To("")],t.HTMLText.prototype,"text",void 0),t.HTMLText=Wt([$o()],t.HTMLText),t.AlignHelper=vt,t.AnimateEvent=Xn,t.AroundHelper=gt,t.ArrowData=l_,t.AutoBounds=ct,t.BezierHelper=xe,t.Bounds=lt,t.BoundsHelper=nt,t.BoxData=Ya,t.BranchHelper=xn,t.BranchRender=_r,t.CanvasData=ih,t.CanvasManager=Ot,t.ChildEvent=Fn,t.ColorConvert=ka,t.Creator=i,t.Cursor=Rl,t.DataHelper=Dt,t.Debug=wt,t.EditBox=Up,t.EditDataHelper=Dp,t.EditPoint=zp,t.EditSelect=bp,t.EditSelectHelper=wp,t.EditToolCreator=Jp,t.Editor=e_,t.EditorEvent=op,t.EditorGroupEvent=t_,t.EditorHelper=jp,t.EditorMoveEvent=np,t.EditorRotateEvent=ap,t.EditorScaleEvent=rp,t.EditorSkewEvent=hp,t.Effect=Ra,t.EllipseData=Za,t.EllipseHelper=Ce,t.Event=zn,t.EventCreator=Ct,t.Export=Ca,t.FileHelper=no,t.FrameData=Xa,t.GroupData=Na,t.HTMLTextData=cg,t.HitCanvasManager=Cl,t.ImageData=eh,t.ImageEvent=Hn,t.ImageManager=co,t.IncrementId=s,t.InnerEditor=i_,t.InnerEditorEvent=Qp,t.Interaction=ql,t.InteractionBase=Pl,t.InteractionHelper=hl,t.Keyboard=Kh,t.LayoutEvent=Vn,t.Layouter=ca,t.LeafBounds=cr,t.LeafBoundsHelper=mn,t.LeafData=It,t.LeafDataProxy=qn,t.LeafEventer=An,t.LeafHelper=cn,t.LeafLayout=Mn,t.LeafLevelList=Gr,t.LeafList=Xr,t.LeafMatrix=sr,t.LeafRender=ur,t.LeaferCanvas=Zr,t.LeaferCanvasBase=jt,t.LeaferData=Va,t.LeaferEvent=jn,t.LeaferImage=go,t.LeaferTypeCreator=sl,t.LineData=Ga,t.MathHelper=h,t.Matrix=U,t.MatrixHelper=b,t.MultiTouchHelper=wl,t.MyDragEvent=tl,t.MyImage=Nh,t.MyPointerEvent=$h,t.NeedConvertToCanvasCommandMap=$t,t.OneRadian=l,t.PI2=d,t.PI_2=c,t.Paint=Ta,t.PaintGradient=Pa,t.PaintImage=La,t.PathArrow=Ba,t.PathArrowModule=ng,t.PathBounds=js,t.PathCommandDataHelper=Wi,t.PathCommandMap=qt,t.PathConvert=_i,t.PathCorner=eo,t.PathCreator=ts,t.PathData=Ja,t.PathDrawer=gs,t.PathHelper=Zt,t.PathMatrixHelper=m_,t.PathNumberCommandLengthMap=ie,t.PathNumberCommandMap=ee,t.PathScaler=Nu,t.PenData=$a,t.Platform=e,t.Point=z,t.PointHelper=D,t.PointerButton=qh,t.PolygonData=Ka,t.PropertyEvent=Un,t.RectData=ja,t.RectHelper=se,t.RectRender=rh,t.RenderEvent=Gn,t.Renderer=pa,t.ResizeEvent=Nn,t.Run=kt,t.ScrollBar=h_,t.SelectArea=gp,t.Selector=ba,t.StarData=qa,t.State=Sa,t.StringNumberMap=mt,t.Stroker=_p,t.TaskItem=ho,t.TaskProcessor=lo,t.TextConvert=Ea,t.TextData=th,t.TwoPointBoundsHelper=N,t.UIBounds=sh,t.UICreator=Lt,t.UIData=Ua,t.UIEvent=Jh,t.UIRender=oh,t.UnitConvert=Ha,t.WaitHelper=Bn,t.WatchEvent=Yn,t.Watcher=Qr,t.addInteractionWindow=el,t.affectRenderBoundsType=Mo,t.affectStrokeBoundsType=So,t.arrowType=Da,t.attr=mo,t.autoLayoutType=Eo,t.boundsType=To,t.canvasPatch=oo,t.canvasSizeAttrs=Gt,t.cursorType=No,t.dataProcessor=Yo,t.dataType=xo,t.decorateLeafAttr=vo,t.defineDataProcessor=Vo,t.defineKey=fo,t.defineLeafAttr=wo,t.doBoundsType=Po,t.doStrokeType=Oo,t.effectType=Ma,t.emptyData={},t.eraserType=Uo,t.getBoundsData=p,t.getDescriptor=yo,t.getMatrixData=_,t.getPointData=u,t.hitType=Ho,t.inviteCode={},t.layoutProcessor=function(t){return(e,i)=>{fo(e,"__LayoutProcessor",{get:()=>t})}},t.maskType=Fo,t.naturalBoundsType=Lo,t.opacityType=Ao,t.pathInputType=Ro,t.pathType=Co,t.pen=io,t.positionType=bo,t.registerEditTool=Kp,t.registerInnerEditor=qp,t.registerUI=$o,t.registerUIEvent=Qo,t.resizeType=Ia,t.rewrite=Zo,t.rewriteAble=Ko,t.rotationType=Bo,t.scaleResize=Ju,t.scaleResizeFontSize=$u,t.scaleResizeGroup=ep,t.scaleResizePath=Qu,t.scaleResizePoints=tp,t.scaleType=ko,t.sortType=zo,t.stateType=Oa,t.strokeType=Do,t.surfaceType=Io,t.tempBounds=dt,t.tempMatrix=H,t.tempPoint=F,t.useCanvas=Jr,t.useModule=Jo,t.version="1.0.1",t.visibleType=Wo,t.zoomLayerType=Aa,t}({});
